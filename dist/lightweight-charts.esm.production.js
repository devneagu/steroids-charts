/*!
 * @license
 * TradingView Lightweight Charts v4.0.0-dev+202210142034
 * Copyright (c) 2022 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
import{bindToDevicePixelRatio as t}from"fancy-canvas/coordinate-space";var i,s;function n(t,i){const s={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(s)}function e(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(s,i+e),t.lineTo(n,i+e),t.stroke()}function r(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function h(t){if(void 0===t)throw new Error("Value is undefined");return t}function l(t){if(null===t)throw new Error("Value is null");return t}function a(t){return l(h(t))}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps",t[t.Curved=2]="Curved"}(i||(i={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(s||(s={}));const o={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function _(t){return t<0?0:t>255?255:Math.round(t)||0}function u(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const c=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,d=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,f=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,p=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function v(t){(t=t.toLowerCase())in o&&(t=o[t]);{const i=p.exec(t)||f.exec(t);if(i)return[_(parseInt(i[1],10)),_(parseInt(i[2],10)),_(parseInt(i[3],10)),u(i.length<5?1:parseFloat(i[4]))]}{const i=d.exec(t);if(i)return[_(parseInt(i[1],16)),_(parseInt(i[2],16)),_(parseInt(i[3],16)),1]}{const i=c.exec(t);if(i)return[_(17*parseInt(i[1],16)),_(17*parseInt(i[2],16)),_(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function m(t){const i=v(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(s=i,.199*s[0]+.687*s[1]+.114*s[2]>160?"black":"white")};var s}class b{constructor(){this.h=[]}l(t,i,s){const n={o:t,_:i,u:!0===s};this.h.push(n)}p(t){const i=this.h.findIndex((i=>t===i.o));i>-1&&this.h.splice(i,1)}v(t){this.h=this.h.filter((i=>i._!==t))}m(t,i){const s=[...this.h];this.h=this.h.filter((t=>!t.u)),s.forEach((s=>s.o(t,i)))}g(){return this.h.length>0}M(){this.h=[]}}function w(t,...i){for(const s of i)for(const i in s)void 0!==s[i]&&("object"!=typeof s[i]||void 0===t[i]?t[i]=s[i]:w(t[i],s[i]));return t}function g(t){return"number"==typeof t&&isFinite(t)}function M(t){return"number"==typeof t&&t%1==0}function S(t){return"string"==typeof t}function y(t){return"boolean"==typeof t}function k(t){const i=t;if(!i||"object"!=typeof i)return i;let s,n,e;for(n in s=Array.isArray(i)?[]:{},i)i.hasOwnProperty(n)&&(e=i[n],s[n]=e&&"object"==typeof e?k(e):e);return s}function C(t){return null!==t}function x(t){return null===t?void 0:t}const T="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function D(t,i,s){return void 0===i&&(i=T),`${s=void 0!==s?`${s} `:""}${t}px ${i}`}class P{constructor(t){this.S={k:1,C:5,T:NaN,D:"",P:"",R:"",A:"",O:0,L:0,N:0,I:0,B:0},this.V=t}F(){const t=this.S,i=this.W(),s=this.j();return t.T===i&&t.P===s||(t.T=i,t.P=s,t.D=D(i,s),t.I=2.5/12*i,t.O=t.I,t.L=i/12*t.C,t.N=i/12*t.C,t.B=0),t.R=this.H(),t.A=this.$(),this.S}H(){return this.V.F().layout.textColor}$(){return this.V.U()}W(){return this.V.F().layout.fontSize}j(){return this.V.F().layout.fontFamily}}class R{constructor(){this.q=[]}Y(t){this.q=t}X(t,i,s,n){this.q.forEach((e=>{t.save(),e.X(t,i,s,n),t.restore()}))}}class A{X(t,i,s,n){t.save(),t.scale(i,i),this.Z(t,s,n),t.restore()}K(t,i,s,n){t.save(),t.scale(i,i),this.G(t,s,n),t.restore()}G(t,i,s){}}class O extends A{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J||null===this.J.it)return;const i=this.J.it,s=this.J,n=n=>{t.beginPath();for(let e=i.to-1;e>=i.from;--e){const i=s.st[e];t.moveTo(i.nt,i.et),t.arc(i.nt,i.et,n,0,2*Math.PI)}t.fill()};t.fillStyle=s.rt,n(s.ht+2),t.fillStyle=s.lt,n(s.ht)}}function L(){return{st:[{nt:0,et:0,ot:0,_t:0}],lt:"",rt:"",ht:0,it:null}}const E={from:0,to:1};class N{constructor(t,i){this.ut=new R,this.ct=[],this.dt=[],this.ft=!0,this.V=t,this.vt=i,this.ut.Y(this.ct)}bt(t){const i=this.V.wt();i.length!==this.ct.length&&(this.dt=i.map(L),this.ct=this.dt.map((t=>{const i=new O;return i.tt(t),i})),this.ut.Y(this.ct)),this.ft=!0}gt(t,i,s){return this.ft&&(this.Mt(t),this.ft=!1),this.ut}Mt(t){const i=this.V.wt(),s=this.vt.St(),n=this.V.yt();i.forEach(((i,e)=>{var r;const h=this.dt[e],a=i.kt(s);if(null===a||!i.Ct())return void(h.it=null);const o=l(i.xt());h.lt=a.Tt,h.ht=a.ht,h.st[0]._t=a._t,h.st[0].et=i.Pt().Dt(a._t,o.Rt),h.rt=null!==(r=a.At)&&void 0!==r?r:this.V.Ot(h.st[0].et/t),h.st[0].ot=s,h.st[0].nt=n.Lt(s),h.it=E}))}}class I{constructor(t){this.Et=t}X(t,i,s,r){if(null===this.Et)return;const h=this.Et.Nt.Ct,l=this.Et.It.Ct;if(!h&&!l)return;t.save();const a=Math.round(this.Et.nt*i),o=Math.round(this.Et.et*i),_=Math.ceil(this.Et.Bt*i),u=Math.ceil(this.Et.Vt*i);t.lineCap="butt",h&&a>=0&&(t.lineWidth=Math.floor(this.Et.Nt.Ft*i),t.strokeStyle=this.Et.Nt.R,t.fillStyle=this.Et.Nt.R,n(t,this.Et.Nt.Wt),function(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(i+e,s),t.lineTo(i+e,n),t.stroke()}(t,a,0,u)),l&&o>=0&&(t.lineWidth=Math.floor(this.Et.It.Ft*i),t.strokeStyle=this.Et.It.R,t.fillStyle=this.Et.It.R,n(t,this.Et.It.Wt),e(t,o,0,_)),t.restore()}}class B{constructor(t){this.ft=!0,this.zt={Nt:{Ft:1,Wt:0,R:"",Ct:!1},It:{Ft:1,Wt:0,R:"",Ct:!1},Bt:0,Vt:0,nt:0,et:0},this.jt=new I(this.zt),this.Ht=t}bt(){this.ft=!0}gt(t,i){return this.ft&&(this.Mt(),this.ft=!1),this.jt}Mt(){const t=this.Ht.Ct(),i=l(this.Ht.$t()),s=i.Ut().F().crosshair,n=this.zt;n.It.Ct=t&&this.Ht.qt(i),n.Nt.Ct=t&&this.Ht.Yt(),n.It.Ft=s.horzLine.width,n.It.Wt=s.horzLine.style,n.It.R=s.horzLine.color,n.Nt.Ft=s.vertLine.width,n.Nt.Wt=s.vertLine.style,n.Nt.R=s.vertLine.color,n.Bt=i.Xt(),n.Vt=i.Zt(),n.nt=this.Ht.Kt(),n.et=this.Ht.Gt()}}function V(t,i,s,n,e,r){t.fillRect(i+r,s,n-2*r,r),t.fillRect(i+r,s+e-r,n-2*r,r),t.fillRect(i,s,r,e),t.fillRect(i+n-r,s,r,e)}function F(t,i,s){t.save(),t.scale(i,i),s(),t.restore()}function W(t,i,s,n,e,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,s,n,e),t.restore()}function z(t,i){return Array.isArray(t)?t.map((t=>0===t?t:t+i)):t+i}function j(t,i,s,n,e,r){let h,l,a,o;if(Array.isArray(r))if(2===r.length){const t=Math.max(0,r[0]),i=Math.max(0,r[1]);h=t,l=t,a=i,o=i}else{if(4!==r.length)throw new Error("Wrong border radius - it should be like css border radius");h=Math.max(0,r[0]),l=Math.max(0,r[1]),a=Math.max(0,r[2]),o=Math.max(0,r[3])}else{const t=Math.max(0,r);h=t,l=t,a=t,o=t}t.beginPath(),t.moveTo(i+h,s),t.lineTo(i+n-l,s),0!==l&&t.arcTo(i+n,s,i+n,s+l,l),t.lineTo(i+n,s+e-a),0!==a&&t.arcTo(i+n,s+e,i+n-a,s+e,a),t.lineTo(i+o,s+e),0!==o&&t.arcTo(i,s+e,i,s+e-o,o),t.lineTo(i,s+h),0!==h&&t.arcTo(i,s,i+h,s,h)}function H(t,i,s,n,e,r,h=0,l=0,a=""){if(t.save(),!h||!a||a===r)return j(t,i,s,n,e,l),t.fillStyle=r,t.fill(),void t.restore();const o=h/2;if("transparent"!==r){j(t,i+h,s+h,n-2*h,e-2*h,z(l,-h)),t.fillStyle=r,t.fill()}if("transparent"!==a){j(t,i+o,s+o,n-h,e-h,z(l,-o)),t.lineWidth=h,t.strokeStyle=a,t.closePath(),t.stroke()}}function $(t,i,s,n,e,r,h){t.save(),t.globalCompositeOperation="copy";const l=t.createLinearGradient(0,0,0,e);l.addColorStop(0,r),l.addColorStop(1,h),t.fillStyle=l,t.fillRect(i,s,n,e),t.restore()}class U{constructor(t,i){this.tt(t,i)}tt(t,i){this.Et=t,this.Jt=i}X(t,i,s,n,e,r){if(!this.Et.Ct)return;t.font=i.D;const h=this.Qt(t,i,s,n,e,r),l=this.Et.R||this.Jt.R,a=this.Jt.t;if(t.fillStyle=this.Jt.t,this.Et.ti){const s=(i,s)=>{h.ii?H(t,h.si,h.ni,h.ei,h.ri,i,h.hi,[h.ht,0,0,h.ht],s):H(t,h.li,h.ni,h.ei,h.ri,i,h.hi,[0,h.ht,h.ht,0],s)};s(a,"transparent"),this.Et.ai&&(t.fillStyle=l,t.fillRect(h.li,h.oi,h._i-h.li,h.ui)),s("transparent",a),this.Et.ci&&(t.fillStyle=i.A,t.fillRect(h.ii?h.di-h.hi:0,h.ni,h.hi,h.fi-h.ni)),t.save(),t.translate(h.pi,(h.ni+h.fi)/2+h.vi),F(t,r,(()=>{t.fillStyle=l,t.fillText(this.Et.ti,0,0)})),t.restore()}}Zt(t,i){return this.Et.Ct?t.T+t.I+t.O:0}Qt(t,i,s,n,e,r){const h=this.Et.ai||!this.Et.mi?i.C:0,l=i.k,a=i.I+this.Jt.bi,o=i.O+this.Jt.wi,_=i.L,u=i.N,c=this.Et.ti,d=i.T,f=s.gi(t,c)*r,p=d+a+o,v=l+_+u+Math.ceil(s.Mi(t,c))+h,m=Math.max(1,Math.floor(r));let b=Math.round(p*r);b%2!=m%2&&(b+=1);const w=this.Et.Si?Math.max(1,Math.floor(l*r)):0,g=Math.round(v*r),M=Math.round(h*r),S=Math.ceil(n*r),y=Math.ceil(_*r);let k=this.Jt.yi;this.Jt.ki&&(k=this.Jt.ki),k=Math.round(k*r)-Math.floor(.5*r);const C=Math.floor(k+m/2-b/2),x=C+b,T="right"===e,D=T?S-w:w,P=S;let R,A,O=D;const L=2*r;return t.textAlign=T?"right":"left",t.textBaseline="middle",T?(O=D-g,R=D-M,A=D-M-y-1):(O=D+g,R=D+M,A=D+M+y),{ii:T,ni:C,oi:k,fi:x,ei:g,ri:b,ht:L,hi:w,si:O,li:D,_i:R,pi:A,ui:m,di:P,vi:f}}}class q{constructor(t){this.Ci={yi:0,R:"#FFF",t:"#000",wi:0,bi:0},this.xi={ti:"",Ct:!1,ai:!0,mi:!1,At:"",R:"#FFF",ci:!1,Si:!1},this.Ti={ti:"",Ct:!1,ai:!1,mi:!0,At:"",R:"#FFF",ci:!0,Si:!0},this.ft=!0,this.Di=new(t||U)(this.xi,this.Ci),this.Pi=new(t||U)(this.Ti,this.Ci)}ti(){return this.Ri(),this.xi.ti}yi(){return this.Ri(),this.Ci.yi}bt(){this.ft=!0}Zt(t,i=!1){return Math.max(this.Di.Zt(t,i),this.Pi.Zt(t,i))}Ai(){return this.Ci.ki||0}Oi(t){this.Ci.ki=t}Li(){return this.Ri(),this.xi.Ct||this.Ti.Ct}Ei(){return this.Ri(),this.xi.Ct}gt(t){return this.Ri(),this.xi.ai=this.xi.ai&&t.F().ticksVisible,this.Ti.ai=this.Ti.ai&&t.F().ticksVisible,this.Di.tt(this.xi,this.Ci),this.Pi.tt(this.Ti,this.Ci),this.Di}Ni(){return this.Ri(),this.Di.tt(this.xi,this.Ci),this.Pi.tt(this.Ti,this.Ci),this.Pi}Ri(){this.ft&&(this.xi.ai=!0,this.Ti.ai=!1,this.Ii(this.xi,this.Ti,this.Ci))}}class Y extends q{constructor(t,i,s){super(),this.Ht=t,this.Bi=i,this.Vi=s}Ii(t,i,s){t.Ct=!1;const n=this.Ht.F().horzLine;if(!n.labelVisible)return;const e=this.Bi.xt();if(!this.Ht.Ct()||this.Bi.Fi()||null===e)return;const r=m(n.labelBackgroundColor);s.t=r.t,s.R=r.i;const h=2/12*this.Bi.T();s.bi=h,s.wi=h;const l=this.Vi(this.Bi);s.yi=l.yi,t.ti=this.Bi.Wi(l._t,e),t.Ct=!0}}const X=/[1-9]/g;class Z{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,s){if(null===this.Et||!1===this.Et.Ct||0===this.Et.ti.length)return;t.font=i.D;const n=Math.round(i.zi.Mi(t,this.Et.ti,X));if(n<=0)return;t.save();const e=i.ji,r=n+2*e,h=r/2,a=this.Et.Xt;let o=this.Et.yi,_=Math.floor(o-h)+.5;_<0?(o+=Math.abs(0-_),_=Math.floor(o-h)+.5):_+r>a&&(o-=Math.abs(a-(_+r)),_=Math.floor(o-h)+.5);const u=_+r,c=Math.ceil(0+i.k+i.C+i.I+i.T+i.O);t.fillStyle=this.Et.t;const d=Math.round(_*s),f=Math.round(0*s),p=Math.round(u*s),v=Math.round(c*s),m=Math.round(2*s);if(t.beginPath(),t.moveTo(d,f),t.lineTo(d,v-m),t.arcTo(d,v,d+m,v,m),t.lineTo(p-m,v),t.arcTo(p,v,p,v-m,m),t.lineTo(p,f),t.fill(),this.Et.ai){const n=Math.round(this.Et.yi*s),e=f,r=Math.round((e+i.C)*s);t.fillStyle=this.Et.R;const h=Math.max(1,Math.floor(s)),l=Math.floor(.5*s);t.fillRect(n-l,e,h,r-e)}const b=0+i.k+i.C+i.I+i.T/2;t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.Et.R;const w=i.zi.gi(t,"Apr0");t.translate((_+e)*s,(b+w)*s),F(t,s,(()=>t.fillText(l(this.Et).ti,0,0))),t.restore()}}class K{constructor(t,i,s){this.ft=!0,this.jt=new Z,this.zt={Ct:!1,t:"#4c525e",R:"white",ti:"",Xt:0,yi:NaN,ai:!0},this.vt=t,this.Hi=i,this.Vi=s}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.jt.tt(this.zt),this.jt}Mt(){const t=this.zt;t.Ct=!1;const i=this.vt.F().vertLine;if(!i.labelVisible)return;const s=this.Hi.yt();if(s.Fi())return;t.Xt=s.Xt();const n=this.Vi();if(!n.ot)return;t.yi=n.yi;const e=s.$i(this.vt.St());t.ti=s.Ui(l(e)),t.Ct=!0;const r=m(i.labelBackgroundColor);t.t=r.t,t.R=r.i,t.ai=s.F().ticksVisible}}class G{constructor(){this.qi=null,this.Yi=0}Xi(){return this.Yi}Zi(t){this.Yi=t}Pt(){return this.qi}Ki(t){this.qi=t}Gi(t){return[]}Ji(){return[]}Ct(){return!0}}var J;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(J||(J={}));class Q extends G{constructor(t,i){super(),this.Qi=null,this.ts=NaN,this.ss=0,this.ns=!0,this.es=new Map,this.rs=!1,this.hs=NaN,this.ls=NaN,this.os=NaN,this._s=NaN,this.Hi=t,this.us=i,this.cs=new N(t,this);this.ds=((t,i)=>s=>{const n=i(),e=t();if(s===l(this.Qi).fs())return{_t:e,yi:n};{const t=l(s.xt());return{_t:s.ps(n,t),yi:n}}})((()=>this.ts),(()=>this.ls));const s=((t,i)=>()=>({ot:this.Hi.yt().vs(t()),yi:i()}))((()=>this.ss),(()=>this.Kt()));this.bs=new K(this,t,s),this.ws=new B(this)}F(){return this.us}gs(t,i){this.os=t,this._s=i}Ms(){this.os=NaN,this._s=NaN}Ss(){return this.os}ys(){return this._s}ks(t,i,s){this.rs||(this.rs=!0),this.ns=!0,this.Cs(t,i,s)}St(){return this.ss}Kt(){return this.hs}Gt(){return this.ls}Ct(){return this.ns}xs(){this.ns=!1,this.Ts(),this.ts=NaN,this.hs=NaN,this.ls=NaN,this.Qi=null,this.Ms()}Ds(t){return null!==this.Qi?[this.ws,this.cs]:[]}qt(t){return t===this.Qi&&this.us.horzLine.visible}Yt(){return this.us.vertLine.visible}Ps(t,i){this.ns&&this.Qi===t||this.es.clear();const s=[];return this.Qi===t&&s.push(this.Rs(this.es,i,this.ds)),s}Ji(){return this.ns?[this.bs]:[]}$t(){return this.Qi}As(){this.ws.bt(),this.es.forEach((t=>t.bt())),this.bs.bt(),this.cs.bt()}Os(t){return t&&!t.fs().Fi()?t.fs():null}Cs(t,i,s){this.Ls(t,i,s)&&this.As()}Ls(t,i,s){const n=this.hs,e=this.ls,r=this.ts,h=this.ss,l=this.Qi,a=this.Os(s);this.ss=t,this.hs=isNaN(t)?NaN:this.Hi.yt().Lt(t),this.Qi=s;const o=null!==a?a.xt():null;return null!==a&&null!==o?(this.ts=i,this.ls=a.Dt(i,o)):(this.ts=NaN,this.ls=NaN),n!==this.hs||e!==this.ls||h!==this.ss||r!==this.ts||l!==this.Qi}Ts(){const t=this.Hi.wt().map((t=>t.Ns().Es())).filter(C),i=0===t.length?null:Math.max(...t);this.ss=null!==i?i:NaN}Rs(t,i,s){let n=t.get(i);return void 0===n&&(n=new Y(this,i,s),t.set(i,n)),n}}function tt(t){return"left"===t||"right"===t}class it{constructor(t){this.Is=new Map,this.Bs=[],this.Vs=t}Fs(t,i){const s=function(t,i){return void 0===t?i:{Ws:Math.max(t.Ws,i.Ws),zs:t.zs||i.zs}}(this.Is.get(t),i);this.Is.set(t,s)}js(){return this.Vs}Hs(t){const i=this.Is.get(t);return void 0===i?{Ws:this.Vs}:{Ws:Math.max(this.Vs,i.Ws),zs:i.zs}}$s(){this.Us(),this.Bs=[{qs:0}]}Ys(t){this.Us(),this.Bs=[{qs:1,Rt:t}]}Xs(t){this.Zs(),this.Bs.push({qs:5,Rt:t})}Us(){this.Zs(),this.Bs.push({qs:6})}Ks(){this.Us(),this.Bs=[{qs:4}]}Gs(t){this.Us(),this.Bs.push({qs:2,Rt:t})}Js(t){this.Us(),this.Bs.push({qs:3,Rt:t})}Qs(){return this.Bs}tn(t){for(const i of t.Bs)this.sn(i);this.Vs=Math.max(this.Vs,t.Vs),t.Is.forEach(((t,i)=>{this.Fs(i,t)}))}static nn(){return new it(2)}static en(){return new it(3)}sn(t){switch(t.qs){case 0:this.$s();break;case 1:this.Ys(t.Rt);break;case 2:this.Gs(t.Rt);break;case 3:this.Js(t.Rt);break;case 4:this.Ks();break;case 5:this.Xs(t.Rt);break;case 6:this.Zs()}}Zs(){const t=this.Bs.findIndex((t=>5===t.qs));-1!==t&&this.Bs.splice(t,1)}}const st=".";function nt(t,i){if(!g(t))return"n/a";if(!M(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}class et{constructor(t,i){if(i||(i=1),g(t)&&M(t)||(t=100),t<0)throw new TypeError("invalid base");this.Bi=t,this.rn=i,this.hn()}format(t){const i=t<0?"âˆ’":"";return t=Math.abs(t),i+this.ln(t)}hn(){if(this.an=0,this.Bi>0&&this.rn>0){let t=this.Bi;for(;t>1;)t/=10,this.an++}}ln(t){const i=this.Bi/this.rn;let s=Math.floor(t),n="";const e=void 0!==this.an?this.an:NaN;if(i>1){let r=+(Math.round(t*i)-s*i).toFixed(this.an);r>=i&&(r-=i,s+=1),n=st+nt(+r.toFixed(this.an)*this.rn,e)}else s=Math.round(s*i)/i,e>0&&(n=st+nt(0,e));return s.toFixed(0)+n}}class rt extends et{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class ht{constructor(t){this.on=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this._n(t):t<999995?i+this._n(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this._n(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this._n(t/1e9)+"B")}_n(t){let i;const s=Math.pow(10,this.on);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this.on).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function lt(t,i,s,n,e,r,h){if(0===i.length||n.from>=i.length)return;const l=i[n.from];let a=r(t,l),o=l;if(n.to-n.from<2){const i=e/2;t.beginPath();const s={nt:l.nt-i,et:l.et},n={nt:l.nt+i,et:l.et};return t.moveTo(s.nt,s.et),t.lineTo(n.nt,n.et),void h(t,a,s,n)}const _=(i,s)=>{h(t,a,o,s),t.beginPath(),a=i,o=s};let u=o;t.beginPath(),t.moveTo(l.nt,l.et);for(let e=n.from+1;e<n.to;++e){u=i[e];const n=r(t,u);switch(s){case 0:t.lineTo(u.nt,u.et);break;case 1:t.lineTo(u.nt,i[e-1].et),n!==a&&(_(n,u),t.lineTo(u.nt,i[e-1].et)),t.lineTo(u.nt,u.et);break;case 2:{const[s,n]=_t(i,e-1,e);t.bezierCurveTo(s.nt,s.et,n.nt,n.et,u.nt,u.et);break}}1!==s&&n!==a&&(_(n,u),t.moveTo(u.nt,u.et))}(o!==u||o===u&&1===s)&&h(t,a,o,u)}function at(t,i){return{nt:t.nt-i.nt,et:t.et-i.et}}function ot(t,i){return{nt:t.nt/i,et:t.et/i}}function _t(t,i,s){const n=Math.max(0,i-1),e=Math.min(t.length-1,s+1);var r,h;return[(r=t[i],h=ot(at(t[s],t[n]),6),{nt:r.nt+h.nt,et:r.et+h.et}),at(t[s],ot(at(t[e],t[i]),6))]}function ut(t,i,s,n,e){i.lineTo(e.nt,t),i.lineTo(n.nt,t),i.closePath(),i.fillStyle=s,i.fill()}class ct extends A{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J)return;const{st:i,it:s,un:e,Ft:r,Wt:h,cn:l,dn:a}=this.J;null!==s&&(t.lineCap="butt",t.lineJoin="round",t.lineWidth=r,n(t,h),t.lineWidth=1,lt(t,i,l,s,e,this.fn.bind(this),ut.bind(null,a)))}}class dt extends ct{constructor(){super(...arguments),this.pn=null}fn(t,i){const s=this.J,{vn:n,mn:e}=i,r=s.bn;if(null!==this.pn&&this.pn.topColor===n&&this.pn.bottomColor===e&&this.pn.bottom===r)return this.pn.fillStyle;const h=t.createLinearGradient(0,0,0,r);return h.addColorStop(0,n),h.addColorStop(1,e),this.pn={topColor:n,bottomColor:e,fillStyle:h,bottom:r},h}}function ft(t,i){t.strokeStyle=i,t.stroke()}class pt extends A{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J)return;const{st:i,it:s,un:e,cn:r,Ft:h,Wt:l}=this.J;null!==s&&(t.lineCap="butt",t.lineWidth=h,n(t,l),t.lineJoin="round",lt(t,i,r,s,e,this.wn.bind(this),ft))}}class vt extends pt{wn(t,i){return i.lt}}function mt(t,i,s,n=0,e=t.length){let r=e-n;for(;0<r;){const e=r>>1,h=n+e;s(t[h],i)?(n=h+1,r-=e+1):r=e}return n}function bt(t,i,s,n=0,e=t.length){let r=e-n;for(;0<r;){const e=r>>1,h=n+e;s(i,t[h])?r=e:(n=h+1,r-=e+1)}return n}function wt(t,i){return t.ot<i}function gt(t,i){return t<i.ot}function Mt(t,i,s){const n=i.gn(),e=i.Mn(),r=mt(t,n,wt),h=bt(t,e,gt);if(!s)return{from:r,to:h};let l=r,a=h;return r>0&&r<t.length&&t[r].ot>=n&&(l=r-1),h>0&&h<t.length&&t[h-1].ot<=e&&(a=h+1),{from:l,to:a}}class St{constructor(t,i,s){this.Sn=!0,this.yn=!0,this.kn=!0,this.Cn=[],this.xn=null,this.Tn=t,this.Dn=i,this.Pn=s}bt(t){this.Sn=!0,"data"===t&&(this.yn=!0),"options"===t&&(this.kn=!0)}gt(t,i){return this.Tn.Ct()?(this.Rn(i,t),null===this.xn?null:this.An):null}On(){this.Cn=this.Cn.map((t=>Object.assign(Object.assign({},t),this.Tn.En().Ln(t.ot))))}Nn(){this.xn=null}Rn(t,i){this.yn&&(this.In(),this.yn=!1),this.kn&&(this.On(),this.kn=!1),this.Sn&&(this.Bn(t,i),this.Sn=!1)}Bn(t,i){const s=this.Tn.Pt(),n=this.Dn.yt();if(this.Nn(),n.Fi()||s.Fi())return;const e=n.Vn();if(null===e)return;if(0===this.Tn.Ns().Fn())return;const r=this.Tn.xt();null!==r&&(this.xn=Mt(this.Cn,e,this.Pn),this.Wn(s,n,r.Rt),this.zn(t,i))}}class yt extends St{constructor(t,i){super(t,i,!0)}Wn(t,i,s){i.jn(this.Cn,x(this.xn)),t.Hn(this.Cn,s,x(this.xn))}$n(t,i){return{ot:t,_t:i,nt:NaN,et:NaN}}In(){const t=this.Tn.En();this.Cn=this.Tn.Ns().Un().map((i=>{const s=i.Rt[3];return this.qn(i.Yn,s,t)}))}}class kt extends yt{constructor(t,i){super(t,i),this.An=new R,this.Xn=new dt,this.Zn=new vt,this.An.Y([this.Xn,this.Zn])}qn(t,i,s){return Object.assign(Object.assign({},this.$n(t,i)),s.Ln(t))}zn(t,i){const s=this.Tn.F();this.Xn.tt({cn:s.lineType,st:this.Cn,Wt:s.lineStyle,Ft:s.lineWidth,dn:i,bn:i,it:this.xn,un:this.Dn.yt().Kn()}),this.Zn.tt({cn:s.lineType,st:this.Cn,Wt:s.lineStyle,Ft:s.lineWidth,it:this.xn,un:this.Dn.yt().Kn()})}}class Ct{constructor(){this.Et=null,this.Gn=0,this.Jn=0}tt(t){this.Et=t}X(t,i,s,n){if(null===this.Et||0===this.Et.Ns.length||null===this.Et.it)return;if(this.Gn=this.Qn(i),this.Gn>=2){Math.max(1,Math.floor(i))%2!=this.Gn%2&&this.Gn--}this.Jn=this.Et.te?Math.min(this.Gn,Math.floor(i)):this.Gn;let e=null;const r=this.Jn<=this.Gn&&this.Et.Kn>=Math.floor(1.5*i);for(let s=this.Et.it.from;s<this.Et.it.to;++s){const n=this.Et.Ns[s];e!==n.ie&&(t.fillStyle=n.ie,e=n.ie);const h=Math.floor(.5*this.Jn),l=Math.round(n.nt*i),a=l-h,o=this.Jn,_=a+o-1,u=Math.min(n.se,n.ne),c=Math.max(n.se,n.ne),d=Math.round(u*i)-h,f=Math.round(c*i)+h,p=Math.max(f-d,this.Jn);t.fillRect(a,d,o,p);const v=Math.ceil(1.5*this.Gn);if(r){if(this.Et.ee){const s=l-v;let e=Math.max(d,Math.round(n.re*i)-h),r=e+o-1;r>d+p-1&&(r=d+p-1,e=r-o+1),t.fillRect(s,e,a-s,r-e+1)}const s=l+v;let e=Math.max(d,Math.round(n.he*i)-h),r=e+o-1;r>d+p-1&&(r=d+p-1,e=r-o+1),t.fillRect(_+1,e,s-_,r-e+1)}}}Qn(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(l(this.Et).Kn,t)))}}class xt extends St{constructor(t,i){super(t,i,!1)}Wn(t,i,s){i.jn(this.Cn,x(this.xn)),t.le(this.Cn,s,x(this.xn))}ae(t,i,s){return{ot:t,oe:i.Rt[0],_e:i.Rt[1],ue:i.Rt[2],ce:i.Rt[3],nt:NaN,re:NaN,se:NaN,ne:NaN,he:NaN}}In(){const t=this.Tn.En();this.Cn=this.Tn.Ns().Un().map((i=>this.qn(i.Yn,i,t)))}}class Tt extends xt{constructor(){super(...arguments),this.An=new Ct}qn(t,i,s){return Object.assign(Object.assign({},this.ae(t,i,s)),s.Ln(t))}zn(){const t=this.Tn.F();this.An.tt({Ns:this.Cn,Kn:this.Dn.yt().Kn(),ee:t.openVisible,te:t.thinBars,it:this.xn})}}function Dt(t,i,s){return Math.min(Math.max(t,i),s)}function Pt(t,i,s){return i-t<=s}function Rt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function At(t){const i=Math.ceil(t);return i%2==0?i-1:i}class Ot extends ct{constructor(){super(...arguments),this.pn=null}fn(t,i){const s=this.J,{de:n,fe:e,pe:r,ve:h}=i,{dn:l,bn:a}=s;if(null!==this.pn&&this.pn.topFillColor1===n&&this.pn.topFillColor2===e&&this.pn.bottomFillColor1===r&&this.pn.bottomFillColor2===h&&this.pn.baseLevelCoordinate===l&&this.pn.bottom===a)return this.pn.fillStyle;const o=t.createLinearGradient(0,0,0,a),_=Dt(l/a,0,1);return o.addColorStop(0,n),o.addColorStop(_,e),o.addColorStop(_,r),o.addColorStop(1,h),this.pn={topFillColor1:n,topFillColor2:e,bottomFillColor1:r,bottomFillColor2:h,fillStyle:o,baseLevelCoordinate:l,bottom:a},o}}class Lt extends pt{constructor(){super(...arguments),this.me=null}wn(t,i){const s=this.J,{be:n,we:e}=i,{dn:r,bn:h}=s;if(null!==this.me&&this.me.topLineColor===n&&this.me.bottomLineColor===e&&this.me.baseLevelCoordinate===r&&this.me.bottom===h)return this.me.strokeStyle;const l=t.createLinearGradient(0,0,0,h),a=Dt(r/h,0,1);return l.addColorStop(0,n),l.addColorStop(a,n),l.addColorStop(a,e),l.addColorStop(1,e),this.me={topLineColor:n,bottomLineColor:e,strokeStyle:l,baseLevelCoordinate:r,bottom:h},l}}class Et extends yt{constructor(t,i){super(t,i),this.An=new R,this.ge=new Ot,this.Me=new Lt,this.An.Y([this.ge,this.Me])}qn(t,i,s){return Object.assign(Object.assign({},this.$n(t,i)),s.Ln(t))}zn(t,i){const s=this.Tn.xt();if(null===s)return;const n=this.Tn.F(),e=this.Tn.Pt().Dt(n.baseValue.price,s.Rt),r=this.Dn.yt().Kn();this.ge.tt({st:this.Cn,Ft:n.lineWidth,Wt:n.lineStyle,cn:n.lineType,dn:e,bn:i,it:this.xn,un:r}),this.Me.tt({st:this.Cn,Ft:n.lineWidth,Wt:n.lineStyle,cn:n.lineType,dn:e,bn:i,it:this.xn,un:r})}}class Nt{constructor(){this.Et=null,this.Gn=0}tt(t){this.Et=t}X(t,i,s,n){if(null===this.Et||0===this.Et.Ns.length||null===this.Et.it)return;if(this.Gn=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const s=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),n=Math.floor(t*s*i),e=Math.floor(t*i),r=Math.min(n,e);return Math.max(Math.floor(i),r)}(this.Et.Kn,i),this.Gn>=2){Math.floor(i)%2!=this.Gn%2&&this.Gn--}const e=this.Et.Ns;this.Et.Se&&this.ye(t,e,this.Et.it,i),this.Et.ci&&this.ke(t,e,this.Et.it,this.Et.Kn,i);const r=this.Ce(i);(!this.Et.ci||this.Gn>2*r)&&this.xe(t,e,this.Et.it,i)}ye(t,i,s,n){if(null===this.Et)return;let e="",r=Math.min(Math.floor(n),Math.floor(this.Et.Kn*n));r=Math.max(Math.floor(n),Math.min(r,this.Gn));const h=Math.floor(.5*r);let l=null;for(let a=s.from;a<s.to;a++){const s=i[a];s.Te!==e&&(t.fillStyle=s.Te,e=s.Te);const o=Math.round(Math.min(s.re,s.he)*n),_=Math.round(Math.max(s.re,s.he)*n),u=Math.round(s.se*n),c=Math.round(s.ne*n);let d=Math.round(n*s.nt)-h;const f=d+r-1;null!==l&&(d=Math.max(l+1,d),d=Math.min(d,f));const p=f-d+1;t.fillRect(d,u,p,o-u),t.fillRect(d,_+1,p,c-_),l=f}}Ce(t){let i=Math.floor(1*t);this.Gn<=2*i&&(i=Math.floor(.5*(this.Gn-1)));const s=Math.max(Math.floor(t),i);return this.Gn<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}ke(t,i,s,n,e){if(null===this.Et)return;let r="";const h=this.Ce(e);let l=null;for(let n=s.from;n<s.to;n++){const s=i[n];s.De!==r&&(t.fillStyle=s.De,r=s.De);let a=Math.round(s.nt*e)-Math.floor(.5*this.Gn);const o=a+this.Gn-1,_=Math.round(Math.min(s.re,s.he)*e),u=Math.round(Math.max(s.re,s.he)*e);if(null!==l&&(a=Math.max(l+1,a),a=Math.min(a,o)),this.Et.Kn*e>2*h)V(t,a,_,o-a+1,u-_+1,h);else{const i=o-a+1;t.fillRect(a,_,i,u-_+1)}l=o}}xe(t,i,s,n){if(null===this.Et)return;let e="";const r=this.Ce(n);for(let h=s.from;h<s.to;h++){const s=i[h];let l=Math.round(Math.min(s.re,s.he)*n),a=Math.round(Math.max(s.re,s.he)*n),o=Math.round(s.nt*n)-Math.floor(.5*this.Gn),_=o+this.Gn-1;if(s.ie!==e){const i=s.ie;t.fillStyle=i,e=i}this.Et.ci&&(o+=r,l+=r,_-=r,a-=r),l>a||t.fillRect(o,l,_-o+1,a-l+1)}}}class It extends xt{constructor(){super(...arguments),this.An=new Nt}qn(t,i,s){return Object.assign(Object.assign({},this.ae(t,i,s)),s.Ln(t))}zn(){const t=this.Tn.F();this.An.tt({Ns:this.Cn,Kn:this.Dn.yt().Kn(),Se:t.wickVisible,ci:t.borderVisible,it:this.xn})}}class Bt{constructor(){this.Et=null,this.Pe=[]}tt(t){this.Et=t,this.Pe=[]}X(t,i,s,n){if(null===this.Et||0===this.Et.st.length||null===this.Et.it)return;this.Pe.length||this.Re(i);const e=Math.max(1,Math.floor(i)),r=Math.round(this.Et.Ae*i)-Math.floor(e/2),h=r+e;for(let s=this.Et.it.from;s<this.Et.it.to;s++){const n=this.Et.st[s],l=this.Pe[s-this.Et.it.from],a=Math.round(n.et*i);let o,_;t.fillStyle=n.ie,a<=r?(o=a,_=h):(o=r,_=a-Math.floor(e/2)+e),t.fillRect(l.gn,o,l.Mn-l.gn+1,_-o)}}Re(t){if(null===this.Et||0===this.Et.st.length||null===this.Et.it)return void(this.Pe=[]);const i=Math.ceil(this.Et.Kn*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.Et.Kn*t)-i;this.Pe=new Array(this.Et.it.to-this.Et.it.from);for(let i=this.Et.it.from;i<this.Et.it.to;i++){const n=this.Et.st[i],e=Math.round(n.nt*t);let r,h;if(s%2){const t=(s-1)/2;r=e-t,h=e+t}else{const t=s/2;r=e-t,h=e+t-1}this.Pe[i-this.Et.it.from]={gn:r,Mn:h,Oe:e,Le:n.nt*t,ot:n.ot}}for(let t=this.Et.it.from+1;t<this.Et.it.to;t++){const s=this.Pe[t-this.Et.it.from],n=this.Pe[t-this.Et.it.from-1];s.ot===n.ot+1&&(s.gn-n.Mn!==i+1&&(n.Oe>n.Le?n.Mn=s.gn-i-1:s.gn=n.Mn+i+1))}let n=Math.ceil(this.Et.Kn*t);for(let t=this.Et.it.from;t<this.Et.it.to;t++){const i=this.Pe[t-this.Et.it.from];i.Mn<i.gn&&(i.Mn=i.gn);const s=i.Mn-i.gn+1;n=Math.min(s,n)}if(i>0&&n<4)for(let t=this.Et.it.from;t<this.Et.it.to;t++){const i=this.Pe[t-this.Et.it.from];i.Mn-i.gn+1>n&&(i.Oe>i.Le?i.Mn-=1:i.gn+=1)}}}class Vt extends yt{constructor(){super(...arguments),this.An=new Bt}qn(t,i,s){return Object.assign(Object.assign({},this.$n(t,i)),s.Ln(t))}zn(){const t={st:this.Cn,Kn:this.Dn.yt().Kn(),it:this.xn,Ae:this.Tn.Pt().Dt(this.Tn.F().base,l(this.Tn.xt()).Rt)};this.An.tt(t)}}class Ft extends yt{constructor(){super(...arguments),this.An=new vt}qn(t,i,s){return Object.assign(Object.assign({},this.$n(t,i)),s.Ln(t))}zn(){const t=this.Tn.F(),i={st:this.Cn,Wt:t.lineStyle,cn:t.lineType,Ft:t.lineWidth,it:this.xn,un:this.Dn.yt().Kn()};this.An.tt(i)}}const Wt=/[2-9]/g;class zt{constructor(t=50){this.Ee=0,this.Ne=1,this.Ie=1,this.Be={},this.Ve=new Map,this.Fe=t}We(){this.Ee=0,this.Ve.clear(),this.Ne=1,this.Ie=1,this.Be={}}Mi(t,i,s){return this.ze(t,i,s).width}gi(t,i,s){const n=this.ze(t,i,s);return((n.actualBoundingBoxAscent||0)-(n.actualBoundingBoxDescent||0))/2}ze(t,i,s){const n=s||Wt,e=String(i).replace(n,"0");if(this.Ve.has(e))return h(this.Ve.get(e)).je;if(this.Ee===this.Fe){const t=this.Be[this.Ie];delete this.Be[this.Ie],this.Ve.delete(t),this.Ie++,this.Ee--}t.save(),t.textBaseline="middle";const r=t.measureText(e);return t.restore(),0===r.width&&i.length||(this.Ve.set(e,{je:r,He:this.Ne}),this.Be[this.Ne]=e,this.Ee++,this.Ne++),r}}class jt{constructor(t){this.$e=null,this.S=null,this.Ue="right",this.qe=0,this.Ye=t}Xe(t,i,s,n){this.$e=t,this.S=i,this.qe=s,this.Ue=n}X(t,i){null!==this.S&&null!==this.$e&&this.$e.X(t,this.S,this.Ye,this.qe,this.Ue,i)}}class Ht{constructor(t,i,s){this.Ze=t,this.Ye=new zt(50),this.Ke=i,this.V=s,this.W=-1,this.jt=new jt(this.Ye)}gt(t,i){const s=this.V.Ge(this.Ke);if(null===s)return null;const n=s.Je(this.Ke)?s.Qe():this.Ke.Pt();if(null===n)return null;const e=s.tr(n);if("overlay"===e)return null;const r=this.V.ir();return r.T!==this.W&&(this.W=r.T,this.Ye.We()),this.jt.Xe(this.Ze.Ni(),r,i,e),this.jt}}class $t{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,s,r){if(null===this.Et)return;if(!1===this.Et.Ct)return;const h=Math.round(this.Et.et*i);if(h<0||h>Math.ceil(this.Et.Zt*i))return;const l=Math.ceil(this.Et.Xt*i);t.lineCap="butt",t.strokeStyle=this.Et.R,t.lineWidth=Math.floor(this.Et.Ft*i),n(t,this.Et.Wt),e(t,h,0,l)}}class Ut{constructor(t){this.sr={Xt:0,Zt:0,et:0,R:"rgba(0, 0, 0, 0)",Ft:1,Wt:0,Ct:!1},this.nr=new $t,this.ft=!0,this.Tn=t,this.Dn=t.Ut(),this.nr.tt(this.sr)}bt(){this.ft=!0}gt(t,i){return this.Tn.Ct()?(this.ft&&(this.er(t,i),this.ft=!1),this.nr):null}}class qt extends Ut{constructor(t){super(t)}er(t,i){this.sr.Ct=!1;const s=this.Tn.Pt(),n=s.rr().rr;if(2!==n&&3!==n)return;const e=this.Tn.F();if(!e.baseLineVisible||!this.Tn.Ct())return;const r=this.Tn.xt();null!==r&&(this.sr.Ct=!0,this.sr.et=s.Dt(r.Rt,r.Rt),this.sr.Xt=i,this.sr.Zt=t,this.sr.R=e.baseLineColor,this.sr.Ft=e.baseLineWidth,this.sr.Wt=e.baseLineStyle)}}class Yt{constructor(){this.Et=null}tt(t){this.Et=t}hr(){return this.Et}X(t,i,s,n){const e=this.Et;if(null===e)return;t.save();const r=Math.max(1,Math.floor(i)),h=r%2/2,l=Math.round(e.Le.x*i)+h,a=e.Le.y*i;t.fillStyle=e.lr,t.beginPath();const o=Math.max(2,1.5*e.ar)*i;t.arc(l,a,o,0,2*Math.PI,!1),t.fill(),t.fillStyle=e._r,t.beginPath(),t.arc(l,a,e.ht*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=r,t.strokeStyle=e.ur,t.beginPath(),t.arc(l,a,e.ht*i+r/2,0,2*Math.PI,!1),t.stroke(),t.restore()}}const Xt=[{cr:0,dr:.25,pr:4,vr:10,mr:.25,br:0,wr:.4,gr:.8},{cr:.25,dr:.525,pr:10,vr:14,mr:0,br:0,wr:.8,gr:0},{cr:.525,dr:1,pr:14,vr:14,mr:0,br:0,wr:0,gr:0}];function Zt(t,i,s,n){return function(t,i){if("transparent"===t)return t;const s=v(t),n=s[3];return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${i*n})`}(t,s+(n-s)*i)}function Kt(t,i){const s=t%2600/2600;let n;for(const t of Xt)if(s>=t.cr&&s<=t.dr){n=t;break}r(void 0!==n,"Last price animation internal logic error");const e=(s-n.cr)/(n.dr-n.cr);return{_r:Zt(i,e,n.mr,n.br),ur:Zt(i,e,n.wr,n.gr),ht:(h=e,l=n.pr,a=n.vr,l+(a-l)*h)};var h,l,a}class Gt{constructor(t){this.jt=new Yt,this.ft=!0,this.Mr=!0,this.Sr=performance.now(),this.yr=this.Sr-1,this.kr=t}Cr(){this.yr=this.Sr-1,this.bt()}Tr(){if(this.bt(),2===this.kr.F().lastPriceAnimation){const t=performance.now(),i=this.yr-t;if(i>0)return void(i<650&&(this.yr+=2600));this.Sr=t,this.yr=t+2600}}bt(){this.ft=!0}Dr(){this.Mr=!0}Ct(){return 0!==this.kr.F().lastPriceAnimation}Pr(){switch(this.kr.F().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.yr}}gt(t,i){return this.ft?(this.Mt(t,i),this.ft=!1,this.Mr=!1):this.Mr&&(this.Rr(),this.Mr=!1),this.jt}Mt(t,i){this.jt.tt(null);const s=this.kr.Ut().yt(),n=s.Vn(),e=this.kr.xt();if(null===n||null===e)return;const r=this.kr.Ar(!0);if(r.Or||!n.Lr(r.Yn))return;const h={x:s.Lt(r.Yn),y:this.kr.Pt().Dt(r._t,e.Rt)},l=r.R,a=this.kr.F().lineWidth,o=Kt(this.Er(),l);this.jt.tt({lr:l,ar:a,_r:o._r,ur:o.ur,ht:o.ht,Le:h})}Rr(){const t=this.jt.hr();if(null!==t){const i=Kt(this.Er(),t.lr);t._r=i._r,t.ur=i.ur,t.ht=i.ht}}Er(){return this.Pr()?performance.now()-this.Sr:2599}}function Jt(t,i){return At(Math.min(Math.max(t,12),30)*i)}function Qt(t,i){switch(t){case"arrowDown":case"arrowUp":return Jt(i,1);case"circle":return Jt(i,.8);case"square":return Jt(i,.7)}}function ti(t){return function(t){const i=Math.ceil(t);return i%2!=0?i-1:i}(Jt(t,1))}function ii(t){return Math.max(Jt(t,.1),3)}function si(t,i,s,n,e){const r=Qt("square",s),h=(r-1)/2,l=t-h,a=i-h;return n>=l&&n<=l+r&&e>=a&&e<=a+r}function ni(t,i,s,n,e){const r=(Qt("arrowUp",e)-1)/2,h=(At(e/2)-1)/2;i.beginPath(),t?(i.moveTo(s-r,n),i.lineTo(s,n-r),i.lineTo(s+r,n),i.lineTo(s+h,n),i.lineTo(s+h,n+r),i.lineTo(s-h,n+r),i.lineTo(s-h,n)):(i.moveTo(s-r,n),i.lineTo(s,n+r),i.lineTo(s+r,n),i.lineTo(s+h,n),i.lineTo(s+h,n-r),i.lineTo(s-h,n-r),i.lineTo(s-h,n)),i.fill()}function ei(t,i,s,n,e,r){return si(i,s,n,e,r)}class ri extends A{constructor(){super(...arguments),this.Et=null,this.Ye=new zt,this.W=-1,this.j="",this.Nr=""}tt(t){this.Et=t}Xe(t,i){this.W===t&&this.j===i||(this.W=t,this.j=i,this.Nr=D(t,i),this.Ye.We())}Ir(t,i){if(null===this.Et||null===this.Et.it)return null;for(let s=this.Et.it.from;s<this.Et.it.to;s++){const n=this.Et.st[s];if(li(n,t,i))return{Br:n.Vr,Fr:n.Fr}}return null}Z(t,i,s){if(null!==this.Et&&null!==this.Et.it){t.textBaseline="middle",t.font=this.Nr;for(let i=this.Et.it.from;i<this.Et.it.to;i++){const s=this.Et.st[i];void 0!==s.ti&&(s.ti.Xt=this.Ye.Mi(t,s.ti.Wr),s.ti.Zt=this.W),hi(s,t)}}}}function hi(t,i){i.fillStyle=t.R,void 0!==t.ti&&function(t,i,s,n){t.fillText(i,s,n)}(i,t.ti.Wr,t.nt-t.ti.Xt/2,t.ti.et),function(t,i){if(0===t.Fn)return;switch(t.zr){case"arrowDown":return void ni(!1,i,t.nt,t.et,t.Fn);case"arrowUp":return void ni(!0,i,t.nt,t.et,t.Fn);case"circle":return void function(t,i,s,n){const e=(Qt("circle",n)-1)/2;t.beginPath(),t.arc(i,s,e,0,2*Math.PI,!1),t.fill()}(i,t.nt,t.et,t.Fn);case"square":return void function(t,i,s,n){const e=Qt("square",n),r=(e-1)/2,h=i-r,l=s-r;t.fillRect(h,l,e,e)}(i,t.nt,t.et,t.Fn)}t.zr}(t,i)}function li(t,i,s){return!(void 0===t.ti||!function(t,i,s,n,e,r){const h=n/2;return e>=t&&e<=t+s&&r>=i-h&&r<=i+h}(t.nt,t.ti.et,t.ti.Xt,t.ti.Zt,i,s))||function(t,i,s){if(0===t.Fn)return!1;switch(t.zr){case"arrowDown":case"arrowUp":return ei(0,t.nt,t.et,t.Fn,i,s);case"circle":return function(t,i,s,n,e){const r=2+Qt("circle",s)/2,h=t-n,l=i-e;return Math.sqrt(h*h+l*l)<=r}(t.nt,t.et,t.Fn,i,s);case"square":return si(t.nt,t.et,t.Fn,i,s)}}(t,i,s)}function ai(t,i,s,n,e,r,h,l,a){const o=g(s)?s:s.ce,_=g(s)?s:s._e,u=g(s)?s:s.ue,c=g(i.size)?Math.max(i.size,0):1,d=ti(l.Kn())*c,f=d/2;switch(t.Fn=d,i.position){case"inBar":return t.et=h.Dt(o,a),void(void 0!==t.ti&&(t.ti.et=t.et+f+r+.6*e));case"aboveBar":return t.et=h.Dt(_,a)-f-n.jr,void 0!==t.ti&&(t.ti.et=t.et-f-.6*e,n.jr+=1.2*e),void(n.jr+=d+r);case"belowBar":return t.et=h.Dt(u,a)+f+n.Hr,void 0!==t.ti&&(t.ti.et=t.et+f+r+.6*e,n.Hr+=1.2*e),void(n.Hr+=d+r)}i.position}class oi{constructor(t,i){this.ft=!0,this.$r=!0,this.Ur=!0,this.qr=null,this.jt=new ri,this.kr=t,this.Hi=i,this.Et={st:[],it:null}}bt(t){this.ft=!0,this.Ur=!0,"data"===t&&(this.$r=!0)}gt(t,i,s){if(!this.kr.Ct())return null;this.ft&&this.Yr();const n=this.Hi.F().layout;return this.jt.Xe(n.fontSize,n.fontFamily),this.jt.tt(this.Et),this.jt}Xr(){if(this.Ur){if(this.kr.Zr().length>0){const t=this.Hi.yt().Kn(),i=ii(t),s=1.5*ti(t)+2*i;this.qr={above:s,below:s}}else this.qr=null;this.Ur=!1}return this.qr}Yr(){const t=this.kr.Pt(),i=this.Hi.yt(),s=this.kr.Zr();this.$r&&(this.Et.st=s.map((t=>({ot:t.time,nt:0,et:0,Fn:0,zr:t.shape,R:t.color,Vr:t.internalId,Fr:t.id,ti:void 0}))),this.$r=!1);const n=this.Hi.F().layout;this.Et.it=null;const e=i.Vn();if(null===e)return;const r=this.kr.xt();if(null===r)return;if(0===this.Et.st.length)return;let h=NaN;const l=ii(i.Kn()),a={jr:l,Hr:l};this.Et.it=Mt(this.Et.st,e,!0);for(let e=this.Et.it.from;e<this.Et.it.to;e++){const o=s[e];o.time!==h&&(a.jr=l,a.Hr=l,h=o.time);const _=this.Et.st[e];_.nt=i.Lt(o.time),void 0!==o.text&&o.text.length>0&&(_.ti={Wr:o.text,et:0,Xt:0,Zt:0});const u=this.kr.Kr(o.time);null!==u&&ai(_,o,u,a,n.fontSize,l,t,i,r.Rt)}this.ft=!1}}class _i extends Ut{constructor(t){super(t)}er(t,i){const s=this.sr;s.Ct=!1;const n=this.Tn.F();if(!n.priceLineVisible||!this.Tn.Ct())return;const e=this.Tn.Ar(0===n.priceLineSource);e.Or||(s.Ct=!0,s.et=e.yi,s.R=this.Tn.Gr(e.R),s.Xt=i,s.Zt=t,s.Ft=n.priceLineWidth,s.Wt=n.priceLineStyle)}}class ui extends q{constructor(t){super(),this.Ht=t}Ii(t,i,s){t.Ct=!1,i.Ct=!1;const n=this.Ht;if(!n.Ct())return;const e=n.F(),r=e.lastValueVisible,h=""!==n.Jr(),l=0===e.seriesLastValueMode,a=n.Ar(!1);if(a.Or)return;r&&(t.ti=this.Qr(a,r,l),t.Ct=0!==t.ti.length),(h||l)&&(i.ti=this.th(a,r,h,l),i.Ct=i.ti.length>0);const o=n.Gr(a.R),_=m(o);s.t=_.t,s.R=_.i,s.yi=a.yi,i.At=n.Ut().Ot(a.yi/n.Pt().Zt()),t.At=o,t.R=s.R,i.R=s.R}th(t,i,s,n){let e="";const r=this.Ht.Jr();return s&&0!==r.length&&(e+=`${r} `),i&&n&&(e+=this.Ht.Pt().ih()?t.sh:t.nh),e.trim()}Qr(t,i,s){return i?s?this.Ht.Pt().ih()?t.nh:t.sh:t.ti:""}}class ci{constructor(t,i){this.eh=t,this.rh=i}hh(t){return null!==t&&(this.eh===t.eh&&this.rh===t.rh)}lh(){return new ci(this.eh,this.rh)}ah(){return this.eh}oh(){return this.rh}_h(){return this.rh-this.eh}Fi(){return this.rh===this.eh||Number.isNaN(this.rh)||Number.isNaN(this.eh)}tn(t){return null===t?this:new ci(Math.min(this.ah(),t.ah()),Math.max(this.oh(),t.oh()))}uh(t){if(!g(t))return;if(0===this.rh-this.eh)return;const i=.5*(this.rh+this.eh);let s=this.rh-i,n=this.eh-i;s*=t,n*=t,this.rh=i+s,this.eh=i+n}dh(t){g(t)&&(this.rh+=t,this.eh+=t)}fh(){return{minValue:this.eh,maxValue:this.rh}}static ph(t){return null===t?null:new ci(t.minValue,t.maxValue)}}class di{constructor(t,i){this.mh=t,this.bh=i||null}wh(){return this.mh}gh(){return this.bh}fh(){return null===this.mh?null:{priceRange:this.mh.fh(),margins:this.bh||void 0}}static ph(t){return null===t?null:new di(ci.ph(t.priceRange),t.margins)}}class fi extends Ut{constructor(t,i){super(t),this.Mh=i}er(t,i){const s=this.sr;s.Ct=!1;const n=this.Mh.F();if(!this.Tn.Ct()||!n.lineVisible)return;const e=this.Mh.Sh();null!==e&&(s.Ct=!0,s.et=e,s.R=n.color,s.Xt=i,s.Zt=t,s.Ft=n.lineWidth,s.Wt=n.lineStyle)}}class pi extends q{constructor(t,i){super(),this.kr=t,this.Mh=i}Ii(t,i,s){t.Ct=!1,i.Ct=!1;const n=this.Mh.F(),e=n.axisLabelVisible,r=""!==n.title,h=this.kr;if(!e||!h.Ct())return;const l=this.Mh.Sh();if(null===l)return;r&&(i.ti=n.title,i.Ct=!0),i.At=h.Ut().Ot(l/h.Pt().Zt()),t.ti=this.yh(n.price),t.Ct=!0;const a=m(n.color);s.t=a.t,s.R=a.i,s.yi=l}yh(t){const i=this.kr.xt();return null===i?"":this.kr.Pt().Wi(t,i.Rt)}}class vi{constructor(t,i){this.kr=t,this.us=i,this.kh=new fi(t,this),this.Ze=new pi(t,this),this.Ch=new Ht(this.Ze,t,t.Ut())}xh(t){w(this.us,t),this.bt(),this.kr.Ut().Th()}F(){return this.us}Dh(){return this.kh}Ph(){return this.Ch}Rh(){return this.Ze}bt(){this.kh.bt(),this.Ze.bt()}Sh(){const t=this.kr,i=t.Pt();if(t.Ut().yt().Fi()||i.Fi())return null;const s=t.xt();return null===s?null:i.Dt(this.us.price,s.Rt)}}class mi extends G{constructor(t){super(),this.Hi=t}Ut(){return this.Hi}}const bi={Bar:(t,i,s,n)=>{var e;const r=i.upColor,h=i.downColor,o=l(t(s,n)),_=a(o.Rt[0])<=a(o.Rt[3]);return{ie:null!==(e=o.R)&&void 0!==e?e:_?r:h}},Candlestick:(t,i,s,n)=>{var e,r,h;const o=i.upColor,_=i.downColor,u=i.borderUpColor,c=i.borderDownColor,d=i.wickUpColor,f=i.wickDownColor,p=l(t(s,n)),v=a(p.Rt[0])<=a(p.Rt[3]);return{ie:null!==(e=p.R)&&void 0!==e?e:v?o:_,De:null!==(r=p.At)&&void 0!==r?r:v?u:c,Te:null!==(h=p.Ah)&&void 0!==h?h:v?d:f}},Area:(t,i,s,n)=>{var e,r,h,a;const o=l(t(s,n));return{ie:null!==(e=o.lt)&&void 0!==e?e:i.lineColor,lt:null!==(r=o.lt)&&void 0!==r?r:i.lineColor,vn:null!==(h=o.vn)&&void 0!==h?h:i.topColor,mn:null!==(a=o.mn)&&void 0!==a?a:i.bottomColor}},Baseline:(t,i,s,n)=>{var e,r,h,a,o,_;const u=l(t(s,n));return{ie:u.Rt[3]>=i.baseValue.price?i.topLineColor:i.bottomLineColor,be:null!==(e=u.be)&&void 0!==e?e:i.topLineColor,we:null!==(r=u.we)&&void 0!==r?r:i.bottomLineColor,de:null!==(h=u.de)&&void 0!==h?h:i.topFillColor1,fe:null!==(a=u.fe)&&void 0!==a?a:i.topFillColor2,pe:null!==(o=u.pe)&&void 0!==o?o:i.bottomFillColor1,ve:null!==(_=u.ve)&&void 0!==_?_:i.bottomFillColor2}},Line:(t,i,s,n)=>{var e,r;const h=l(t(s,n));return{ie:null!==(e=h.R)&&void 0!==e?e:i.color,lt:null!==(r=h.R)&&void 0!==r?r:i.color}},Histogram:(t,i,s,n)=>{var e;return{ie:null!==(e=l(t(s,n)).R)&&void 0!==e?e:i.color}}};class wi{constructor(t){this.Oh=(t,i)=>void 0!==i?i.Rt:this.kr.Ns().Lh(t),this.kr=t,this.Eh=bi[t.Nh()]}Ln(t,i){return this.Eh(this.Oh,this.kr.F(),t,i)}}var gi;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(gi||(gi={}));class Mi{constructor(){this.Ih=[],this.Bh=new Map,this.Vh=new Map}Fh(){return this.Fn()>0?this.Ih[this.Ih.length-1]:null}Wh(){return this.Fn()>0?this.zh(0):null}Es(){return this.Fn()>0?this.zh(this.Ih.length-1):null}Fn(){return this.Ih.length}Fi(){return 0===this.Fn()}Lr(t){return null!==this.jh(t,0)}Lh(t){return this.Hh(t)}Hh(t,i=0){const s=this.jh(t,i);return null===s?null:Object.assign(Object.assign({},this.$h(s)),{Yn:this.zh(s)})}Un(){return this.Ih}Uh(t,i,s){if(this.Fi())return null;let n=null;for(const e of s){n=Si(n,this.qh(t,i,e))}return n}tt(t){this.Vh.clear(),this.Bh.clear(),this.Ih=t}zh(t){return this.Ih[t].Yn}$h(t){return this.Ih[t]}jh(t,i){const s=this.Yh(t);if(null===s&&0!==i)switch(i){case-1:return this.Xh(t);case 1:return this.Zh(t);default:throw new TypeError("Unknown search mode")}return s}Xh(t){let i=this.Kh(t);return i>0&&(i-=1),i!==this.Ih.length&&this.zh(i)<t?i:null}Zh(t){const i=this.Gh(t);return i!==this.Ih.length&&t<this.zh(i)?i:null}Yh(t){const i=this.Kh(t);return i===this.Ih.length||t<this.Ih[i].Yn?null:i}Kh(t){return mt(this.Ih,t,((t,i)=>t.Yn<i))}Gh(t){return bt(this.Ih,t,((t,i)=>i.Yn>t))}Jh(t,i,s){let n=null;for(let e=t;e<i;e++){const t=this.Ih[e].Rt[s];Number.isNaN(t)||(null===n?n={Qh:t,tl:t}:(t<n.Qh&&(n.Qh=t),t>n.tl&&(n.tl=t)))}return n}qh(t,i,s){if(this.Fi())return null;let n=null;const e=l(this.Wh()),r=l(this.Es()),h=Math.max(t,e),a=Math.min(i,r),o=30*Math.ceil(h/30),_=Math.max(o,30*Math.floor(a/30));{const t=this.Kh(h),e=this.Gh(Math.min(a,o,i));n=Si(n,this.Jh(t,e,s))}let u=this.Bh.get(s);void 0===u&&(u=new Map,this.Bh.set(s,u));for(let t=Math.max(o+1,h);t<_;t+=30){const i=Math.floor(t/30);let e=u.get(i);if(void 0===e){const t=this.Kh(30*i),n=this.Gh(30*(i+1)-1);e=this.Jh(t,n,s),u.set(i,e)}n=Si(n,e)}{const t=this.Kh(_),i=this.Gh(a);n=Si(n,this.Jh(t,i,s))}return n}}function Si(t,i){if(null===t)return i;if(null===i)return t;return{Qh:Math.min(t.Qh,i.Qh),tl:Math.max(t.tl,i.tl)}}class yi extends mi{constructor(t,i,s){super(t),this.Et=new Mi,this.kh=new _i(this),this.il=[],this.sl=new qt(this),this.nl=null,this.el=null,this.rl=[],this.hl=[],this.ll=null,this.us=i,this.al=s;const n=new ui(this);this.es=[n],this.Ch=new Ht(n,this,t),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(this.nl=new Gt(this)),this.ol(),this._l()}M(){null!==this.ll&&clearTimeout(this.ll)}Gr(t){return this.us.priceLineColor||t}Ar(t){const i={Or:!0},s=this.Pt();if(this.Ut().yt().Fi()||s.Fi()||this.Et.Fi())return i;const n=this.Ut().yt().Vn(),e=this.xt();if(null===n||null===e)return i;let r,h;if(t){const t=this.Et.Fh();if(null===t)return i;r=t,h=t.Yn}else{const t=this.Et.Hh(n.Mn(),-1);if(null===t)return i;if(r=this.Et.Lh(t.Yn),null===r)return i;h=t.Yn}const l=r.Rt[3],a=this.En().Ln(h,{Rt:r}),o=s.Dt(l,e.Rt);return{Or:!1,_t:l,ti:s.Wi(l,e.Rt),sh:s.ul(l),nh:s.cl(l,e.Rt),R:a.ie,yi:o,Yn:h}}En(){return null!==this.el||(this.el=new wi(this)),this.el}F(){return this.us}xh(t){const i=t.priceScaleId;void 0!==i&&i!==this.us.priceScaleId&&this.Ut().dl(this,i),w(this.us,t),void 0!==t.priceFormat&&(this.ol(),this.Ut().fl()),this.Ut().pl(this),this.Ut().vl(),this.ws.bt("options")}tt(t,i){this.Et.tt(t),this.ml(),this.ws.bt("data"),this.cs.bt("data"),null!==this.nl&&(i&&i.bl?this.nl.Tr():0===t.length&&this.nl.Cr());const s=this.Ut().Ge(this);this.Ut().wl(s),this.Ut().pl(this),this.Ut().vl(),this.Ut().Th()}gl(t){this.rl=t,this.ml();const i=this.Ut().Ge(this);this.cs.bt("data"),this.Ut().wl(i),this.Ut().pl(this),this.Ut().vl(),this.Ut().Th()}Ml(){return this.rl}Zr(){return this.hl}Sl(t){const i=new vi(this,t);return this.il.push(i),this.Ut().pl(this),i}yl(t){const i=this.il.indexOf(t);-1!==i&&this.il.splice(i,1),this.Ut().pl(this)}Nh(){return this.al}xt(){const t=this.kl();return null===t?null:{Rt:t.Rt[3],Cl:t.ot}}kl(){const t=this.Ut().yt().Vn();if(null===t)return null;const i=t.gn();return this.Et.Hh(i,1)}Ns(){return this.Et}Kr(t){const i=this.Et.Lh(t);return null===i?null:"Bar"===this.al||"Candlestick"===this.al?{oe:i.Rt[0],_e:i.Rt[1],ue:i.Rt[2],ce:i.Rt[3]}:i.Rt[3]}xl(t){const i=this.nl;return null!==i&&i.Ct()?(null===this.ll&&i.Pr()&&(this.ll=setTimeout((()=>{this.ll=null,this.Ut().Tl()}),0)),i.Dr(),[i]):[]}Ds(){const t=[];this.Dl()||t.push(this.sl),t.push(this.ws,this.kh,this.cs);const i=this.il.map((t=>t.Dh()));return t.push(...i),t}Gi(t){return[this.Ch,...this.il.map((t=>t.Ph()))]}Ps(t,i){if(i!==this.qi&&!this.Dl())return[];const s=[...this.es];for(const t of this.il)s.push(t.Rh());return s}Pl(t,i){if(void 0!==this.us.autoscaleInfoProvider){const s=this.us.autoscaleInfoProvider((()=>{const s=this.Rl(t,i);return null===s?null:s.fh()}));return di.ph(s)}return this.Rl(t,i)}Al(){return this.us.priceFormat.minMove}Ol(){return this.Ll}As(){var t;this.ws.bt(),this.cs.bt();for(const t of this.es)t.bt();for(const t of this.il)t.bt();this.kh.bt(),this.sl.bt(),null===(t=this.nl)||void 0===t||t.bt()}Pt(){return l(super.Pt())}kt(t){if(!(("Line"===this.al||"Area"===this.al||"Baseline"===this.al)&&this.us.crosshairMarkerVisible))return null;const i=this.Et.Lh(t);if(null===i)return null;return{_t:i.Rt[3],ht:this.El(),At:this.Nl(),Tt:this.Il(t)}}Jr(){return this.us.title}Ct(){return this.us.visible}Dl(){return!tt(this.Pt().Bl())}Rl(t,i){if(!M(t)||!M(i)||this.Et.Fi())return null;const s="Line"===this.al||"Area"===this.al||"Baseline"===this.al||"Histogram"===this.al?[3]:[2,1],n=this.Et.Uh(t,i,s);let e=null!==n?new ci(n.Qh,n.tl):null;if("Histogram"===this.Nh()){const t=this.us.base,i=new ci(t,t);e=null!==e?e.tn(i):i}return new di(e,this.cs.Xr())}El(){switch(this.al){case"Line":case"Area":case"Baseline":return this.us.crosshairMarkerRadius}return 0}Nl(){switch(this.al){case"Line":case"Area":case"Baseline":{const t=this.us.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}Il(t){switch(this.al){case"Line":case"Area":case"Baseline":{const t=this.us.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.En().Ln(t).ie}ol(){switch(this.us.priceFormat.type){case"custom":this.Ll={format:this.us.priceFormat.formatter};break;case"volume":this.Ll=new ht(this.us.priceFormat.precision);break;case"percent":this.Ll=new rt(this.us.priceFormat.precision);break;default:{const t=Math.pow(10,this.us.priceFormat.precision);this.Ll=new et(t,this.us.priceFormat.minMove*t)}}null!==this.qi&&this.qi.Vl()}ml(){const t=this.Ut().yt();if(t.Fi()||0===this.Et.Fn())return void(this.hl=[]);const i=l(this.Et.Wh());this.hl=this.rl.map(((s,n)=>{const e=l(t.Fl(s.time,!0)),r=e<i?1:-1;return{time:l(this.Et.Hh(e,r)).Yn,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:n,text:s.text,size:s.size}}))}_l(){switch(this.cs=new oi(this,this.Ut()),this.al){case"Bar":this.ws=new Tt(this,this.Ut());break;case"Candlestick":this.ws=new It(this,this.Ut());break;case"Line":this.ws=new Ft(this,this.Ut());break;case"Area":this.ws=new kt(this,this.Ut());break;case"Baseline":this.ws=new Et(this,this.Ut());break;case"Histogram":this.ws=new Vt(this,this.Ut());break;default:throw Error("Unknown chart style assigned: "+this.al)}}}class ki{constructor(t){this.us=t}Wl(t,i,s){let n=t;if(0===this.us.mode)return n;const e=s.fs(),r=e.xt();if(null===r)return n;const h=e.Dt(t,r),l=s.zl().filter((t=>t instanceof yi)).reduce(((t,n)=>{if(s.Je(n)||!n.Ct())return t;const e=n.Pt(),r=n.Ns();if(e.Fi()||!r.Lr(i))return t;const h=r.Lh(i);if(null===h)return t;const l=a(n.xt());return t.concat([e.Dt(h.Rt[3],l.Rt)])}),[]);if(0===l.length)return n;l.sort(((t,i)=>Math.abs(t-h)-Math.abs(i-h)));const o=l[0];return n=e.ps(o,r),n}}class Ci{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,s,e){if(null===this.Et)return;const r=Math.max(1,Math.floor(i));t.lineWidth=r;const h=Math.ceil(this.Et.Vt*i),a=Math.ceil(this.Et.Bt*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const s=l(this.Et);if(s.jl){t.strokeStyle=s.Hl,n(t,s.$l),t.beginPath();for(const n of s.Ul){const s=Math.round(n.ql*i);t.moveTo(s,-r),t.lineTo(s,h+r)}t.stroke()}if(s.Yl){t.strokeStyle=s.Xl,n(t,s.Zl),t.beginPath();for(const n of s.Kl){const s=Math.round(n.ql*i);t.moveTo(-r,s),t.lineTo(a+r,s)}t.stroke()}}))}}class xi{constructor(t){this.jt=new Ci,this.ft=!0,this.Qi=t}bt(){this.ft=!0}gt(t,i){if(this.ft){const s=this.Qi.Ut().F().grid,n={Vt:t,Bt:i,Yl:s.horzLines.visible,jl:s.vertLines.visible,Xl:s.horzLines.color,Hl:s.vertLines.color,Zl:s.horzLines.style,$l:s.vertLines.style,Kl:this.Qi.fs().Gl(),Ul:this.Qi.Ut().yt().Gl()||[]};this.jt.tt(n),this.ft=!1}return this.jt}}class Ti{constructor(t){this.ws=new xi(t)}Dh(){return this.ws}}const Di={Jl:4,Ql:1e-4};function Pi(t,i){const s=100*(t-i)/i;return i<0?-s:s}function Ri(t,i){const s=Pi(t.ah(),i),n=Pi(t.oh(),i);return new ci(s,n)}function Ai(t,i){const s=100*(t-i)/i+100;return i<0?-s:s}function Oi(t,i){const s=Ai(t.ah(),i),n=Ai(t.oh(),i);return new ci(s,n)}function Li(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=Rt(s+i.Ql)+i.Jl;return t<0?-n:n}function Ei(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=Math.pow(10,s-i.Jl)-i.Ql;return t<0?-n:n}function Ni(t,i){if(null===t)return null;const s=Li(t.ah(),i),n=Li(t.oh(),i);return new ci(s,n)}function Ii(t,i){if(null===t)return null;const s=Ei(t.ah(),i),n=Ei(t.oh(),i);return new ci(s,n)}function Bi(t){if(null===t)return Di;const i=Math.abs(t.oh()-t.ah());if(i>=1||i<1e-15)return Di;const s=Math.ceil(Math.abs(Math.log10(i))),n=Di.Jl+s;return{Jl:n,Ql:1/Math.pow(10,n)}}class Vi{constructor(t,i){if(this.ta=t,this.ia=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.ta))this.sa=[2,2.5,2];else{this.sa=[];for(let t=this.ta;1!==t;){if(t%2==0)this.sa.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.sa.push(2,2.5),t/=5}if(this.sa.length>100)throw new Error("something wrong with base")}}}na(t,i,s){const n=0===this.ta?0:1/this.ta;let e=Math.pow(10,Math.max(0,Math.ceil(Rt(t-i)))),r=0,h=this.ia[0];for(;;){const t=Pt(e,n,1e-14)&&e>n+1e-14,i=Pt(e,s*h,1e-14),l=Pt(e,1,1e-14);if(!(t&&i&&l))break;e/=h,h=this.ia[++r%this.ia.length]}if(e<=n+1e-14&&(e=n),e=Math.max(1,e),this.sa.length>0&&(l=e,a=1,o=1e-14,Math.abs(l-a)<o))for(r=0,h=this.sa[0];Pt(e,s*h,1e-14)&&e>n+1e-14;)e/=h,h=this.sa[++r%this.sa.length];var l,a,o;return e}}class Fi{constructor(t,i,s,n){this.ea=[],this.Bi=t,this.ta=i,this.ra=s,this.ha=n}na(t,i){if(t<i)throw new Error("high < low");const s=this.Bi.Zt(),n=(t-i)*this.la()/s,e=new Vi(this.ta,[2,2.5,2]),r=new Vi(this.ta,[2,2,2.5]),h=new Vi(this.ta,[2.5,2,2]),l=[];return l.push(e.na(t,i,n),r.na(t,i,n),h.na(t,i,n)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let s=1;s<t.length;++s)t[s]<i&&(i=t[s]);return i}(l)}aa(){const t=this.Bi,i=t.xt();if(null===i)return void(this.ea=[]);const s=t.Zt(),n=this.ra(s-1,i),e=this.ra(0,i),r=this.Bi.F().entireTextOnly?this.oa()/2:0,h=r,l=s-1-r,a=Math.max(n,e),o=Math.min(n,e);if(a===o)return void(this.ea=[]);let _=this.na(a,o),u=a%_;u+=u<0?_:0;const c=a>=o?1:-1;let d=null,f=0;for(let s=a-u;s>o;s-=_){const n=this.ha(s,i,!0);null!==d&&Math.abs(n-d)<this.la()||(n<h||n>l||(f<this.ea.length?(this.ea[f].ql=n,this.ea[f]._a=t.ua(s)):this.ea.push({ql:n,_a:t.ua(s)}),f++,d=n,t.ca()&&(_=this.na(s*c,o))))}this.ea.length=f}Gl(){return this.ea}oa(){return this.Bi.T()}la(){return Math.ceil(2.5*this.oa())}}function Wi(t){return t.slice().sort(((t,i)=>l(t.Xi())-l(i.Xi())))}var zi;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(zi||(zi={}));const ji=new rt,Hi=new et(100,1);class $i{constructor(t,i,s,n){this.da=0,this.fa=null,this.mh=null,this.pa=null,this.va={ma:!1,ba:null},this.wa=0,this.ga=0,this.Ma=new b,this.Sa=new b,this.ya=[],this.ka=null,this.Ca=null,this.xa=null,this.Ta=null,this.Ll=Hi,this.Da=Bi(null),this.Pa=t,this.us=i,this.Ra=s,this.Aa=n,this.Oa=new Fi(this,100,this.La.bind(this),this.Ea.bind(this))}Bl(){return this.Pa}F(){return this.us}xh(t){if(w(this.us,t),this.Vl(),void 0!==t.mode&&this.Na({rr:t.mode}),void 0!==t.scaleMargins){const i=h(t.scaleMargins.top),s=h(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(s<0||s>1||i+s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(i+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+s}`);this.Ia(),this.Ca=null}}Ba(){return this.us.autoScale}ca(){return 1===this.us.mode}ih(){return 2===this.us.mode}Va(){return 3===this.us.mode}rr(){return{zs:this.us.autoScale,Fa:this.us.invertScale,rr:this.us.mode}}Na(t){const i=this.rr();let s=null;void 0!==t.zs&&(this.us.autoScale=t.zs),void 0!==t.rr&&(this.us.mode=t.rr,2!==t.rr&&3!==t.rr||(this.us.autoScale=!0),this.va.ma=!1),1===i.rr&&t.rr!==i.rr&&(!function(t,i){if(null===t)return!1;const s=Ei(t.ah(),i),n=Ei(t.oh(),i);return isFinite(s)&&isFinite(n)}(this.mh,this.Da)?this.us.autoScale=!0:(s=Ii(this.mh,this.Da),null!==s&&this.Wa(s))),1===t.rr&&t.rr!==i.rr&&(s=Ni(this.mh,this.Da),null!==s&&this.Wa(s));const n=i.rr!==this.us.mode;n&&(2===i.rr||this.ih())&&this.Vl(),n&&(3===i.rr||this.Va())&&this.Vl(),void 0!==t.Fa&&i.Fa!==t.Fa&&(this.us.invertScale=t.Fa,this.za()),this.Sa.m(i,this.rr())}ja(){return this.Sa}T(){return this.Ra.fontSize}Zt(){return this.da}Ha(t){this.da!==t&&(this.da=t,this.Ia(),this.Ca=null)}$a(){if(this.fa)return this.fa;const t=this.Zt()-this.Ua()-this.qa();return this.fa=t,t}wh(){return this.Ya(),this.mh}Wa(t,i){const s=this.mh;(i||null===s&&null!==t||null!==s&&!s.hh(t))&&(this.Ca=null,this.mh=t)}Fi(){return this.Ya(),0===this.da||!this.mh||this.mh.Fi()}Xa(t){return this.Fa()?t:this.Zt()-1-t}Dt(t,i){return this.ih()?t=Pi(t,i):this.Va()&&(t=Ai(t,i)),this.Ea(t,i)}Hn(t,i,s){this.Ya();const n=this.qa(),e=l(this.wh()),r=e.ah(),h=e.oh(),a=this.$a()-1,o=this.Fa(),_=a/(h-r),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.Za();for(let s=u;s<c;s++){const e=t[s],h=e._t;if(isNaN(h))continue;let l=h;null!==d&&(l=d(e._t,i));const a=n+_*(l-r),u=o?a:this.da-1-a;e.et=u}}le(t,i,s){this.Ya();const n=this.qa(),e=l(this.wh()),r=e.ah(),h=e.oh(),a=this.$a()-1,o=this.Fa(),_=a/(h-r),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.Za();for(let s=u;s<c;s++){const e=t[s];let h=e.oe,l=e._e,a=e.ue,u=e.ce;null!==d&&(h=d(e.oe,i),l=d(e._e,i),a=d(e.ue,i),u=d(e.ce,i));let c=n+_*(h-r),f=o?c:this.da-1-c;e.re=f,c=n+_*(l-r),f=o?c:this.da-1-c,e.se=f,c=n+_*(a-r),f=o?c:this.da-1-c,e.ne=f,c=n+_*(u-r),f=o?c:this.da-1-c,e.he=f}}ps(t,i){const s=this.La(t,i);return this.Ka(s,i)}Ka(t,i){let s=t;return this.ih()?s=function(t,i){return i<0&&(t=-t),t/100*i+i}(s,i):this.Va()&&(s=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(s,i)),s}zl(){return this.ya}Ga(){if(this.ka)return this.ka;let t=[];for(let i=0;i<this.ya.length;i++){const s=this.ya[i];null===s.Xi()&&s.Zi(i+1),t.push(s)}return t=Wi(t),this.ka=t,this.ka}Ja(t){-1===this.ya.indexOf(t)&&(this.ya.push(t),this.Vl(),this.Qa())}io(t){const i=this.ya.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.ya.splice(i,1),0===this.ya.length&&(this.Na({zs:!0}),this.Wa(null)),this.Vl(),this.Qa()}xt(){let t=null;for(const i of this.ya){const s=i.xt();null!==s&&((null===t||s.Cl<t.Cl)&&(t=s))}return null===t?null:t.Rt}Fa(){return this.us.invertScale}Gl(){const t=null===this.xt();if(null!==this.Ca&&(t||this.Ca.so===t))return this.Ca.Gl;this.Oa.aa();const i=this.Oa.Gl();return this.Ca={Gl:i,so:t},this.Ma.m(),i}no(){return this.Ma}eo(t){this.ih()||this.Va()||null===this.xa&&null===this.pa&&(this.Fi()||(this.xa=this.da-t,this.pa=l(this.wh()).lh()))}ro(t){if(this.ih()||this.Va())return;if(null===this.xa)return;this.Na({zs:!1}),(t=this.da-t)<0&&(t=0);let i=(this.xa+.2*(this.da-1))/(t+.2*(this.da-1));const s=l(this.pa).lh();i=Math.max(i,.1),s.uh(i),this.Wa(s)}ho(){this.ih()||this.Va()||(this.xa=null,this.pa=null)}lo(t){this.Ba()||null===this.Ta&&null===this.pa&&(this.Fi()||(this.Ta=t,this.pa=l(this.wh()).lh()))}ao(t){if(this.Ba())return;if(null===this.Ta)return;const i=l(this.wh())._h()/(this.$a()-1);let s=t-this.Ta;this.Fa()&&(s*=-1);const n=s*i,e=l(this.pa).lh();e.dh(n),this.Wa(e,!0),this.Ca=null}oo(){this.Ba()||null!==this.Ta&&(this.Ta=null,this.pa=null)}Ol(){return this.Ll||this.Vl(),this.Ll}Wi(t,i){switch(this.us.mode){case 2:return this.Ol().format(Pi(t,i));case 3:return this.Ol().format(Ai(t,i));default:return this.yh(t)}}ua(t){switch(this.us.mode){case 2:case 3:return this.Ol().format(t);default:return this.yh(t)}}ul(t){return this.yh(t,l(this._o()).Ol())}cl(t,i){return t=Pi(t,i),ji.format(t)}uo(){return this.ya}co(t){this.va={ba:t,ma:!1}}As(){this.ya.forEach((t=>t.As()))}Vl(){this.Ca=null;const t=this._o();let i=100;null!==t&&(i=Math.round(1/t.Al())),this.Ll=Hi,this.ih()?(this.Ll=ji,i=100):this.Va()?(this.Ll=new et(100,1),i=100):null!==t&&(this.Ll=t.Ol()),this.Oa=new Fi(this,i,this.La.bind(this),this.Ea.bind(this)),this.Oa.aa()}Qa(){this.ka=null}_o(){return this.ya[0]||null}Ua(){return this.Fa()?this.us.scaleMargins.bottom*this.Zt()+this.ga:this.us.scaleMargins.top*this.Zt()+this.wa}qa(){return this.Fa()?this.us.scaleMargins.top*this.Zt()+this.wa:this.us.scaleMargins.bottom*this.Zt()+this.ga}Ya(){this.va.ma||(this.va.ma=!0,this.do())}Ia(){this.fa=null}Ea(t,i){if(this.Ya(),this.Fi())return 0;t=this.ca()&&t?Li(t,this.Da):t;const s=l(this.wh()),n=this.qa()+(this.$a()-1)*(t-s.ah())/s._h();return this.Xa(n)}La(t,i){if(this.Ya(),this.Fi())return 0;const s=this.Xa(t),n=l(this.wh()),e=n.ah()+n._h()*((s-this.qa())/(this.$a()-1));return this.ca()?Ei(e,this.Da):e}za(){this.Ca=null,this.Oa.aa()}do(){const t=this.va.ba;if(null===t)return;let i=null;const s=this.uo();let n=0,e=0;for(const r of s){if(!r.Ct())continue;const s=r.xt();if(null===s)continue;const h=r.Pl(t.gn(),t.Mn());let a=h&&h.wh();if(null!==a){switch(this.us.mode){case 1:a=Ni(a,this.Da);break;case 2:a=Ri(a,s.Rt);break;case 3:a=Oi(a,s.Rt)}if(i=null===i?a:i.tn(l(a)),null!==h){const t=h.gh();null!==t&&(n=Math.max(n,t.above),e=Math.max(n,t.below))}}}if(n===this.wa&&e===this.ga||(this.wa=n,this.ga=e,this.Ca=null,this.Ia()),null!==i){if(i.ah()===i.oh()){const t=this._o(),s=5*(null===t||this.ih()||this.Va()?1:t.Al());this.ca()&&(i=Ii(i,this.Da)),i=new ci(i.ah()-s,i.oh()+s),this.ca()&&(i=Ni(i,this.Da))}if(this.ca()){const t=Ii(i,this.Da),s=Bi(t);if(r=s,h=this.Da,r.Jl!==h.Jl||r.Ql!==h.Ql){const n=null!==this.pa?Ii(this.pa,this.Da):null;this.Da=s,i=Ni(t,s),null!==n&&(this.pa=Ni(n,s))}}this.Wa(i)}else null===this.mh&&(this.Wa(new ci(-.5,.5)),this.Da=Bi(null));var r,h;this.va.ma=!0}Za(){return this.ih()?Pi:this.Va()?Ai:this.ca()?t=>Li(t,this.Da):null}yh(t,i){return void 0===this.Aa.priceFormatter?(void 0===i&&(i=this.Ol()),i.format(t)):this.Aa.priceFormatter(t)}}class Ui{constructor(t,i){this.ya=[],this.fo=new Map,this.da=0,this.qe=0,this.po=1e3,this.ka=null,this.vo=new b,this.mo=t,this.Hi=i,this.bo=new Ti(this);const s=i.F();this.wo=this.Mo("left",s.leftPriceScale),this.So=this.Mo("right",s.rightPriceScale),this.wo.ja().l(this.yo.bind(this,this.wo),this),this.So.ja().l(this.yo.bind(this,this.So),this),this.ko(s)}ko(t){if(t.leftPriceScale&&this.wo.xh(t.leftPriceScale),t.rightPriceScale&&this.So.xh(t.rightPriceScale),t.localization&&(this.wo.Vl(),this.So.Vl()),t.overlayPriceScales){const i=Array.from(this.fo.values());for(const s of i){const i=l(s[0].Pt());i.xh(t.overlayPriceScales),t.localization&&i.Vl()}}}Co(t){switch(t){case"left":return this.wo;case"right":return this.So}return this.fo.has(t)?h(this.fo.get(t))[0].Pt():null}M(){this.Ut().xo().v(this),this.wo.ja().v(this),this.So.ja().v(this),this.ya.forEach((t=>{t.M&&t.M()})),this.vo.m()}To(){return this.po}Do(t){this.po=t}Ut(){return this.Hi}Xt(){return this.qe}Zt(){return this.da}Po(t){this.qe=t,this.Ro()}Ha(t){this.da=t,this.wo.Ha(t),this.So.Ha(t),this.ya.forEach((i=>{if(this.Je(i)){const s=i.Pt();null!==s&&s.Ha(t)}})),this.Ro()}zl(){return this.ya}Je(t){const i=t.Pt();return null===i||this.wo!==i&&this.So!==i}Ja(t,i,s){const n=void 0!==s?s:this.Oo().Ao+1;this.Lo(t,i,n)}io(t){const i=this.ya.indexOf(t);r(-1!==i,"removeDataSource: invalid data source"),this.ya.splice(i,1);const s=l(t.Pt()).Bl();if(this.fo.has(s)){const i=h(this.fo.get(s)),n=i.indexOf(t);-1!==n&&(i.splice(n,1),0===i.length&&this.fo.delete(s))}const n=t.Pt();n&&n.zl().indexOf(t)>=0&&n.io(t),null!==n&&(n.Qa(),this.Eo(n)),this.ka=null}tr(t){return t===this.wo?"left":t===this.So?"right":"overlay"}No(){return this.wo}Io(){return this.So}Bo(t,i){t.eo(i)}Vo(t,i){t.ro(i),this.Ro()}Fo(t){t.ho()}Wo(t,i){t.lo(i)}zo(t,i){t.ao(i),this.Ro()}jo(t){t.oo()}Ro(){this.ya.forEach((t=>{t.As()}))}fs(){let t=null;return this.Hi.F().rightPriceScale.visible&&0!==this.So.zl().length?t=this.So:this.Hi.F().leftPriceScale.visible&&0!==this.wo.zl().length?t=this.wo:0!==this.ya.length&&(t=this.ya[0].Pt()),null===t&&(t=this.So),t}Qe(){let t=null;return this.Hi.F().rightPriceScale.visible?t=this.So:this.Hi.F().leftPriceScale.visible&&(t=this.wo),t}Eo(t){null!==t&&t.Ba()&&this.Ho(t)}$o(t){const i=this.mo.Vn();t.Na({zs:!0}),null!==i&&t.co(i),this.Ro()}Uo(){this.Ho(this.wo),this.Ho(this.So)}qo(){this.Eo(this.wo),this.Eo(this.So),this.ya.forEach((t=>{this.Je(t)&&this.Eo(t.Pt())})),this.Ro(),this.Hi.Th()}Ga(){return null===this.ka&&(this.ka=Wi(this.ya)),this.ka}Yo(){return this.vo}Xo(){return this.bo}Ho(t){const i=t.uo();if(i&&i.length>0&&!this.mo.Fi()){const i=this.mo.Vn();null!==i&&t.co(i)}t.As()}Oo(){const t=this.Ga();if(0===t.length)return{Zo:0,Ao:0};let i=0,s=0;for(let n=0;n<t.length;n++){const e=t[n].Xi();null!==e&&(e<i&&(i=e),e>s&&(s=e))}return{Zo:i,Ao:s}}Lo(t,i,s){let n=this.Co(i);if(null===n&&(n=this.Mo(i,this.Hi.F().overlayPriceScales)),this.ya.push(t),!tt(i)){const s=this.fo.get(i)||[];s.push(t),this.fo.set(i,s)}n.Ja(t),t.Ki(n),t.Zi(s),this.Eo(n),this.ka=null}yo(t,i,s){i.rr!==s.rr&&this.Ho(t)}Mo(t,i){const s=Object.assign({visible:!0,autoScale:!0},k(i)),n=new $i(t,s,this.Hi.F().layout,this.Hi.F().localization);return n.Ha(this.Zt()),n}}const qi=t=>t.getUTCFullYear();function Yi(t,i,s){return i.replace(/yyyy/g,(t=>nt(qi(t),4))(t)).replace(/yy/g,(t=>nt(qi(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,s)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,s)).replace(/MM/g,(t=>nt((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>nt((t=>t.getUTCDate())(t),2))(t))}class Xi{constructor(t="yyyy-MM-dd",i="default"){this.Ko=t,this.Go=i}Jo(t){return Yi(t,this.Ko,this.Go)}}class Zi{constructor(t){this.Qo=t||"%h:%m:%s"}Jo(t){return this.Qo.replace("%h",nt(t.getUTCHours(),2)).replace("%m",nt(t.getUTCMinutes(),2)).replace("%s",nt(t.getUTCSeconds(),2))}}const Ki={t_:"yyyy-MM-dd",i_:"%h:%m:%s",s_:" ",n_:"default"};class Gi{constructor(t={}){const i=Object.assign(Object.assign({},Ki),t);this.e_=new Xi(i.t_,i.n_),this.r_=new Zi(i.i_),this.h_=i.s_}Jo(t){return`${this.e_.Jo(t)}${this.h_}${this.r_.Jo(t)}`}}class Ji{constructor(t,i=50){this.Ee=0,this.Ne=1,this.Ie=1,this.Ve=new Map,this.Be=new Map,this.l_=t,this.Fe=i}Jo(t){const i=t.ot,s=void 0===i.a_?new Date(1e3*i.o_).getTime():new Date(Date.UTC(i.a_.year,i.a_.month-1,i.a_.day)).getTime(),n=this.Ve.get(s);if(void 0!==n)return n.__;if(this.Ee===this.Fe){const t=this.Be.get(this.Ie);this.Be.delete(this.Ie),this.Ve.delete(h(t)),this.Ie++,this.Ee--}const e=this.l_(t);return this.Ve.set(s,{__:e,He:this.Ne}),this.Be.set(this.Ne,s),this.Ee++,this.Ne++,e}}class Qi{constructor(t,i){r(t<=i,"right should be >= left"),this.u_=t,this.c_=i}gn(){return this.u_}Mn(){return this.c_}d_(){return this.c_-this.u_+1}Lr(t){return this.u_<=t&&t<=this.c_}hh(t){return this.u_===t.gn()&&this.c_===t.Mn()}}function ts(t,i){return null===t||null===i?t===i:t.hh(i)}class is{constructor(){this.f_=new Map,this.Ve=null}p_(t,i){this.v_(i),this.Ve=null;for(let s=i;s<t.length;++s){const i=t[s];let n=this.f_.get(i.m_);void 0===n&&(n=[],this.f_.set(i.m_,n)),n.push({Yn:s,ot:i.ot,b_:i.m_,w_:i.w_})}}g_(t,i){const s=Math.ceil(i/t);return null!==this.Ve&&this.Ve.M_===s||(this.Ve={Gl:this.S_(s),M_:s}),this.Ve.Gl}v_(t){if(0===t)return void this.f_.clear();const i=[];this.f_.forEach(((s,n)=>{t<=s[0].Yn?i.push(n):s.splice(mt(s,t,(i=>i.Yn<t)),1/0)}));for(const t of i)this.f_.delete(t)}S_(t){let i=[];for(const s of Array.from(this.f_.keys()).sort(((t,i)=>i-t))){if(!this.f_.get(s))continue;const n=i;i=[];const e=n.length;let r=0;const l=h(this.f_.get(s)),a=l.length;let o=1/0,_=-1/0;for(let s=0;s<a;s++){const h=l[s],a=h.Yn;for(;r<e;){const t=n[r],s=t.Yn;if(!(s<a)){o=s;break}r++,i.push(t),_=s,o=1/0}o-a>=t&&a-_>=t&&(i.push(h),_=a)}for(;r<e;r++)i.push(n[r])}return i}}class ss{constructor(t){this.y_=t}k_(){return null===this.y_?null:new Qi(Math.floor(this.y_.gn()),Math.ceil(this.y_.Mn()))}C_(){return this.y_}static x_(){return new ss(null)}}var ns,es,rs,hs,ls;!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(ns||(ns={}));class as{constructor(t,i,s){this.qe=0,this.T_=null,this.D_=[],this.Ta=null,this.xa=null,this.P_=new is,this.R_=new Map,this.A_=ss.x_(),this.O_=!0,this.L_=new b,this.E_=new b,this.N_=new b,this.I_=null,this.B_=null,this.V_=[],this.us=i,this.Aa=s,this.F_=i.rightOffset,this.W_=i.barSpacing,this.Hi=t,this.z_()}F(){return this.us}j_(t){w(this.Aa,t),this.H_(),this.z_()}xh(t,i){var s;w(this.us,t),this.us.fixLeftEdge&&this.U_(),this.us.fixRightEdge&&this.q_(),void 0!==t.barSpacing&&this.Hi.Gs(t.barSpacing),void 0!==t.rightOffset&&this.Hi.Js(t.rightOffset),void 0!==t.minBarSpacing&&this.Hi.Gs(null!==(s=t.barSpacing)&&void 0!==s?s:this.W_),this.H_(),this.z_(),this.N_.m()}vs(t){var i,s;return null!==(s=null===(i=this.D_[t])||void 0===i?void 0:i.ot)&&void 0!==s?s:null}$i(t){var i;return null!==(i=this.D_[t])&&void 0!==i?i:null}Fl(t,i){if(this.D_.length<1)return null;if(t.o_>this.D_[this.D_.length-1].ot.o_)return i?this.D_.length-1:null;const s=mt(this.D_,t.o_,((t,i)=>t.ot.o_<i));return t.o_<this.D_[s].ot.o_?i?s:null:s}Fi(){return 0===this.qe||0===this.D_.length||null===this.T_}Vn(){return this.Y_(),this.A_.k_()}X_(){return this.Y_(),this.A_.C_()}Z_(){const t=this.Vn();if(null===t)return null;const i={from:t.gn(),to:t.Mn()};return this.K_(i)}K_(t){const i=Math.round(t.from),s=Math.round(t.to),n=l(this.G_()),e=l(this.J_());return{from:l(this.vs(Math.max(n,i))),to:l(this.vs(Math.min(e,s)))}}Q_(t){return{from:l(this.Fl(t.from,!0)),to:l(this.Fl(t.to,!0))}}Xt(){return this.qe}Po(t){if(!isFinite(t)||t<=0)return;if(this.qe===t)return;const i=this.X_(),s=this.qe;if(this.qe=t,this.O_=!0,this.us.lockVisibleTimeRangeOnResize&&0!==s){const i=this.W_*t/s;this.W_=i}if(this.us.fixLeftEdge&&null!==i&&i.gn()<=0){const i=s-t;this.F_-=Math.round(i/this.W_)+1,this.O_=!0}this.tu(),this.iu()}Lt(t){if(this.Fi()||!M(t))return 0;const i=this.su()+this.F_-t;return this.qe-(i+.5)*this.W_-1}jn(t,i){const s=this.su(),n=void 0===i?0:i.from,e=void 0===i?t.length:i.to;for(let i=n;i<e;i++){const n=t[i].ot,e=s+this.F_-n,r=this.qe-(e+.5)*this.W_-1;t[i].nt=r}}nu(t){return Math.ceil(this.eu(t))}Js(t){this.O_=!0,this.F_=t,this.iu(),this.Hi.ru(),this.Hi.Th()}Kn(){return this.W_}Gs(t){this.hu(t),this.iu(),this.Hi.ru(),this.Hi.Th()}lu(){return this.F_}Gl(){if(this.Fi())return null;if(null!==this.B_)return this.B_;const t=this.W_,i=5*(this.Hi.F().layout.fontSize+4),s=Math.round(i/t),n=l(this.Vn()),e=Math.max(n.gn(),n.gn()-s),r=Math.max(n.Mn(),n.Mn()-s),h=this.P_.g_(t,i),a=this.G_()+s,o=this.J_()-s,_=this.au(),u=this.us.fixLeftEdge||_,c=this.us.fixRightEdge||_;let d=0;for(const t of h){if(!(e<=t.Yn&&t.Yn<=r))continue;let s;d<this.V_.length?(s=this.V_[d],s.ql=this.Lt(t.Yn),s._a=this.ou(t),s.b_=t.b_):(s={_u:!1,ql:this.Lt(t.Yn),_a:this.ou(t),b_:t.b_},this.V_.push(s)),this.W_>i/2&&!_?s._u=!1:s._u=u&&t.Yn<=a||c&&t.Yn>=o,d++}return this.V_.length=d,this.B_=this.V_,this.V_}uu(){this.O_=!0,this.Gs(this.us.barSpacing),this.Js(this.us.rightOffset)}cu(t){this.O_=!0,this.T_=t,this.iu(),this.U_()}du(t,i){const s=this.eu(t),n=this.Kn(),e=n+i*(n/10);this.Gs(e),this.us.rightBarStaysOnScroll||this.Js(this.lu()+(s-this.eu(t)))}eo(t){this.Ta&&this.oo(),null===this.xa&&null===this.I_&&(this.Fi()||(this.xa=t,this.fu()))}ro(t){if(null===this.I_)return;const i=Dt(this.qe-t,0,this.qe),s=Dt(this.qe-l(this.xa),0,this.qe);0!==i&&0!==s&&this.Gs(this.I_.Kn*i/s)}ho(){null!==this.xa&&(this.xa=null,this.pu())}lo(t){null===this.Ta&&null===this.I_&&(this.Fi()||(this.Ta=t,this.fu()))}ao(t){if(null===this.Ta)return;const i=(this.Ta-t)/this.Kn();this.F_=l(this.I_).lu+i,this.O_=!0,this.iu()}oo(){null!==this.Ta&&(this.Ta=null,this.pu())}vu(){this.mu(this.us.rightOffset)}mu(t,i=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.F_,n=performance.now();this.Hi.Xs({bu:t=>(t-n)/i>=1,wu:e=>{const r=(e-n)/i;return r>=1?t:s+(t-s)*r}})}bt(t,i){this.O_=!0,this.D_=t,this.P_.p_(t,i),this.iu()}gu(){return this.L_}Mu(){return this.E_}Su(){return this.N_}su(){return this.T_||0}yu(t){const i=t.d_();this.hu(this.qe/i),this.F_=t.Mn()-this.su(),this.iu(),this.O_=!0,this.Hi.ru(),this.Hi.Th()}ku(){const t=this.G_(),i=this.J_();null!==t&&null!==i&&this.yu(new Qi(t,i+this.us.rightOffset))}Cu(t){const i=new Qi(t.from,t.to);this.yu(i)}Ui(t){return void 0!==this.Aa.timeFormatter?this.Aa.timeFormatter(t.w_):this.xu.Jo(new Date(1e3*t.ot.o_))}au(){const{handleScroll:t,handleScale:i}=this.Hi.F();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset.time||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}G_(){return 0===this.D_.length?null:0}J_(){return 0===this.D_.length?null:this.D_.length-1}Tu(t){return(this.qe-1-t)/this.W_}eu(t){const i=this.Tu(t),s=this.su()+this.F_-i;return Math.round(1e6*s)/1e6}hu(t){const i=this.W_;this.W_=t,this.tu(),i!==this.W_&&(this.O_=!0,this.Du())}Y_(){if(!this.O_)return;if(this.O_=!1,this.Fi())return void this.Pu(ss.x_());const t=this.su(),i=this.qe/this.W_,s=this.F_+t,n=new Qi(s-i+1,s);this.Pu(new ss(n))}tu(){const t=this.Ru();if(this.W_<t&&(this.W_=t,this.O_=!0),0!==this.qe){const t=.5*this.qe;this.W_>t&&(this.W_=t,this.O_=!0)}}Ru(){return this.us.fixLeftEdge&&this.us.fixRightEdge&&0!==this.D_.length?this.qe/this.D_.length:this.us.minBarSpacing}iu(){const t=this.Au();this.F_>t&&(this.F_=t,this.O_=!0);const i=this.Ou();null!==i&&this.F_<i&&(this.F_=i,this.O_=!0)}Ou(){const t=this.G_(),i=this.T_;if(null===t||null===i)return null;return t-i-1+(this.us.fixLeftEdge?this.qe/this.W_:Math.min(2,this.D_.length))}Au(){return this.us.fixRightEdge?0:this.qe/this.W_-Math.min(2,this.D_.length)}fu(){this.I_={Kn:this.Kn(),lu:this.lu()}}pu(){this.I_=null}ou(t){let i=this.R_.get(t.b_);return void 0===i&&(i=new Ji((t=>this.Lu(t))),this.R_.set(t.b_,i)),i.Jo(t)}Lu(t){const i=function(t,i,s){switch(t){case 0:case 10:return i?s?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.b_,this.us.timeVisible,this.us.secondsVisible);return void 0!==this.us.tickMarkFormatter?this.us.tickMarkFormatter(t.w_,i,this.Aa.locale):function(t,i,s){const n={};switch(i){case 0:n.year="numeric";break;case 1:n.month="short";break;case 2:n.day="numeric";break;case 3:n.hour12=!1,n.hour="2-digit",n.minute="2-digit";break;case 4:n.hour12=!1,n.hour="2-digit",n.minute="2-digit",n.second="2-digit"}const e=void 0===t.a_?new Date(1e3*t.o_):new Date(Date.UTC(t.a_.year,t.a_.month-1,t.a_.day));return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()).toLocaleString(s,n)}(t.ot,i,this.Aa.locale)}Pu(t){const i=this.A_;this.A_=t,ts(i.k_(),this.A_.k_())||this.L_.m(),ts(i.C_(),this.A_.C_())||this.E_.m(),this.Du()}Du(){this.B_=null}H_(){this.Du(),this.R_.clear()}z_(){const t=this.Aa.dateFormat;this.us.timeVisible?this.xu=new Gi({t_:t,i_:this.us.secondsVisible?"%h:%m:%s":"%h:%m",s_:"   ",n_:this.Aa.locale}):this.xu=new Xi(t,this.Aa.locale)}U_(){if(!this.us.fixLeftEdge)return;const t=this.G_();if(null===t)return;const i=this.Vn();if(null===i)return;const s=i.gn()-t;if(s<0){const t=this.F_-s-1;this.Js(t)}this.tu()}q_(){this.iu(),this.tu()}}class os extends A{constructor(t){super(),this.Eu=new Map,this.Et=t}Z(t){}G(t){if(!this.Et.Ct)return;t.save();let i=0;for(const s of this.Et.Nu){if(0===s.ti.length)continue;t.font=s.D;const n=this.Iu(t,s.ti);n>this.Et.Xt?s.du=this.Et.Xt/n:s.du=1,i+=s.Bu*s.du}let s=0;switch(this.Et.Vu){case"top":s=0;break;case"center":s=Math.max((this.Et.Zt-i)/2,0);break;case"bottom":s=Math.max(this.Et.Zt-i,0)}t.fillStyle=this.Et.R;for(const i of this.Et.Nu){t.save();let n=0;switch(this.Et.Fu){case"left":t.textAlign="left",n=i.Bu/2;break;case"center":t.textAlign="center",n=this.Et.Xt/2;break;case"right":t.textAlign="right",n=this.Et.Xt-1-i.Bu/2}t.translate(n,s),t.textBaseline="top",t.font=i.D,t.scale(i.du,i.du),t.fillText(i.ti,0,i.Wu),t.restore(),s+=i.Bu*i.du}t.restore()}Iu(t,i){const s=this.zu(t.font);let n=s.get(i);return void 0===n&&(n=t.measureText(i).width,s.set(i,n)),n}zu(t){let i=this.Eu.get(t);return void 0===i&&(i=new Map,this.Eu.set(t,i)),i}}class _s{constructor(t){this.ft=!0,this.zt={Ct:!1,R:"",Zt:0,Xt:0,Nu:[],Vu:"center",Fu:"center"},this.jt=new os(this.zt),this.Ht=t}bt(){this.ft=!0}gt(t,i){return this.ft&&(this.Mt(t,i),this.ft=!1),this.jt}Mt(t,i){const s=this.Ht.F(),n=this.zt;n.Ct=s.visible,n.Ct&&(n.R=s.color,n.Xt=i,n.Zt=t,n.Fu=s.horzAlign,n.Vu=s.vertAlign,n.Nu=[{ti:s.text,D:D(s.fontSize,s.fontFamily,s.fontStyle),Bu:1.2*s.fontSize,Wu:0,du:0}])}}class us extends G{constructor(t,i){super(),this.us=i,this.ws=new _s(this)}Ps(){return[]}Ds(){return[this.ws]}F(){return this.us}As(){this.ws.bt()}}!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(es||(es={}));class cs{constructor(t,i){this.ju=[],this.Hu=[],this.qe=0,this.$u=null,this.Uu=new b,this.qu=new b,this.Yu=null,this.Xu=t,this.us=i,this.Zu=new P(this),this.mo=new as(this,i.timeScale,this.us.localization),this.vt=new Q(this,i.crosshair),this.Ku=new ki(i.crosshair),this.Gu=new us(this,i.watermark),this.Ju(),this.ju[0].Do(2e3),this.Qu=this.tc(0),this.ic=this.tc(1)}fl(){this.sc(it.en())}Th(){this.sc(it.nn())}Tl(){this.sc(new it(1))}pl(t){const i=this.nc(t);this.sc(i)}ec(){return this.$u}rc(t){const i=this.$u;this.$u=t,null!==i&&this.pl(i.hc),null!==t&&this.pl(t.hc)}F(){return this.us}xh(t){w(this.us,t),this.ju.forEach((i=>i.ko(t))),void 0!==t.timeScale&&this.mo.xh(t.timeScale),void 0!==t.localization&&this.mo.j_(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Uu.m(),this.Qu=this.tc(0),this.ic=this.tc(1),this.fl()}lc(t,i){if("left"===t)return void this.xh({leftPriceScale:i});if("right"===t)return void this.xh({rightPriceScale:i});const s=this.ac(t);null!==s&&(s.Pt.xh(i),this.Uu.m())}ac(t){for(const i of this.ju){const s=i.Co(t);if(null!==s)return{$t:i,Pt:s}}return null}yt(){return this.mo}oc(){return this.ju}_c(){return this.Gu}uc(){return this.vt}cc(){return this.qu}dc(t,i){t.Ha(i),this.ru()}Po(t){this.qe=t,this.mo.Po(this.qe),this.ju.forEach((i=>i.Po(t))),this.ru()}Ju(t){const i=new Ui(this.mo,this);void 0!==t?this.ju.splice(t,0,i):this.ju.push(i);const s=void 0===t?this.ju.length-1:t,n=it.en();return n.Fs(s,{Ws:0,zs:!0}),this.sc(n),i}Bo(t,i,s){t.Bo(i,s)}Vo(t,i,s){t.Vo(i,s),this.vl(),this.sc(this.fc(t,2))}Fo(t,i){t.Fo(i),this.sc(this.fc(t,2))}Wo(t,i,s){i.Ba()||t.Wo(i,s)}zo(t,i,s){i.Ba()||(t.zo(i,s),this.vl(),this.sc(this.fc(t,2)))}jo(t,i){i.Ba()||(t.jo(i),this.sc(this.fc(t,2)))}$o(t,i){t.$o(i),this.sc(this.fc(t,2))}vc(t){this.mo.eo(t)}mc(t,i){const s=this.yt();if(s.Fi()||0===i)return;const n=s.Xt();t=Math.max(1,Math.min(t,n)),s.du(t,i),this.ru()}bc(t){this.wc(0),this.gc(t),this.Mc()}Sc(t){this.mo.ro(t),this.ru()}yc(){this.mo.ho(),this.Th()}wc(t){this.mo.lo(t)}gc(t){this.mo.ao(t),this.ru()}Mc(){this.mo.oo(),this.Th()}wt(){return this.Hu}kc(t,i,s){this.vt.gs(t,i);let n=NaN,e=this.mo.nu(t);const r=this.mo.Vn();null!==r&&(e=Math.min(Math.max(r.gn(),e),r.Mn()));const h=s.fs(),l=h.xt();null!==l&&(n=h.ps(i,l)),n=this.Ku.Wl(n,e,s),this.vt.ks(e,n,s),this.Tl(),this.qu.m(this.vt.St(),{x:t,y:i})}Cc(t,i,s,n){this.vt.gs(t,i);let e=NaN,r=this.mo.nu(t);const h=this.mo.Vn();null!==h&&(r=Math.min(Math.max(h.gn(),r),h.Mn()));const l=n.fs(),a=l.xt();null!==a&&(e=l.ps(i,a)),e=this.Ku.Wl(e,r,n),this.vt.ks(r,e,n),this.Tl(),s&&this.qu.m(this.vt.St(),{x:t,y:i})}xc(){this.uc().xs(),this.Tl(),this.qu.m(null,null)}vl(){const t=this.vt.$t();if(null!==t){const i=this.vt.Ss(),s=this.vt.ys();this.kc(i,s,t)}this.vt.As()}Tc(t,i,s){const n=this.mo.vs(0);void 0!==i&&void 0!==s&&this.mo.bt(i,s);const e=this.mo.vs(0),r=this.mo.su(),h=this.mo.Vn();if(null!==h&&null!==n&&null!==e){const i=h.Lr(r),s=n.o_>e.o_,l=null!==t&&t>r&&!s,a=i&&this.mo.F().shiftVisibleRangeOnNewBar;if(l&&!a){const i=t-r;this.mo.Js(this.mo.lu()-i)}}this.mo.cu(t)}wl(t){null!==t&&t.qo()}Ge(t){const i=this.ju.find((i=>i.Ga().includes(t)));return void 0===i?null:i}ru(){this.Gu.As(),this.ju.forEach((t=>t.qo())),this.vl()}M(){this.ju.forEach((t=>t.M())),this.ju.length=0,this.us.localization.priceFormatter=void 0,this.us.localization.timeFormatter=void 0}Dc(){return this.Zu}ir(){return this.Zu.F()}xo(){return this.Uu}Pc(t,i){const s=this.ju[0],n=this.Rc(i,t,s);return this.Hu.push(n),1===this.Hu.length?this.fl():this.Th(),n}Ac(t){const i=this.Ge(t),s=this.Hu.indexOf(t);r(-1!==s,"Series not found"),this.Hu.splice(s,1),l(i).io(t),t.M&&t.M()}dl(t,i){const s=l(this.Ge(t));s.io(t);const n=this.ac(i);if(null===n){const n=t.Xi();s.Ja(t,i,n)}else{const e=n.$t===s?t.Xi():void 0;n.$t.Ja(t,i,e)}}ku(){const t=it.nn();t.$s(),this.sc(t)}Oc(t){const i=it.nn();i.Ys(t),this.sc(i)}Ks(){const t=it.nn();t.Ks(),this.sc(t)}Gs(t){const i=it.nn();i.Gs(t),this.sc(i)}Js(t){const i=it.nn();i.Js(t),this.sc(i)}Xs(t){const i=it.nn();i.Xs(t),this.sc(i)}Us(){const t=it.nn();t.Us(),this.sc(t)}Lc(){return this.us.rightPriceScale.visible?"right":"left"}Ec(){return this.ic}U(){return this.Qu}Ot(t){const i=this.ic,s=this.Qu;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.Yu||this.Yu.vn!==s||this.Yu.mn!==i)this.Yu={vn:s,mn:i,Nc:new Map};else{const i=this.Yu.Nc.get(t);if(void 0!==i)return i}const n=function(t,i,s){const[n,e,r,h]=v(t),[l,a,o,c]=v(i),d=[_(n+s*(l-n)),_(e+s*(a-e)),_(r+s*(o-r)),u(h+s*(c-h))];return`rgba(${d[0]}, ${d[1]}, ${d[2]}, ${d[3]})`}(s,i,t/100);return this.Yu.Nc.set(t,n),n}fc(t,i){const s=new it(i);if(null!==t){const n=this.ju.indexOf(t);s.Fs(n,{Ws:i})}return s}nc(t,i){return void 0===i&&(i=2),this.fc(this.Ge(t),i)}sc(t){this.Xu&&this.Xu(t),this.ju.forEach((t=>t.Xo().Dh().bt()))}Rc(t,i,s){const n=new yi(this,t,i),e=void 0!==t.priceScaleId?t.priceScaleId:this.Lc();return s.Ja(n,e),tt(e)||n.xh(t),n}tc(t){const i=this.us.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}}function ds(t){return!g(t)&&!S(t)}function fs(t){return g(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(rs||(rs={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(hs||(hs={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(ls||(ls={}));class ps{constructor(t,i){this.Bt=t,this.Vt=i}hh(t){return this.Bt===t.Bt&&this.Vt===t.Vt}}function vs(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function ms(t){const i=l(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function bs(i,s){const n=l(i.ownerDocument).createElement("canvas");i.appendChild(n);const e=t(n,{allowDownsampling:!1});return e.resizeCanvas({width:s.Bt,height:s.Vt}),e}function ws(t,i){return t.Ic-i.Ic}function gs(t,i,s){const n=(t.Ic-i.Ic)/(t.ot-i.ot);return Math.sign(n)*Math.min(Math.abs(n),s)}class Ms{constructor(t,i,s,n){this.Bc=null,this.Vc=null,this.Fc=null,this.Wc=null,this.zc=null,this.jc=0,this.Hc=0,this.$c=t,this.Uc=i,this.qc=s,this.rn=n}Yc(t,i){if(null!==this.Bc){if(this.Bc.ot===i)return void(this.Bc.Ic=t);if(Math.abs(this.Bc.Ic-t)<this.rn)return}this.Wc=this.Fc,this.Fc=this.Vc,this.Vc=this.Bc,this.Bc={ot:i,Ic:t}}cr(t,i){if(null===this.Bc||null===this.Vc)return;if(i-this.Bc.ot>50)return;let s=0;const n=gs(this.Bc,this.Vc,this.Uc),e=ws(this.Bc,this.Vc),r=[n],h=[e];if(s+=e,null!==this.Fc){const t=gs(this.Vc,this.Fc,this.Uc);if(Math.sign(t)===Math.sign(n)){const i=ws(this.Vc,this.Fc);if(r.push(t),h.push(i),s+=i,null!==this.Wc){const t=gs(this.Fc,this.Wc,this.Uc);if(Math.sign(t)===Math.sign(n)){const i=ws(this.Fc,this.Wc);r.push(t),h.push(i),s+=i}}}}let l=0;for(let t=0;t<r.length;++t)l+=h[t]/s*r[t];Math.abs(l)<this.$c||(this.zc={Ic:t,ot:i},this.Hc=l,this.jc=function(t,i){const s=Math.log(i);return Math.log(1*s/-t)/s}(Math.abs(l),this.qc))}wu(t){const i=l(this.zc),s=t-i.ot;return i.Ic+this.Hc*(Math.pow(this.qc,s)-1)/Math.log(this.qc)}bu(t){return null===this.zc||this.Xc(t)===this.jc}Xc(t){const i=t-l(this.zc).ot;return Math.min(i,this.jc)}}const Ss="undefined"!=typeof window;function ys(){return!!Ss&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function ks(){return!!Ss&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function Cs(t){Ss&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}class xs{constructor(t,i,s){this.Zc=0,this.Kc=null,this.Gc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.Jc=0,this.Qc=null,this.td={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.sd=null,this.nd=!1,this.ed=null,this.rd=null,this.hd=!1,this.ld=!1,this.ad=!1,this.od=null,this._d=null,this.ud=null,this.dd=null,this.fd=null,this.pd=null,this.vd=null,this.md=0,this.bd=!1,this.wd=!1,this.gd=!1,this.Md=0,this.Sd=null,this.yd=!ks(),this.kd=t=>{this.Cd(t)},this.xd=t=>{if(this.Td(t)){const i=this.Dd(t);if(++this.Jc,this.Qc&&this.Jc>1){const{Pd:s}=this.Rd(Ps(t),this.td);s<30&&!this.ad&&this.Ad(i,this.Ld.Od),this.Ed()}}else{const i=this.Dd(t);if(++this.Zc,this.Kc&&this.Zc>1){const{Pd:s}=this.Rd(Ps(t),this.Gc);s<5&&!this.ld&&this.Nd(i,this.Ld.Id),this.Bd()}}},this.Vd=t,this.Ld=i,this.us=s,this.Fd()}M(){null!==this.od&&(this.od(),this.od=null),null!==this._d&&(this._d(),this._d=null),null!==this.dd&&(this.dd(),this.dd=null),null!==this.fd&&(this.fd(),this.fd=null),null!==this.pd&&(this.pd(),this.pd=null),null!==this.ud&&(this.ud(),this.ud=null),this.Wd(),this.Bd()}zd(t){this.dd&&this.dd();const i=this.jd.bind(this);if(this.dd=()=>{this.Vd.removeEventListener("mousemove",i)},this.Vd.addEventListener("mousemove",i),this.Td(t))return;const s=this.Dd(t);this.Nd(s,this.Ld.Hd),this.yd=!0}Bd(){null!==this.Kc&&clearTimeout(this.Kc),this.Zc=0,this.Kc=null,this.Gc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}Ed(){null!==this.Qc&&clearTimeout(this.Qc),this.Jc=0,this.Qc=null,this.td={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}jd(t){if(this.gd||null!==this.rd)return;if(this.Td(t))return;const i=this.Dd(t);this.Nd(i,this.Ld.$d),this.yd=!0}Ud(t){const i=As(t.changedTouches,l(this.Sd));if(null===i)return;if(this.Md=Rs(t),null!==this.vd)return;if(this.wd)return;this.bd=!0;const s=this.Rd(Ps(i),l(this.rd)),{qd:n,Yd:e,Pd:r}=s;if(this.hd||!(r<5)){if(!this.hd){const t=.5*n,i=e>=t&&!this.us.Xd(),s=t>e&&!this.us.Zd();i||s||(this.wd=!0),this.hd=!0,this.ad=!0,this.Wd(),this.Ed()}if(!this.wd){const s=this.Dd(t,i);this.Ad(s,this.Ld.Kd),Ds(t)}}}Gd(t){if(0!==t.button)return;const i=this.Rd(Ps(t),l(this.ed)),{Pd:s}=i;if(s>=5&&(this.ld=!0,this.Bd()),this.ld){const i=this.Dd(t);this.Nd(i,this.Ld.Jd)}}Rd(t,i){const s=Math.abs(i.nt-t.nt),n=Math.abs(i.et-t.et);return{qd:s,Yd:n,Pd:s+n}}Qd(t){let i=As(t.changedTouches,l(this.Sd));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.Sd=null,this.Md=Rs(t),this.Wd(),this.rd=null,this.pd&&(this.pd(),this.pd=null);const s=this.Dd(t,i);if(this.Ad(s,this.Ld.tf),++this.Jc,this.Qc&&this.Jc>1){const{Pd:t}=this.Rd(Ps(i),this.td);t<30&&!this.ad&&this.Ad(s,this.Ld.Od),this.Ed()}else this.ad||(this.Ad(s,this.Ld.if),this.Ld.if&&Ds(t));0===this.Jc&&Ds(t),0===t.touches.length&&this.nd&&(this.nd=!1,Ds(t))}Cd(t){if(0!==t.button)return;const i=this.Dd(t);if(this.ed=null,this.gd=!1,this.fd&&(this.fd(),this.fd=null),ys()){this.Vd.ownerDocument.documentElement.removeEventListener("mouseleave",this.kd)}if(!this.Td(t))if(this.Nd(i,this.Ld.sf),++this.Zc,this.Kc&&this.Zc>1){const{Pd:s}=this.Rd(Ps(t),this.Gc);s<5&&!this.ld&&this.Nd(i,this.Ld.Id),this.Bd()}else this.ld||this.Nd(i,this.Ld.nf)}Wd(){null!==this.sd&&(clearTimeout(this.sd),this.sd=null)}ef(t){if(null!==this.Sd)return;const i=t.changedTouches[0];this.Sd=i.identifier,this.Md=Rs(t);const s=this.Vd.ownerDocument.documentElement;this.ad=!1,this.hd=!1,this.wd=!1,this.rd=Ps(i),this.pd&&(this.pd(),this.pd=null);{const i=this.Ud.bind(this),n=this.Qd.bind(this);this.pd=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",n)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",n,{passive:!1}),this.Wd(),this.sd=setTimeout(this.rf.bind(this,t),240)}const n=this.Dd(t,i);this.Ad(n,this.Ld.hf),this.Qc||(this.Jc=0,this.Qc=setTimeout(this.Ed.bind(this),500),this.td=Ps(i))}lf(t){if(0!==t.button)return;const i=this.Vd.ownerDocument.documentElement;ys()&&i.addEventListener("mouseleave",this.kd),this.ld=!1,this.ed=Ps(t),this.fd&&(this.fd(),this.fd=null);{const t=this.Gd.bind(this),s=this.Cd.bind(this);this.fd=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",s)}if(this.gd=!0,this.Td(t))return;const s=this.Dd(t);this.Nd(s,this.Ld.af),this.Kc||(this.Zc=0,this.Kc=setTimeout(this.Bd.bind(this),500),this.Gc=Ps(t))}Fd(){this.Vd.addEventListener("mouseenter",this.zd.bind(this)),this.Vd.addEventListener("touchcancel",this.Wd.bind(this));{const t=this.Vd.ownerDocument,i=t=>{this.Ld._f&&(t.composed&&this.Vd.contains(t.composedPath()[0])||t.target&&this.Vd.contains(t.target)||this.Ld._f())};this._d=()=>{t.removeEventListener("touchstart",i)},this.od=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}ks()&&(this.ud=()=>{this.Vd.removeEventListener("dblclick",this.xd)},this.Vd.addEventListener("dblclick",this.xd)),this.Vd.addEventListener("mouseleave",this.uf.bind(this)),this.Vd.addEventListener("touchstart",this.ef.bind(this),{passive:!0}),Cs(this.Vd),this.Vd.addEventListener("mousedown",this.lf.bind(this)),this.cf(),this.Vd.addEventListener("touchmove",(()=>{}),{passive:!1})}cf(){void 0===this.Ld.df&&void 0===this.Ld.ff&&void 0===this.Ld.pf||(this.Vd.addEventListener("touchstart",(t=>this.vf(t.touches)),{passive:!0}),this.Vd.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.vd&&void 0!==this.Ld.ff){const i=Ts(t.touches[0],t.touches[1])/this.md;this.Ld.ff(this.vd,i),Ds(t)}}),{passive:!1}),this.Vd.addEventListener("touchend",(t=>{this.vf(t.touches)})))}vf(t){1===t.length&&(this.bd=!1),2!==t.length||this.bd||this.nd?this.mf():this.bf(t)}bf(t){const i=this.Vd.getBoundingClientRect()||{left:0,top:0};this.vd={nt:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,et:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.md=Ts(t[0],t[1]),void 0!==this.Ld.df&&this.Ld.df(),this.Wd()}mf(){null!==this.vd&&(this.vd=null,void 0!==this.Ld.pf&&this.Ld.pf())}uf(t){if(this.dd&&this.dd(),this.Td(t))return;if(!this.yd)return;const i=this.Dd(t);this.Nd(i,this.Ld.wf),this.yd=!ks()}rf(t){const i=As(t.touches,l(this.Sd));if(null===i)return;const s=this.Dd(t,i);this.Ad(s,this.Ld.gf),this.ad=!0,this.nd=!0}Td(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:Rs(t)<this.Md+500}Ad(t,i){i&&i.call(this.Ld,t)}Nd(t,i){i&&i.call(this.Ld,t)}Dd(t,i){const s=i||t,n=this.Vd.getBoundingClientRect()||{left:0,top:0};return{Mf:s.clientX,Sf:s.clientY,yf:s.pageX,kf:s.pageY,Cf:s.screenX,xf:s.screenY,Tf:s.clientX-n.left,Df:s.clientY-n.top,Pf:t.ctrlKey,Rf:t.altKey,Af:t.shiftKey,Of:t.metaKey,Lf:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,Ef:t.type,Nf:s.target,If:t.view,Bf:()=>{"touchstart"!==t.type&&Ds(t)}}}}function Ts(t,i){const s=t.clientX-i.clientX,n=t.clientY-i.clientY;return Math.sqrt(s*s+n*n)}function Ds(t){t.cancelable&&t.preventDefault()}function Ps(t){return{nt:t.pageX,et:t.pageY}}function Rs(t){return t.timeStamp||performance.now()}function As(t,i){for(let s=0;s<t.length;++s)if(t[s].identifier===i)return t[s];return null}class Os{constructor(t,i,s,n){this.Bi=null,this.Vf=null,this.Ff=!1,this.Wf=new zt(200),this.Nr=null,this.zf=0,this.jf=!1,this.Hf=()=>{this.jf||this.Qi.$f().Ut().Th()},this.Uf=()=>{this.jf||this.Qi.$f().Ut().Th()},this.Qi=t,this.us=i,this.Ra=i.layout,this.Zu=s,this.qf="left"===n,this.Yf=document.createElement("div"),this.Yf.style.height="100%",this.Yf.style.overflow="hidden",this.Yf.style.width="25px",this.Yf.style.left="0",this.Yf.style.position="relative",this.Xf=bs(this.Yf,new ps(16,16)),this.Xf.subscribeCanvasConfigured(this.Hf);const e=this.Xf.canvas;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.Zf=bs(this.Yf,new ps(16,16)),this.Zf.subscribeCanvasConfigured(this.Uf);const r=this.Zf.canvas;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0";const h={af:this.Kf.bind(this),hf:this.Kf.bind(this),Jd:this.Gf.bind(this),Kd:this.Gf.bind(this),_f:this.Jf.bind(this),sf:this.Qf.bind(this),tf:this.Qf.bind(this),Id:this.tp.bind(this),Od:this.tp.bind(this),Hd:this.ip.bind(this),wf:this.sp.bind(this)};this.np=new xs(this.Zf.canvas,h,{Xd:()=>!1,Zd:()=>!0})}M(){this.np.M(),this.Zf.unsubscribeCanvasConfigured(this.Uf),this.Zf.destroy(),this.Xf.unsubscribeCanvasConfigured(this.Hf),this.Xf.destroy(),null!==this.Bi&&this.Bi.no().v(this),this.Bi=null}ep(){return this.Yf}T(){return this.Ra.fontSize}rp(){const t=this.Zu.F();return this.Nr!==t.D&&(this.Wf.We(),this.Nr=t.D),t}hp(){if(null===this.Bi)return 0;let t=0;const i=this.rp(),s=ms(this.Xf.canvas),n=this.Bi.Gl();s.font=this.lp(),n.length>0&&(t=Math.max(this.Wf.Mi(s,n[0]._a),this.Wf.Mi(s,n[n.length-1]._a)));const e=this.ap();for(let i=e.length;i--;){const n=this.Wf.Mi(s,e[i].ti());n>t&&(t=n)}const r=this.Bi.xt();if(null!==r&&null!==this.Vf){const i=this.Bi.ps(1,r),n=this.Bi.ps(this.Vf.Vt-2,r);t=Math.max(t,this.Wf.Mi(s,this.Bi.Wi(Math.floor(Math.min(i,n))+.11111111111111,r)),this.Wf.Mi(s,this.Bi.Wi(Math.ceil(Math.max(i,n))-.11111111111111,r)))}const h=t||34;let l=Math.ceil(i.k+i.C+i.L+i.N+5+h);return l+=l%2,l}op(t){if(t.Bt<0||t.Vt<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.Vf&&this.Vf.hh(t)||(this.Vf=t,this.jf=!0,this.Xf.resizeCanvas({width:t.Bt,height:t.Vt}),this.Zf.resizeCanvas({width:t.Bt,height:t.Vt}),this.jf=!1,this.Yf.style.width=t.Bt+"px",this.Yf.style.height=t.Vt+"px",this.Yf.style.minWidth=t.Bt+"px")}_p(){return l(this.Vf).Bt}Ki(t){this.Bi!==t&&(null!==this.Bi&&this.Bi.no().v(this),this.Bi=t,t.no().l(this.Ma.bind(this),this))}Pt(){return this.Bi}We(){const t=this.Qi.up();this.Qi.$f().Ut().$o(t,l(this.Pt()))}cp(t){if(null===this.Vf)return;if(1!==t){const t=ms(this.Xf.canvas);this.dp(),this.fp(t,this.Xf.pixelRatio),this.ke(t,this.Xf.pixelRatio),this.pp(t,this.Xf.pixelRatio),this.vp(t,this.Xf.pixelRatio)}const i=ms(this.Zf.canvas),s=this.Vf.Bt,n=this.Vf.Vt;F(i,this.Zf.pixelRatio,(()=>{i.clearRect(0,0,s,n)})),this.mp(i,this.Zf.pixelRatio)}bp(){return this.Xf.canvas}bt(){var t;null===(t=this.Bi)||void 0===t||t.Gl()}Kf(t){if(null===this.Bi||this.Bi.Fi()||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.$f().Ut(),s=this.Qi.up();this.Ff=!0,i.Bo(s,this.Bi,t.Df)}Gf(t){if(null===this.Bi||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.$f().Ut(),s=this.Qi.up(),n=this.Bi;i.Vo(s,n,t.Df)}Jf(){if(null===this.Bi||!this.us.handleScale.axisPressedMouseMove.price)return;const t=this.Qi.$f().Ut(),i=this.Qi.up(),s=this.Bi;this.Ff&&(this.Ff=!1,t.Fo(i,s))}Qf(t){if(null===this.Bi||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.$f().Ut(),s=this.Qi.up();this.Ff=!1,i.Fo(s,this.Bi)}tp(t){this.us.handleScale.axisDoubleClickReset.price&&this.We()}ip(t){if(null===this.Bi)return;!this.Qi.$f().Ut().F().handleScale.axisPressedMouseMove.price||this.Bi.ih()||this.Bi.Va()||this.wp(1)}sp(t){this.wp(0)}ap(){const t=[],i=null===this.Bi?void 0:this.Bi;return(s=>{for(let n=0;n<s.length;++n){const e=s[n].Ps(this.Qi.up(),i);for(let i=0;i<e.length;i++)t.push(e[i])}})(this.Qi.up().Ga()),t}fp(t,i){if(null===this.Vf)return;const s=this.Vf.Bt,n=this.Vf.Vt;F(t,i,(()=>{const i=this.Qi.up().Ut(),e=i.U(),r=i.Ec();e===r?W(t,0,0,s,n,e):$(t,0,0,s,n,e,r)}))}ke(t,i){if(null===this.Vf||null===this.Bi||!this.Bi.F().borderVisible)return;t.save(),t.fillStyle=this.Bi.F().borderColor;const s=Math.max(1,Math.floor(this.rp().k*i));let n;n=this.qf?Math.floor(this.Vf.Bt*i)-s:0,t.fillRect(n,0,s,Math.ceil(this.Vf.Vt*i)),t.restore()}pp(t,i){var s;if(null===this.Vf||null===this.Bi)return;const n=this.Bi.Gl();t.save();const e=this.Bi.F();t.strokeStyle=e.borderColor,t.font=this.lp(),t.fillStyle=e.borderColor;const r=this.rp(),h=this.qf?Math.floor((this.Vf.Bt-r.C)*i):0,l=this.qf?Math.round(h-r.L*i):Math.round(h+r.C*i+r.L*i),a=Math.max(1,Math.floor(i)),o=Math.floor(.5*i);if(e.borderVisible&&e.ticksVisible){const s=Math.round(r.C*i);t.beginPath();for(const e of n)t.rect(h,Math.round(e.ql*i)-o,s,a);t.fill()}t.fillStyle=null!==(s=e.textColor)&&void 0!==s?s:this.Ra.textColor,t.textAlign=this.qf?"right":"left",t.textBaseline="middle";const _=n.map((i=>this.Wf.gi(t,i._a)));F(t,i,(()=>{for(let s=n.length;s--;){const e=n[s];t.fillText(e._a,l/i,e.ql+_[s])}})),t.restore()}dp(){if(null===this.Vf||null===this.Bi)return;let t=this.Vf.Vt/2;const i=[],s=this.Bi.Ga().slice(),n=this.Qi.up(),e=this.rp();this.Bi===n.Qe()&&this.Qi.up().Ga().forEach((t=>{n.Je(t)&&s.push(t)}));const r=this.Bi.zl()[0],h=this.Bi;s.forEach((s=>{const e=s.Ps(n,h);e.forEach((t=>{t.Oi(null),t.Li()&&i.push(t)})),r===s&&e.length>0&&(t=e[0].yi())}));const l=i.filter((i=>i.yi()<=t)),a=i.filter((i=>i.yi()>t));l.sort(((t,i)=>i.yi()-t.yi())),l.length&&a.length&&a.push(l[0]),a.sort(((t,i)=>t.yi()-i.yi())),i.forEach((t=>t.Oi(t.yi())));if(this.Bi.F().alignLabels){for(let t=1;t<l.length;t++){const i=l[t],s=l[t-1],n=s.Zt(e,!1),r=i.yi(),h=s.Ai();r>h-n&&i.Oi(h-n)}for(let t=1;t<a.length;t++){const i=a[t],s=a[t-1],n=s.Zt(e,!0),r=i.yi(),h=s.Ai();r<h+n&&i.Oi(h+n)}}}vp(t,i){if(null===this.Vf)return;t.save();const s=this.Vf,n=this.ap(),e=this.rp(),r=this.qf?"right":"left";n.forEach((n=>{if(n.Ei()){const h=n.gt(l(this.Bi));t.save(),h.X(t,e,this.Wf,s.Bt,r,i),t.restore()}})),t.restore()}mp(t,i){if(null===this.Vf||null===this.Bi)return;t.save();const s=this.Vf,n=this.Qi.$f().Ut(),e=[],r=this.Qi.up(),h=n.uc().Ps(r,this.Bi);h.length&&e.push(h);const a=this.rp(),o=this.qf?"right":"left";e.forEach((n=>{n.forEach((n=>{t.save(),n.gt(l(this.Bi)).X(t,a,this.Wf,s.Bt,o,i),t.restore()}))})),t.restore()}wp(t){this.Yf.style.cursor=1===t?"ns-resize":"default"}Ma(){const t=this.hp();this.zf<t&&this.Qi.$f().Ut().fl(),this.zf=t}lp(){return D(this.Ra.fontSize,this.Ra.fontFamily)}}function Ls(t,i,s,n,e){t.K&&t.K(i,s,n,e)}function Es(t,i,s,n,e){t.X(i,s,n,e)}function Ns(t,i){return t.Ds(i)}function Is(t,i){return t.Gi(i)}function Bs(t,i){return void 0!==t.xl?t.xl(i):[]}class Vs{constructor(t,i){this.Vf=new ps(0,0),this.gp=null,this.Mp=null,this.Sp=null,this.yp=!1,this.kp=new b,this.Cp=0,this.xp=!1,this.Tp=null,this.Dp=!1,this.Pp=null,this.Rp=null,this.jf=!1,this.Hf=()=>{this.jf||null===this.Ap||this.Hi().Th()},this.Uf=()=>{this.jf||null===this.Ap||this.Hi().Th()},this.Op=t,this.Ap=i,this.Ap.Yo().l(this.Lp.bind(this),this,!0),this.Ep=document.createElement("td"),this.Ep.style.padding="0",this.Ep.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Np=document.createElement("td"),this.Np.style.padding="0",this.Ip=document.createElement("td"),this.Ip.style.padding="0",this.Ep.appendChild(s),this.Xf=bs(s,new ps(16,16)),this.Xf.subscribeCanvasConfigured(this.Hf);const n=this.Xf.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.Zf=bs(s,new ps(16,16)),this.Zf.subscribeCanvasConfigured(this.Uf);const e=this.Zf.canvas;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0",this.Bp=document.createElement("tr"),this.Bp.appendChild(this.Np),this.Bp.appendChild(this.Ep),this.Bp.appendChild(this.Ip),this.Vp(),this.np=new xs(this.Zf.canvas,this,{Xd:()=>null===this.Tp&&!this.Op.F().handleScroll.vertTouchDrag,Zd:()=>null===this.Tp&&!this.Op.F().handleScroll.horzTouchDrag})}M(){null!==this.gp&&this.gp.M(),null!==this.Mp&&this.Mp.M(),this.Zf.unsubscribeCanvasConfigured(this.Uf),this.Zf.destroy(),this.Xf.unsubscribeCanvasConfigured(this.Hf),this.Xf.destroy(),null!==this.Ap&&this.Ap.Yo().v(this),this.np.M()}up(){return l(this.Ap)}Fp(t){null!==this.Ap&&this.Ap.Yo().v(this),this.Ap=t,null!==this.Ap&&this.Ap.Yo().l(Vs.prototype.Lp.bind(this),this,!0),this.Vp()}$f(){return this.Op}ep(){return this.Bp}Vp(){if(null!==this.Ap&&(this.Wp(),0!==this.Hi().wt().length)){if(null!==this.gp){const t=this.Ap.No();this.gp.Ki(l(t))}if(null!==this.Mp){const t=this.Ap.Io();this.Mp.Ki(l(t))}}}zp(){null!==this.gp&&this.gp.bt(),null!==this.Mp&&this.Mp.bt()}To(){return null!==this.Ap?this.Ap.To():0}Do(t){this.Ap&&this.Ap.Do(t)}Hd(t){if(!this.Ap)return;this.jp();const i=t.Tf,s=t.Df;this.Hp(i,s)}af(t){this.jp(),this.$p(),this.Hp(t.Tf,t.Df)}$d(t){if(!this.Ap)return;this.jp();const i=t.Tf,s=t.Df;this.Hp(i,s);const n=this.Ir(i,s);this.Hi().rc(n&&{hc:n.hc,Up:n.Up})}nf(t){null!==this.Ap&&(this.jp(),this.qp(t))}Jd(t){this.jp(),this.Yp(t),this.Hp(t.Tf,t.Df)}sf(t){null!==this.Ap&&(this.jp(),this.xp=!1,this.Xp(t))}if(t){null!==this.Ap&&this.qp(t)}gf(t){if(this.xp=!0,null===this.Tp){const i={x:t.Tf,y:t.Df};this.Zp(i,i)}}wf(t){null!==this.Ap&&(this.jp(),this.Ap.Ut().rc(null),this.Kp())}Gp(){return this.kp}df(){this.Cp=1,this.Hi().Us()}ff(t,i){if(!this.Op.F().handleScale.pinch)return;const s=5*(i-this.Cp);this.Cp=i,this.Hi().mc(t.nt,s)}hf(t){if(this.xp=!1,this.Dp=null!==this.Tp,this.$p(),null!==this.Tp){const i=this.Hi().uc();this.Pp={x:i.Kt(),y:i.Gt()},this.Tp={x:t.Tf,y:t.Df}}}Kd(t){if(null===this.Ap)return;const i=t.Tf,s=t.Df;if(null===this.Tp)this.Yp(t);else{this.Dp=!1;const t=l(this.Pp),n=t.x+(i-this.Tp.x),e=t.y+(s-this.Tp.y);this.Hp(n,e)}}tf(t){0===this.$f().F().trackingMode.exitMode&&(this.Dp=!0),this.Jp(),this.Xp(t)}Ir(t,i){const s=this.Ap;if(null===s)return null;const n=s.Ga();for(const e of n){const n=this.Qp(e.Ds(s),t,i);if(null!==n)return{hc:e,If:n.If,Up:n.Up}}return null}tv(t,i){l("left"===i?this.gp:this.Mp).op(new ps(t,this.Vf.Vt))}iv(){return this.Vf}op(t){if(t.Bt<0||t.Vt<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.Vf.hh(t)||(this.Vf=t,this.jf=!0,this.Xf.resizeCanvas({width:t.Bt,height:t.Vt}),this.Zf.resizeCanvas({width:t.Bt,height:t.Vt}),this.jf=!1,this.Ep.style.width=t.Bt+"px",this.Ep.style.height=t.Vt+"px")}sv(){const t=l(this.Ap);t.Eo(t.No()),t.Eo(t.Io());for(const i of t.zl())if(t.Je(i)){const s=i.Pt();null!==s&&t.Eo(s),i.As()}}bp(){return this.Xf.canvas}cp(t){if(0===t)return;if(null===this.Ap)return;if(t>1&&this.sv(),null!==this.gp&&this.gp.cp(t),null!==this.Mp&&this.Mp.cp(t),1!==t){const t=ms(this.Xf.canvas);t.save(),this.fp(t,this.Xf.pixelRatio),this.Ap&&(this.nv(t,this.Xf.pixelRatio),this.ev(t,this.Xf.pixelRatio),this.rv(t,this.Xf.pixelRatio,Ns),this.rv(t,this.Xf.pixelRatio,Is)),t.restore()}const i=ms(this.Zf.canvas);i.clearRect(0,0,Math.ceil(this.Vf.Bt*this.Zf.pixelRatio),Math.ceil(this.Vf.Vt*this.Zf.pixelRatio)),this.rv(i,this.Xf.pixelRatio,Bs),this.hv(i,this.Zf.pixelRatio)}lv(){return this.gp}av(){return this.Mp}Lp(){null!==this.Ap&&this.Ap.Yo().v(this),this.Ap=null}qp(t){const i=t.Tf,s=t.Df;this.kp.g()&&this.kp.m(this.Hi().yt().nu(i),{x:i,y:s})}fp(t,i){F(t,i,(()=>{const i=this.Hi(),s=i.U(),n=i.Ec();s===n?W(t,0,0,this.Vf.Bt,this.Vf.Vt,n):$(t,0,0,this.Vf.Bt,this.Vf.Vt,s,n)}))}nv(t,i){const s=l(this.Ap),n=s.Xo().Dh().gt(s.Zt(),s.Xt());null!==n&&(t.save(),n.X(t,i,!1),t.restore())}ev(t,i){const s=this.Hi()._c();this.ov(t,i,Ns,Ls,s),this.ov(t,i,Ns,Es,s)}hv(t,i){this.ov(t,i,Ns,Es,this.Hi().uc())}rv(t,i,s){const n=l(this.Ap).Ga();for(const e of n)this.ov(t,i,s,Ls,e);for(const e of n)this.ov(t,i,s,Es,e)}ov(t,i,s,n,e){const r=l(this.Ap),h=s(e,r),a=r.Zt(),o=r.Xt(),_=r.Ut().ec(),u=null!==_&&_.hc===e,c=null!==_&&u&&void 0!==_.Up?_.Up.Br:void 0;for(const s of h){const e=s.gt(a,o);null!==e&&(t.save(),n(e,t,i,u,c),t.restore())}}Qp(t,i,s){for(const n of t){const t=n.gt(this.Vf.Vt,this.Vf.Bt);if(null!==t&&t.Ir){const e=t.Ir(i,s);if(null!==e)return{If:n,Up:e}}}return null}Wp(){if(null===this.Ap)return;const t=this.Op,i=this.Ap.No().F().visible,s=this.Ap.Io().F().visible;i||null===this.gp||(this.Np.removeChild(this.gp.ep()),this.gp.M(),this.gp=null),s||null===this.Mp||(this.Ip.removeChild(this.Mp.ep()),this.Mp.M(),this.Mp=null);const n=t.Ut().Dc();i&&null===this.gp&&(this.gp=new Os(this,t.F(),n,"left"),this.Np.appendChild(this.gp.ep())),s&&null===this.Mp&&(this.Mp=new Os(this,t.F(),n,"right"),this.Ip.appendChild(this.Mp.ep()))}_v(t){return t.Lf&&this.xp||null!==this.Tp}uv(t){return Math.max(0,Math.min(t,this.Vf.Bt-1))}cv(t){return Math.max(0,Math.min(t,this.Vf.Vt-1))}Hp(t,i){this.Hi().kc(this.uv(t),this.cv(i),l(this.Ap))}Kp(){this.Hi().xc()}Jp(){this.Dp&&(this.Tp=null,this.Kp())}Zp(t,i){this.Tp=t,this.Dp=!1,this.Hp(i.x,i.y);const s=this.Hi().uc();this.Pp={x:s.Kt(),y:s.Gt()}}Hi(){return this.Op.Ut()}dv(t,i,s){if(this.Ap)if(s){const s=t,n=i;this.fv(s,n)}else this.Ap.Ut().rc(null),this.Kp()}pv(){this.Kp()}fv(t,i){this.Hi().Cc(this.uv(t),this.cv(i),!1,l(this.Ap))}Xp(t){if(!this.yp)return;const i=this.Hi(),s=this.up();if(i.jo(s,s.fs()),this.Sp=null,this.yp=!1,i.Mc(),null!==this.Rp){const t=performance.now(),s=i.yt();this.Rp.cr(s.lu(),t),this.Rp.bu(t)||i.Xs(this.Rp)}}jp(){this.Tp=null}$p(){if(!this.Ap)return;if(this.Hi().Us(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)l(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.Ap.fs().Fi()&&this.Hi().yt().Fi()}Yp(t){if(null===this.Ap)return;const i=this.Hi(),s=i.yt();if(s.Fi())return;const n=this.Op.F(),e=n.handleScroll,r=n.kineticScroll;if((!e.pressedMouseMove||t.Lf)&&(!e.horzTouchDrag&&!e.vertTouchDrag||!t.Lf))return;const h=this.Ap.fs(),l=performance.now();if(null!==this.Sp||this._v(t)||(this.Sp={x:t.Mf,y:t.Sf,o_:l,Tf:t.Tf,Df:t.Df}),null!==this.Sp&&!this.yp&&(this.Sp.x!==t.Mf||this.Sp.y!==t.Sf)){if(t.Lf&&r.touch||!t.Lf&&r.mouse){const t=s.Kn();this.Rp=new Ms(.2/t,7/t,.997,15/t),this.Rp.Yc(s.lu(),this.Sp.o_)}else this.Rp=null;h.Fi()||i.Wo(this.Ap,h,t.Df),i.wc(t.Tf),this.yp=!0}this.yp&&(h.Fi()||i.zo(this.Ap,h,t.Df),i.gc(t.Tf),null!==this.Rp&&this.Rp.Yc(s.lu(),l))}}class Fs{constructor(t,i,s,n,e){this.ft=!0,this.Vf=new ps(0,0),this.Hf=()=>this.cp(3),this.qf="left"===t,this.Zu=s.Dc,this.us=i,this.vv=n,this.mv=e,this.Yf=document.createElement("div"),this.Yf.style.width="25px",this.Yf.style.height="100%",this.Yf.style.overflow="hidden",this.Xf=bs(this.Yf,new ps(16,16)),this.Xf.subscribeCanvasConfigured(this.Hf)}M(){this.Xf.unsubscribeCanvasConfigured(this.Hf),this.Xf.destroy()}ep(){return this.Yf}iv(){return this.Vf}op(t){if(t.Bt<0||t.Vt<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.Vf.hh(t)||(this.Vf=t,this.Xf.resizeCanvas({width:t.Bt,height:t.Vt}),this.Yf.style.width=`${t.Bt}px`,this.Yf.style.minWidth=`${t.Bt}px`,this.Yf.style.height=`${t.Vt}px`,this.ft=!0)}cp(t){if(t<3&&!this.ft)return;if(0===this.Vf.Bt||0===this.Vf.Vt)return;this.ft=!1;const i=ms(this.Xf.canvas);this.fp(i,this.Xf.pixelRatio),this.ke(i,this.Xf.pixelRatio)}bp(){return this.Xf.canvas}ke(t,i){if(!this.vv())return;const s=this.Vf.Bt;t.save(),t.fillStyle=this.us.timeScale.borderColor;const n=Math.floor(this.Zu.F().k*i),e=this.qf?Math.round(s*i)-n:0;t.fillRect(e,0,n,n),t.restore()}fp(t,i){F(t,i,(()=>{W(t,0,0,this.Vf.Bt,this.Vf.Vt,this.mv())}))}}function Ws(t,i){return t.b_>i.b_?t:i}class zs{constructor(t){this.bv=null,this.wv=null,this.S=null,this.gv=!1,this.Vf=new ps(0,0),this.Mv=new b,this.Wf=new zt(5),this.jf=!1,this.Hf=()=>{this.jf||this.Op.Ut().Th()},this.Uf=()=>{this.jf||this.Op.Ut().Th()},this.Op=t,this.us=t.F().layout,this.Sv=document.createElement("tr"),this.yv=document.createElement("td"),this.yv.style.padding="0",this.kv=document.createElement("td"),this.kv.style.padding="0",this.Yf=document.createElement("td"),this.Yf.style.height="25px",this.Yf.style.padding="0",this.Cv=document.createElement("div"),this.Cv.style.width="100%",this.Cv.style.height="100%",this.Cv.style.position="relative",this.Cv.style.overflow="hidden",this.Yf.appendChild(this.Cv),this.Xf=bs(this.Cv,new ps(16,16)),this.Xf.subscribeCanvasConfigured(this.Hf);const i=this.Xf.canvas;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.Zf=bs(this.Cv,new ps(16,16)),this.Zf.subscribeCanvasConfigured(this.Uf);const s=this.Zf.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.Sv.appendChild(this.yv),this.Sv.appendChild(this.Yf),this.Sv.appendChild(this.kv),this.xv(),this.Op.Ut().xo().l(this.xv.bind(this),this),this.np=new xs(this.Zf.canvas,this,{Xd:()=>!0,Zd:()=>!1})}M(){this.np.M(),null!==this.bv&&this.bv.M(),null!==this.wv&&this.wv.M(),this.Zf.unsubscribeCanvasConfigured(this.Uf),this.Zf.destroy(),this.Xf.unsubscribeCanvasConfigured(this.Hf),this.Xf.destroy()}ep(){return this.Sv}Tv(){return this.bv}Dv(){return this.wv}af(t){if(this.gv)return;this.gv=!0;const i=this.Op.Ut();!i.yt().Fi()&&this.Op.F().handleScale.axisPressedMouseMove.time&&i.vc(t.Tf)}hf(t){this.af(t)}_f(){const t=this.Op.Ut();!t.yt().Fi()&&this.gv&&(this.gv=!1,this.Op.F().handleScale.axisPressedMouseMove.time&&t.yc())}Jd(t){const i=this.Op.Ut();!i.yt().Fi()&&this.Op.F().handleScale.axisPressedMouseMove.time&&i.Sc(t.Tf)}Kd(t){this.Jd(t)}sf(){this.gv=!1;const t=this.Op.Ut();t.yt().Fi()&&!this.Op.F().handleScale.axisPressedMouseMove.time||t.yc()}tf(){this.sf()}Id(){this.Op.F().handleScale.axisDoubleClickReset.time&&this.Op.Ut().Ks()}Od(){this.Id()}Hd(){this.Op.Ut().F().handleScale.axisPressedMouseMove.time&&this.wp(1)}wf(){this.wp(0)}iv(){return this.Vf}Pv(){return this.Mv}Rv(t,i,s){this.Vf&&this.Vf.hh(t)||(this.Vf=t,this.jf=!0,this.Xf.resizeCanvas({width:t.Bt,height:t.Vt}),this.Zf.resizeCanvas({width:t.Bt,height:t.Vt}),this.jf=!1,this.Yf.style.width=t.Bt+"px",this.Yf.style.height=t.Vt+"px",this.Mv.m(t)),null!==this.bv&&this.bv.op(new ps(i,t.Vt)),null!==this.wv&&this.wv.op(new ps(s,t.Vt))}Av(){const t=this.Ov();return Math.ceil(t.k+t.C+t.T+t.I+t.O+t.Lv)}bt(){this.Op.Ut().yt().Gl()}bp(){return this.Xf.canvas}cp(t){if(0===t)return;if(1!==t){const i=ms(this.Xf.canvas);this.fp(i,this.Xf.pixelRatio),this.ke(i,this.Xf.pixelRatio),this.pp(i,this.Xf.pixelRatio),null!==this.bv&&this.bv.cp(t),null!==this.wv&&this.wv.cp(t)}const i=ms(this.Zf.canvas),s=this.Zf.pixelRatio;i.clearRect(0,0,Math.ceil(this.Vf.Bt*s),Math.ceil(this.Vf.Vt*s)),this.Ev([this.Op.Ut().uc()],i,s)}fp(t,i){F(t,i,(()=>{W(t,0,0,this.Vf.Bt,this.Vf.Vt,this.Op.Ut().Ec())}))}ke(t,i){if(this.Op.F().timeScale.borderVisible){t.save(),t.fillStyle=this.Nv();const s=Math.max(1,Math.floor(this.Ov().k*i));t.fillRect(0,0,Math.ceil(this.Vf.Bt*i),s),t.restore()}}pp(t,i){const s=this.Op.Ut().yt(),n=s.Gl();if(!n||0===n.length)return;let e=n.reduce(Ws,n[0]).b_;e>30&&e<50&&(e=30),t.save(),t.strokeStyle=this.Nv();const r=this.Ov(),h=r.k+r.C+r.I+r.T/2;t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.Nv();const l=Math.max(1,Math.floor(i)),a=Math.floor(.5*i),o=s.F();if(o.borderVisible&&o.ticksVisible){t.beginPath();const s=Math.round(r.C*i);for(let e=n.length;e--;){const r=Math.round(n[e].ql*i);t.rect(r-a,0,l,s)}t.fill()}t.fillStyle=this.H(),F(t,i,(()=>{t.font=this.lp();for(const i of n)if(i.b_<e){const s=i._u?this.Iv(t,i.ql,i._a):i.ql;t.fillText(i._a,s,h)}t.font=this.Bv();for(const i of n)if(i.b_>=e){const s=i._u?this.Iv(t,i.ql,i._a):i.ql;t.fillText(i._a,s,h)}})),t.restore()}Iv(t,i,s){const n=this.Wf.Mi(t,s),e=n/2,r=Math.floor(i-e)+.5;return r<0?i+=Math.abs(0-r):r+n>this.Vf.Bt&&(i-=Math.abs(this.Vf.Bt-(r+n))),i}Ev(t,i,s){const n=this.Ov();for(const e of t)for(const t of e.Ji())i.save(),t.gt().X(i,n,s),i.restore()}Nv(){return this.Op.F().timeScale.borderColor}H(){return this.us.textColor}W(){return this.us.fontSize}lp(){return D(this.W(),this.us.fontFamily)}Bv(){return D(this.W(),this.us.fontFamily,"bold")}Ov(){null===this.S&&(this.S={k:1,B:NaN,I:NaN,O:NaN,ji:NaN,C:5,T:NaN,D:"",zi:new zt,Lv:0});const t=this.S,i=this.lp();if(t.D!==i){const s=this.W();t.T=s,t.D=i,t.I=3*s/12,t.O=3*s/12,t.ji=9*s/12,t.B=0,t.Lv=4*s/12,t.zi.We()}return this.S}wp(t){this.Yf.style.cursor=1===t?"ew-resize":"default"}xv(){const t=this.Op.Ut(),i=t.F();i.leftPriceScale.visible||null===this.bv||(this.yv.removeChild(this.bv.ep()),this.bv.M(),this.bv=null),i.rightPriceScale.visible||null===this.wv||(this.kv.removeChild(this.wv.ep()),this.wv.M(),this.wv=null);const s={Dc:this.Op.Ut().Dc()},n=()=>i.leftPriceScale.borderVisible&&t.yt().F().borderVisible,e=()=>t.Ec();i.leftPriceScale.visible&&null===this.bv&&(this.bv=new Fs("left",i,s,n,e),this.yv.appendChild(this.bv.ep())),i.rightPriceScale.visible&&null===this.wv&&(this.wv=new Fs("right",i,s,n,e),this.kv.appendChild(this.wv.ep()))}}class js{constructor(t,i){var s;this.Vv=[],this.Fv=0,this.da=0,this.qe=0,this.Wv=0,this.zv=0,this.jv=null,this.Hv=!1,this.kp=new b,this.qu=new b,this.us=i,this.Sv=document.createElement("div"),this.Sv.classList.add("tv-lightweight-charts"),this.Sv.style.overflow="hidden",this.Sv.style.width="100%",this.Sv.style.height="100%",(s=this.Sv).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.$v=document.createElement("table"),this.$v.setAttribute("cellspacing","0"),this.Sv.appendChild(this.$v),this.Uv=this.qv.bind(this),Hs(this.us)&&this.Yv(!0),this.Hi=new cs(this.Xu.bind(this),this.us),this.Ut().cc().l(this.Xv.bind(this),this),this.Zv=new zs(this),this.$v.appendChild(this.Zv.ep());let n=this.us.width,e=this.us.height;if(0===n||0===e){const i=t.getBoundingClientRect();0===n&&(n=Math.floor(i.width),n-=n%2),0===e&&(e=Math.floor(i.height),e-=e%2)}this.Kv(n,e),this.Gv(),t.appendChild(this.Sv),this.Jv(),this.Hi.yt().Su().l(this.Hi.fl.bind(this.Hi),this),this.Hi.xo().l(this.Hi.fl.bind(this.Hi),this)}Ut(){return this.Hi}F(){return this.us}Qv(){return this.Vv}tm(){return this.Zv}M(){this.Yv(!1),0!==this.Fv&&window.cancelAnimationFrame(this.Fv),this.Hi.cc().v(this),this.Hi.yt().Su().v(this),this.Hi.xo().v(this),this.Hi.M();for(const t of this.Vv)this.$v.removeChild(t.ep()),t.Gp().v(this),t.M();this.Vv=[],l(this.Zv).M(),null!==this.Sv.parentElement&&this.Sv.parentElement.removeChild(this.Sv),this.qu.M(),this.kp.M()}Kv(t,i,s=!1){if(this.da===i&&this.qe===t)return;this.da=i,this.qe=t;const n=i+"px",e=t+"px";l(this.Sv).style.height=n,l(this.Sv).style.width=e,this.$v.style.height=n,this.$v.style.width=e,s?this.im(it.en(),performance.now()):this.Hi.fl()}cp(t){void 0===t&&(t=it.en());for(let i=0;i<this.Vv.length;i++)this.Vv[i].cp(t.Hs(i).Ws);this.us.timeScale.visible&&this.Zv.cp(t.js())}xh(t){const i=Hs(this.us);this.Hi.xh(t);const s=Hs(this.us);s!==i&&this.Yv(s),this.Jv();const n=t.width||this.qe,e=t.height||this.da;this.Kv(n,e)}Gp(){return this.kp}cc(){return this.qu}sm(){null!==this.jv&&(this.im(this.jv,performance.now()),this.jv=null);const t=this.Vv[0],i=function(t,i){const s=t.createElement("canvas"),n=vs(s);return s.style.width=`${i.Bt}px`,s.style.height=`${i.Vt}px`,s.width=i.Bt*n,s.height=i.Vt*n,s}(document,new ps(this.qe,this.da)),s=ms(i),n=vs(i);return F(s,n,(()=>{let i=0,n=0;const e=t=>{for(let e=0;e<this.Vv.length;e++){const r=this.Vv[e],h=r.iv().Vt,a=l("left"===t?r.lv():r.av()),o=a.bp();s.drawImage(o,i,n,a._p(),h),n+=h}};this.nm()&&(e("left"),i=l(t.lv())._p()),n=0;for(let t=0;t<this.Vv.length;t++){const e=this.Vv[t],r=e.iv(),h=e.bp();s.drawImage(h,i,n,r.Bt,r.Vt),n+=r.Vt}i+=t.iv().Bt,this.rm()&&(n=0,e("right"));const r=t=>{const e=l("left"===t?this.Zv.Tv():this.Zv.Dv()),r=e.iv(),h=e.bp();s.drawImage(h,i,n,r.Bt,r.Vt)};if(this.us.timeScale.visible){i=0,this.nm()&&(r("left"),i=l(t.lv())._p());const e=this.Zv.iv(),h=this.Zv.bp();s.drawImage(h,i,n,e.Bt,e.Vt),this.rm()&&(i+=t.iv().Bt,r("right"),s.restore())}})),i}hm(t){if("left"===t&&!this.nm())return 0;if("right"===t&&!this.rm())return 0;if(0===this.Vv.length)return 0;return l("left"===t?this.Vv[0].lv():this.Vv[0].av())._p()}lm(){let t=0,i=0,s=0;for(const n of this.Vv)this.nm()&&(i=Math.max(i,l(n.lv()).hp())),this.rm()&&(s=Math.max(s,l(n.av()).hp())),t+=n.To();const n=this.qe,e=this.da,r=Math.max(n-i-s,0),h=this.us.timeScale.visible;let a=h?this.Zv.Av():0;a%2&&(a+=1);const o=0+a,_=e<o?0:e-o,u=_/t;let c=0;for(let t=0;t<this.Vv.length;++t){const n=this.Vv[t];n.Fp(this.Hi.oc()[t]);let e=0,h=0;h=t===this.Vv.length-1?_-c:Math.round(n.To()*u),e=Math.max(h,2),c+=e,n.op(new ps(r,e)),this.nm()&&n.tv(i,"left"),this.rm()&&n.tv(s,"right"),n.up()&&this.Hi.dc(n.up(),e)}this.Zv.Rv(new ps(h?r:0,a),h?i:0,h?s:0),this.Hi.Po(r),this.Wv!==i&&(this.Wv=i),this.zv!==s&&(this.zv=s)}Yv(t){t?this.Sv.addEventListener("wheel",this.Uv,{passive:!1}):this.Sv.removeEventListener("wheel",this.Uv)}qv(t){let i=t.deltaX/100,s=-t.deltaY/100;if(0!==i&&this.us.handleScroll.mouseWheel||0!==s&&this.us.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,s*=120;break;case t.DOM_DELTA_LINE:i*=32,s*=32}if(0!==s&&this.us.handleScale.mouseWheel){const i=Math.sign(s)*Math.min(1,Math.abs(s)),n=t.clientX-this.Sv.getBoundingClientRect().left;this.Ut().mc(n,i)}0!==i&&this.us.handleScroll.mouseWheel&&this.Ut().bc(-80*i)}}im(t,i){var s;const n=t.js();3===n&&this.am(),3!==n&&2!==n||(this.om(t),this._m(t,i),this.Zv.bt(),this.Vv.forEach((t=>{t.zp()})),3===(null===(s=this.jv)||void 0===s?void 0:s.js())&&(this.jv.tn(t),this.am(),this.om(this.jv),this._m(this.jv,i),t=this.jv,this.jv=null)),this.cp(t)}_m(t,i){for(const s of t.Qs())this.sn(s,i)}om(t){const i=this.Hi.oc();for(let s=0;s<i.length;s++)t.Hs(s).zs&&i[s].Uo()}sn(t,i){const s=this.Hi.yt();switch(t.qs){case 0:s.ku();break;case 1:s.Cu(t.Rt);break;case 2:s.Gs(t.Rt);break;case 3:s.Js(t.Rt);break;case 4:s.uu();break;case 5:t.Rt.bu(i)||s.Js(t.Rt.wu(i))}}Xu(t){null!==this.jv?this.jv.tn(t):this.jv=t,this.Hv||(this.Hv=!0,this.Fv=window.requestAnimationFrame((t=>{if(this.Hv=!1,this.Fv=0,null!==this.jv){const i=this.jv;this.jv=null,this.im(i,t);for(const s of i.Qs())if(5===s.qs&&!s.Rt.bu(t)){this.Ut().Xs(s.Rt);break}}})))}am(){this.Gv()}Gv(){const t=this.Hi.oc(),i=t.length,s=this.Vv.length;for(let t=i;t<s;t++){const t=h(this.Vv.pop());this.$v.removeChild(t.ep()),t.Gp().v(this),t.M()}for(let n=s;n<i;n++){const i=new Vs(this,t[n]);i.Gp().l(this.um.bind(this),this),this.Vv.push(i),this.$v.insertBefore(i.ep(),this.Zv.ep())}for(let s=0;s<i;s++){const i=t[s],n=this.Vv[s];n.up()!==i?n.Fp(i):n.Vp()}this.Jv(),this.lm()}dm(t,i){var s;const n=new Map;if(null!==t){this.Hi.wt().forEach((i=>{const s=i.Ns().Hh(t);null!==s&&n.set(i,s)}))}let e;if(null!==t){const i=null===(s=this.Hi.yt().$i(t))||void 0===s?void 0:s.w_;void 0!==i&&(e=i)}const r=this.Ut().ec(),h=null!==r&&r.hc instanceof yi?r.hc:void 0,l=null!==r&&void 0!==r.Up?r.Up.Fr:void 0;return{ot:e,Yn:null!=t?t:void 0,fm:null!=i?i:void 0,pm:h,vm:n,bm:l}}um(t,i){this.kp.m((()=>this.dm(t,i)))}Xv(t,i){this.qu.m((()=>this.dm(t,i)))}Jv(){const t=this.us.timeScale.visible?"":"none";this.Zv.ep().style.display=t}nm(){return this.Vv[0].up().No().F().visible}rm(){return this.Vv[0].up().Io().F().visible}}function Hs(t){return Boolean(t.handleScroll.mouseWheel||t.handleScale.mouseWheel)}function $s(t,i,s,n){const e=s.value,r={Yn:i,ot:t,Rt:[e,e,e,e],w_:n};return void 0!==s.color&&(r.R=s.color),r}function Us(t){return void 0!==t.Rt}function qs(t){return(i,s,n,e)=>{return void 0===(r=n).open&&void 0===r.value?{ot:i,Yn:s,w_:e}:t(i,s,n,e);var r}}const Ys={Candlestick:qs((function(t,i,s,n){const e={Yn:i,ot:t,Rt:[s.open,s.high,s.low,s.close],w_:n};return void 0!==s.color&&(e.R=s.color),void 0!==s.borderColor&&(e.At=s.borderColor),void 0!==s.wickColor&&(e.Ah=s.wickColor),e})),Bar:qs((function(t,i,s,n){const e={Yn:i,ot:t,Rt:[s.open,s.high,s.low,s.close],w_:n};return void 0!==s.color&&(e.R=s.color),e})),Area:qs((function(t,i,s,n){const e=s.value,r={Yn:i,ot:t,Rt:[e,e,e,e],w_:n};return void 0!==s.lineColor&&(r.lt=s.lineColor),void 0!==s.topColor&&(r.vn=s.topColor),void 0!==s.bottomColor&&(r.mn=s.bottomColor),r})),Baseline:qs((function(t,i,s,n){const e=s.value,r={Yn:i,ot:t,Rt:[e,e,e,e],w_:n};return void 0!==s.topLineColor&&(r.be=s.topLineColor),void 0!==s.bottomLineColor&&(r.we=s.bottomLineColor),void 0!==s.topFillColor1&&(r.de=s.topFillColor1),void 0!==s.topFillColor2&&(r.fe=s.topFillColor2),void 0!==s.bottomFillColor1&&(r.pe=s.bottomFillColor1),void 0!==s.bottomFillColor2&&(r.ve=s.bottomFillColor2),r})),Histogram:qs($s),Line:qs($s)};function Xs(t){return Ys[t]}function Zs(t){return 60*t*60*1e3}function Ks(t){return 60*t*1e3}const Gs=[{wm:(Js=1,1e3*Js),b_:10},{wm:Ks(1),b_:20},{wm:Ks(5),b_:21},{wm:Ks(30),b_:22},{wm:Zs(1),b_:30},{wm:Zs(3),b_:31},{wm:Zs(6),b_:32},{wm:Zs(12),b_:33}];var Js;function Qs(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let s=Gs.length-1;s>=0;--s)if(Math.floor(i.getTime()/Gs[s].wm)!==Math.floor(t.getTime()/Gs[s].wm))return Gs[s].b_;return 0}function tn(t,i=0){if(0===t.length)return;let s=0===i?null:t[i-1].ot.o_,n=null!==s?new Date(1e3*s):null,e=0;for(let r=i;r<t.length;++r){const i=t[r],h=new Date(1e3*i.ot.o_);null!==n&&(i.m_=Qs(h,n)),e+=i.ot.o_-(s||i.ot.o_),s=i.ot.o_,n=h}if(0===i&&t.length>1){const i=Math.ceil(e/(t.length-1)),s=new Date(1e3*(t[0].ot.o_-i));t[0].m_=Qs(new Date(1e3*t[0].ot.o_),s)}}function sn(t){if(!ds(t))throw new Error("time must be of type BusinessDay");const i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{o_:Math.round(i.getTime()/1e3),a_:t}}function nn(t){if(!fs(t))throw new Error("time must be of type isUTCTimestamp");return{o_:t}}function en(t){return 0===t.length?null:ds(t[0].time)?sn:nn}function rn(t){return fs(t)?nn(t):ds(t)?sn(t):sn(hn(t))}function hn(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function ln(t){S(t.time)&&(t.time=hn(t.time))}function an(t){return{Yn:0,gm:new Map,Cl:t}}function on(t){if(void 0!==t&&0!==t.length)return{Mm:t[0].ot.o_,Sm:t[t.length-1].ot.o_}}function _n(t){let i;return t.forEach((t=>{void 0===i&&(i=t.w_)})),h(i)}function un(t){void 0===t.w_&&(t.w_=t.time)}class cn{constructor(){this.ym=new Map,this.km=new Map,this.Cm=new Map,this.xm=[]}M(){this.ym.clear(),this.km.clear(),this.Cm.clear(),this.xm=[]}Tm(t,i){let s=0!==this.ym.size,n=!1;const e=this.km.get(t);if(void 0!==e)if(1===this.km.size)s=!1,n=!0,this.ym.clear();else for(const i of this.xm)i.pointData.gm.delete(t)&&(n=!0);let r=[];if(0!==i.length){const s=i;s.forEach((t=>un(t))),function(t){t.forEach(ln)}(i);const e=l(en(i)),h=Xs(t.Nh());r=s.map((i=>{const s=e(i.time);let r=this.ym.get(s.o_);void 0===r&&(r=an(s),this.ym.set(s.o_,r),n=!0);const l=h(s,r.Yn,i,i.w_);return r.gm.set(t,l),l}))}s&&this.Dm(),this.Pm(t,r);let h=-1;if(n){const t=[];this.ym.forEach((i=>{t.push({m_:0,ot:i.Cl,pointData:i,w_:_n(i.gm)})})),t.sort(((t,i)=>t.ot.o_-i.ot.o_)),h=this.Rm(t)}return this.Am(t,h,function(t,i){const s=on(t),n=on(i);if(void 0!==s&&void 0!==n)return{bl:s.Sm>=n.Sm&&s.Mm>=n.Mm}}(this.km.get(t),e))}Ac(t){return this.Tm(t,[])}Om(t,i){const s=i;un(s),ln(i);const n=l(en([i]))(i.time),e=this.Cm.get(t);if(void 0!==e&&n.o_<e.o_)throw new Error(`Cannot update oldest data, last time=${e.o_}, new time=${n.o_}`);let r=this.ym.get(n.o_);const h=void 0===r;void 0===r&&(r=an(n),this.ym.set(n.o_,r));const a=Xs(t.Nh())(n,r.Yn,i,s.w_);r.gm.set(t,a),this.Lm(t,a);const o={bl:Us(a)};if(!h)return this.Am(t,-1,o);const _={m_:0,ot:r.Cl,pointData:r,w_:_n(r.gm)},u=mt(this.xm,_.ot.o_,((t,i)=>t.ot.o_<i));this.xm.splice(u,0,_);for(let t=u;t<this.xm.length;++t)dn(this.xm[t].pointData,t);return tn(this.xm,u),this.Am(t,u,o)}Lm(t,i){let s=this.km.get(t);void 0===s&&(s=[],this.km.set(t,s));const n=0!==s.length?s[s.length-1]:null;null===n||i.ot.o_>n.ot.o_?Us(i)&&s.push(i):Us(i)?s[s.length-1]=i:s.splice(-1,1),this.Cm.set(t,i.ot)}Pm(t,i){0!==i.length?(this.km.set(t,i.filter(Us)),this.Cm.set(t,i[i.length-1].ot)):(this.km.delete(t),this.Cm.delete(t))}Dm(){for(const t of this.xm)0===t.pointData.gm.size&&this.ym.delete(t.ot.o_)}Rm(t){let i=-1;for(let s=0;s<this.xm.length&&s<t.length;++s){const n=this.xm[s],e=t[s];if(n.ot.o_!==e.ot.o_){i=s;break}e.m_=n.m_,dn(e.pointData,s)}if(-1===i&&this.xm.length!==t.length&&(i=Math.min(this.xm.length,t.length)),-1===i)return-1;for(let s=i;s<t.length;++s)dn(t[s].pointData,s);return tn(t,i),this.xm=t,i}Em(){if(0===this.km.size)return null;let t=0;return this.km.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].Yn))})),t}Am(t,i,s){const n={Nm:new Map,yt:{su:this.Em()}};if(-1!==i)this.km.forEach(((i,e)=>{n.Nm.set(e,{hr:i,Im:e===t?s:void 0})})),this.km.has(t)||n.Nm.set(t,{hr:[],Im:s}),n.yt.Bm=this.xm,n.yt.Vm=i;else{const i=this.km.get(t);n.Nm.set(t,{hr:i||[],Im:s})}return n}}function dn(t,i){t.Yn=i,t.gm.forEach((t=>{t.Yn=i}))}function fn(t){return{value:t.Rt[3],time:t.w_}}function pn(t){const i=fn(t);return void 0!==t.R&&(i.color=t.R),i}function vn(t){return{open:t.Rt[0],high:t.Rt[1],low:t.Rt[2],close:t.Rt[3],time:t.w_}}const mn={Area:function(t){const i=fn(t);return void 0!==t.lt&&(i.lineColor=t.lt),void 0!==t.vn&&(i.topColor=t.vn),void 0!==t.mn&&(i.bottomColor=t.mn),i},Line:pn,Baseline:function(t){const i=fn(t);return void 0!==t.be&&(i.topLineColor=t.be),void 0!==t.we&&(i.bottomLineColor=t.we),void 0!==t.de&&(i.topFillColor1=t.de),void 0!==t.fe&&(i.topFillColor2=t.fe),void 0!==t.pe&&(i.bottomFillColor1=t.pe),void 0!==t.ve&&(i.bottomFillColor2=t.ve),i},Histogram:pn,Bar:function(t){const i=vn(t);return void 0!==t.R&&(i.color=t.R),i},Candlestick:function(t){const i=vn(t),{R:s,At:n,Ah:e}=t;return void 0!==s&&(i.color=s),void 0!==n&&(i.borderColor=n),void 0!==e&&(i.wickColor=e),i}};function bn(t){return mn[t]}const wn={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2}},gn={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:T,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},Mn={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:T},crosshair:{vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},wn),leftPriceScale:Object.assign(Object.assign({},wn),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},wn),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,ticksVisible:!1},watermark:gn,localization:{locale:Ss?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},Sn={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},yn={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},kn={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Cn={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},xn={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Tn={color:"#26a69a",base:0},Dn={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class Pn{constructor(t,i){this.Fm=t,this.Wm=i}applyOptions(t){this.Fm.Ut().lc(this.Wm,t)}options(){return this.Bi().F()}width(){return tt(this.Wm)?this.Fm.hm(this.Wm):0}Bi(){return l(this.Fm.Ut().ac(this.Wm)).Pt}}const Rn={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:""};class An{constructor(t){this.Mh=t}applyOptions(t){this.Mh.xh(t)}options(){return this.Mh.F()}zm(){return this.Mh}}class On{constructor(t,i,s){this.Tn=t,this.jm=i,this.Hm=s}priceFormatter(){return this.Tn.Ol()}priceToCoordinate(t){const i=this.Tn.xt();return null===i?null:this.Tn.Pt().Dt(t,i.Rt)}coordinateToPrice(t){const i=this.Tn.xt();return null===i?null:this.Tn.Pt().ps(t,i.Rt)}barsInLogicalRange(t){if(null===t)return null;const i=new ss(new Qi(t.from,t.to)).k_(),s=this.Tn.Ns();if(s.Fi())return null;const n=s.Hh(i.gn(),1),e=s.Hh(i.Mn(),-1),r=l(s.Wh()),h=l(s.Es());if(null!==n&&null!==e&&n.Yn>e.Yn)return{barsBefore:t.from-r,barsAfter:h-t.to};const a={barsBefore:null===n||n.Yn===r?t.from-r:n.Yn-r,barsAfter:null===e||e.Yn===h?h-t.to:h-e.Yn};return null!==n&&null!==e&&(a.from=n.ot.a_||n.ot.o_,a.to=e.ot.a_||e.ot.o_),a}setData(t){this.Tn.Nh(),this.jm.$m(this.Tn,t)}update(t){this.Tn.Nh(),this.jm.Um(this.Tn,t)}dataByIndex(t,i){const s=this.Tn.Ns().Hh(t,i);return null===s?null:bn(this.seriesType())(s)}setMarkers(t){const i=t.map((t=>Object.assign(Object.assign({},t),{originalTime:t.time,time:rn(t.time)})));this.Tn.gl(i)}markers(){return this.Tn.Ml().map((t=>{const{originalTime:i,time:s}=t,n=function(t,i){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&i.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(n=Object.getOwnPropertySymbols(t);e<n.length;e++)i.indexOf(n[e])<0&&Object.prototype.propertyIsEnumerable.call(t,n[e])&&(s[n[e]]=t[n[e]])}return s}(t,["originalTime","time"]);return Object.assign({time:i},n)}))}applyOptions(t){this.Tn.xh(t)}options(){return k(this.Tn.F())}priceScale(){return this.Hm.priceScale(this.Tn.Pt().Bl())}createPriceLine(t){const i=w(k(Rn),t),s=this.Tn.Sl(i);return new An(s)}removePriceLine(t){this.Tn.yl(t.zm())}seriesType(){return this.Tn.Nh()}}class Ln{constructor(t,i){this.qm=new b,this.E_=new b,this.Mv=new b,this.Hi=t,this.mo=t.yt(),this.Zv=i,this.mo.gu().l(this.Ym.bind(this)),this.mo.Mu().l(this.Xm.bind(this)),this.Zv.Pv().l(this.Zm.bind(this))}M(){this.mo.gu().v(this),this.mo.Mu().v(this),this.Zv.Pv().v(this),this.qm.M(),this.E_.M(),this.Mv.M()}scrollPosition(){return this.mo.lu()}scrollToPosition(t,i){i?this.mo.mu(t,1e3):this.Hi.Js(t)}scrollToRealTime(){this.mo.vu()}getVisibleRange(){var t,i;const s=this.mo.Z_();return null===s?null:{from:null!==(t=s.from.a_)&&void 0!==t?t:s.from.o_,to:null!==(i=s.to.a_)&&void 0!==i?i:s.to.o_}}setVisibleRange(t){const i={from:rn(t.from),to:rn(t.to)},s=this.mo.Q_(i);this.Hi.Oc(s)}getVisibleLogicalRange(){const t=this.mo.X_();return null===t?null:{from:t.gn(),to:t.Mn()}}setVisibleLogicalRange(t){r(t.from<=t.to,"The from index cannot be after the to index."),this.Hi.Oc(t)}resetTimeScale(){this.Hi.Ks()}fitContent(){this.Hi.ku()}logicalToCoordinate(t){const i=this.Hi.yt();return i.Fi()?null:i.Lt(t)}coordinateToLogical(t){return this.mo.Fi()?null:this.mo.nu(t)}timeToCoordinate(t){const i=rn(t),s=this.mo.Fl(i,!1);return null===s?null:this.mo.Lt(s)}coordinateToTime(t){var i;const s=this.Hi.yt(),n=s.nu(t),e=s.vs(n);return null===e?null:null!==(i=e.a_)&&void 0!==i?i:e.o_}width(){return this.Zv.iv().Bt}height(){return this.Zv.iv().Vt}subscribeVisibleTimeRangeChange(t){this.qm.l(t)}unsubscribeVisibleTimeRangeChange(t){this.qm.p(t)}subscribeVisibleLogicalRangeChange(t){this.E_.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.E_.p(t)}subscribeSizeChange(t){this.Mv.l(t)}unsubscribeSizeChange(t){this.Mv.p(t)}applyOptions(t){this.mo.xh(t)}options(){return k(this.mo.F())}Ym(){this.qm.g()&&this.qm.m(this.getVisibleRange())}Xm(){this.E_.g()&&this.E_.m(this.getVisibleLogicalRange())}Zm(t){this.Mv.m(t.Bt,t.Vt)}}function En(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const s=Math.round(t);if(Math.abs(s-t)<1e-8)return i;t*=10}return i}(i.minMove))}function Nn(t){return function(t){if(y(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:{time:i,price:i},axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale){const{axisPressedMouseMove:i,axisDoubleClickReset:s}=t.handleScale;y(i)&&(t.handleScale.axisPressedMouseMove={time:i,price:i}),y(s)&&(t.handleScale.axisDoubleClickReset={time:s,price:s})}const i=t.handleScroll;y(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class In{constructor(t,i){this.Km=new cn,this.Gm=new Map,this.Jm=new Map,this.Qm=new b,this.tb=new b;const s=void 0===i?k(Mn):w(k(Mn),Nn(i));this.Fm=new js(t,s),this.Fm.Gp().l((t=>{this.Qm.g()&&this.Qm.m(this.ib(t()))}),this),this.Fm.cc().l((t=>{this.tb.g()&&this.tb.m(this.ib(t()))}),this);const n=this.Fm.Ut();this.sb=new Ln(n,this.Fm.tm())}remove(){this.Fm.Gp().v(this),this.Fm.cc().v(this),this.sb.M(),this.Fm.M(),this.Gm.clear(),this.Jm.clear(),this.Qm.M(),this.tb.M(),this.Km.M()}resize(t,i,s){this.Fm.Kv(t,i,s)}addAreaSeries(t){return this.nb("Area",Cn,t)}addBaselineSeries(t){return this.nb("Baseline",xn,t)}addBarSeries(t){return this.nb("Bar",yn,t)}addCandlestickSeries(t={}){return function(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}(t),this.nb("Candlestick",Sn,t)}addHistogramSeries(t){return this.nb("Histogram",Tn,t)}addLineSeries(t){return this.nb("Line",kn,t)}setCrossHairXY(t,i,s){var n,e;null===(e=null===(n=this.Fm)||void 0===n?void 0:n.Qv()[0])||void 0===e||e.dv(t,i,s)}clearCrossHair(){this.Fm.Qv()[0].pv()}removeSeries(t){const i=h(this.Gm.get(t)),s=this.Km.Ac(i);this.Fm.Ut().Ac(i),this.eb(s),this.Gm.delete(t),this.Jm.delete(i)}$m(t,i){this.eb(this.Km.Tm(t,i))}Um(t,i){this.eb(this.Km.Om(t,i))}subscribeClick(t){this.Qm.l(t)}unsubscribeClick(t){this.Qm.p(t)}subscribeCrosshairMove(t){this.tb.l(t)}unsubscribeCrosshairMove(t){this.tb.p(t)}priceScale(t){return new Pn(this.Fm,t)}timeScale(){return this.sb}applyOptions(t){this.Fm.xh(Nn(t))}options(){return this.Fm.F()}takeScreenshot(){return this.Fm.sm()}nb(t,i,s={}){En(s.priceFormat);const n=w(k(Dn),k(i),s),e=this.Fm.Ut().Pc(t,n),r=new On(e,this,this);return this.Gm.set(r,e),this.Jm.set(e,r),r}eb(t){const i=this.Fm.Ut();i.Tc(t.yt.su,t.yt.Bm,t.yt.Vm),t.Nm.forEach(((t,i)=>i.tt(t.hr,t.Im))),i.ru()}rb(t){return h(this.Jm.get(t))}ib(t){const i=new Map;t.vm.forEach(((t,s)=>{const n=bn(s.Nh())(t);r(function(t){return void 0!==t.open||void 0!==t.value}(n)),i.set(this.rb(s),n)}));const s=void 0===t.pm?void 0:this.rb(t.pm);return{time:t.ot,logical:t.Yn,point:t.fm,hoveredSeries:s,hoveredMarkerId:t.bm,seriesData:i}}}function Bn(t,i){let s;if(S(t)){const i=document.getElementById(t);r(null!==i,`Cannot find element in DOM with id=${t}`),s=i}else s=t;return new In(s,i)}function Vn(){return"4.0.0-dev+202210142034"}export{ls as ColorType,J as CrosshairMode,rs as LastPriceAnimationMode,s as LineStyle,i as LineType,gi as MismatchDirection,hs as PriceLineSource,zi as PriceScaleMode,ns as TickMarkType,es as TrackingModeExitMode,Bn as createChart,ds as isBusinessDay,fs as isUTCTimestamp,Vn as version};
