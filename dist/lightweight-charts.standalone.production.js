/*!
 * @license
 * TradingView Lightweight Charts v4.0.0-dev+202210141759
 * Copyright (c) 2022 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(){"use strict";var t,i;function s(t,i){const s={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(s)}function n(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(s,i+e),t.lineTo(n,i+e),t.stroke()}function e(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function r(t){if(void 0===t)throw new Error("Value is undefined");return t}function h(t){if(null===t)throw new Error("Value is null");return t}function l(t){return h(r(t))}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps",t[t.Curved=2]="Curved"}(t||(t={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(i||(i={}));const a={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function o(t){return t<0?0:t>255?255:Math.round(t)||0}function _(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const u=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,c=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,d=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,f=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function p(t){(t=t.toLowerCase())in a&&(t=a[t]);{const i=f.exec(t)||d.exec(t);if(i)return[o(parseInt(i[1],10)),o(parseInt(i[2],10)),o(parseInt(i[3],10)),_(i.length<5?1:parseFloat(i[4]))]}{const i=c.exec(t);if(i)return[o(parseInt(i[1],16)),o(parseInt(i[2],16)),o(parseInt(i[3],16)),1]}{const i=u.exec(t);if(i)return[o(17*parseInt(i[1],16)),o(17*parseInt(i[2],16)),o(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function v(t){const i=p(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(s=i,.199*s[0]+.687*s[1]+.114*s[2]>160?"black":"white")};var s}class m{constructor(){this.h=[]}l(t,i,s){const n={o:t,_:i,u:!0===s};this.h.push(n)}p(t){const i=this.h.findIndex((i=>t===i.o));i>-1&&this.h.splice(i,1)}v(t){this.h=this.h.filter((i=>i._!==t))}m(t,i){const s=[...this.h];this.h=this.h.filter((t=>!t.u)),s.forEach((s=>s.o(t,i)))}g(){return this.h.length>0}M(){this.h=[]}}function b(t,...i){for(const s of i)for(const i in s)void 0!==s[i]&&("object"!=typeof s[i]||void 0===t[i]?t[i]=s[i]:b(t[i],s[i]));return t}function w(t){return"number"==typeof t&&isFinite(t)}function g(t){return"number"==typeof t&&t%1==0}function M(t){return"string"==typeof t}function S(t){return"boolean"==typeof t}function y(t){const i=t;if(!i||"object"!=typeof i)return i;let s,n,e;for(n in s=Array.isArray(i)?[]:{},i)i.hasOwnProperty(n)&&(e=i[n],s[n]=e&&"object"==typeof e?y(e):e);return s}function k(t){return null!==t}function C(t){return null===t?void 0:t}const x="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function T(t,i,s){return void 0===i&&(i=x),`${s=void 0!==s?`${s} `:""}${t}px ${i}`}class D{constructor(t){this.S={k:1,C:5,T:NaN,D:"",P:"",R:"",L:"",O:0,A:0,N:0,B:0,I:0},this.V=t}F(){const t=this.S,i=this.W(),s=this.j();return t.T===i&&t.P===s||(t.T=i,t.P=s,t.D=T(i,s),t.B=2.5/12*i,t.O=t.B,t.A=i/12*t.C,t.N=i/12*t.C,t.I=0),t.R=this.$(),t.L=this.H(),this.S}$(){return this.V.F().layout.textColor}H(){return this.V.U()}W(){return this.V.F().layout.fontSize}j(){return this.V.F().layout.fontFamily}}class P{constructor(){this.q=[]}Y(t){this.q=t}X(t,i,s,n){this.q.forEach((e=>{t.save(),e.X(t,i,s,n),t.restore()}))}}class R{X(t,i,s,n){t.save(),t.scale(i,i),this.Z(t,s,n),t.restore()}K(t,i,s,n){t.save(),t.scale(i,i),this.G(t,s,n),t.restore()}G(t,i,s){}}class L extends R{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J||null===this.J.it)return;const i=this.J.it,s=this.J,n=n=>{t.beginPath();for(let e=i.to-1;e>=i.from;--e){const i=s.st[e];t.moveTo(i.nt,i.et),t.arc(i.nt,i.et,n,0,2*Math.PI)}t.fill()};t.fillStyle=s.rt,n(s.ht+2),t.fillStyle=s.lt,n(s.ht)}}function O(){return{st:[{nt:0,et:0,ot:0,_t:0}],lt:"",rt:"",ht:0,it:null}}const A={from:0,to:1};class E{constructor(t,i){this.ut=new P,this.ct=[],this.dt=[],this.ft=!0,this.V=t,this.vt=i,this.ut.Y(this.ct)}bt(t){const i=this.V.wt();i.length!==this.ct.length&&(this.dt=i.map(O),this.ct=this.dt.map((t=>{const i=new L;return i.tt(t),i})),this.ut.Y(this.ct)),this.ft=!0}gt(t,i,s){return this.ft&&(this.Mt(t),this.ft=!1),this.ut}Mt(t){const i=this.V.wt(),s=this.vt.St(),n=this.V.yt();i.forEach(((i,e)=>{var r;const l=this.dt[e],a=i.kt(s);if(null===a||!i.Ct())return void(l.it=null);const o=h(i.xt());l.lt=a.Tt,l.ht=a.ht,l.st[0]._t=a._t,l.st[0].et=i.Pt().Dt(a._t,o.Rt),l.rt=null!==(r=a.Lt)&&void 0!==r?r:this.V.Ot(l.st[0].et/t),l.st[0].ot=s,l.st[0].nt=n.At(s),l.it=A}))}}class N{constructor(t){this.Et=t}X(t,i,e,r){if(null===this.Et)return;const h=this.Et.Nt.Ct,l=this.Et.Bt.Ct;if(!h&&!l)return;t.save();const a=Math.round(this.Et.nt*i),o=Math.round(this.Et.et*i),_=Math.ceil(this.Et.It*i),u=Math.ceil(this.Et.Vt*i);t.lineCap="butt",h&&a>=0&&(t.lineWidth=Math.floor(this.Et.Nt.Ft*i),t.strokeStyle=this.Et.Nt.R,t.fillStyle=this.Et.Nt.R,s(t,this.Et.Nt.Wt),function(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(i+e,s),t.lineTo(i+e,n),t.stroke()}(t,a,0,u)),l&&o>=0&&(t.lineWidth=Math.floor(this.Et.Bt.Ft*i),t.strokeStyle=this.Et.Bt.R,t.fillStyle=this.Et.Bt.R,s(t,this.Et.Bt.Wt),n(t,o,0,_)),t.restore()}}class B{constructor(t){this.ft=!0,this.zt={Nt:{Ft:1,Wt:0,R:"",Ct:!1},Bt:{Ft:1,Wt:0,R:"",Ct:!1},It:0,Vt:0,nt:0,et:0},this.jt=new N(this.zt),this.$t=t}bt(){this.ft=!0}gt(t,i){return this.ft&&(this.Mt(),this.ft=!1),this.jt}Mt(){const t=this.$t.Ct(),i=h(this.$t.Ht()),s=i.Ut().F().crosshair,n=this.zt;n.Bt.Ct=t&&this.$t.qt(i),n.Nt.Ct=t&&this.$t.Yt(),n.Bt.Ft=s.horzLine.width,n.Bt.Wt=s.horzLine.style,n.Bt.R=s.horzLine.color,n.Nt.Ft=s.vertLine.width,n.Nt.Wt=s.vertLine.style,n.Nt.R=s.vertLine.color,n.It=i.Xt(),n.Vt=i.Zt(),n.nt=this.$t.Kt(),n.et=this.$t.Gt()}}function I(t,i,s,n,e,r){t.fillRect(i+r,s,n-2*r,r),t.fillRect(i+r,s+e-r,n-2*r,r),t.fillRect(i,s,r,e),t.fillRect(i+n-r,s,r,e)}function V(t,i,s){t.save(),t.scale(i,i),s(),t.restore()}function F(t,i,s,n,e,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,s,n,e),t.restore()}function W(t,i){return Array.isArray(t)?t.map((t=>0===t?t:t+i)):t+i}function z(t,i,s,n,e,r){let h,l,a,o;if(Array.isArray(r))if(2===r.length){const t=Math.max(0,r[0]),i=Math.max(0,r[1]);h=t,l=t,a=i,o=i}else{if(4!==r.length)throw new Error("Wrong border radius - it should be like css border radius");h=Math.max(0,r[0]),l=Math.max(0,r[1]),a=Math.max(0,r[2]),o=Math.max(0,r[3])}else{const t=Math.max(0,r);h=t,l=t,a=t,o=t}t.beginPath(),t.moveTo(i+h,s),t.lineTo(i+n-l,s),0!==l&&t.arcTo(i+n,s,i+n,s+l,l),t.lineTo(i+n,s+e-a),0!==a&&t.arcTo(i+n,s+e,i+n-a,s+e,a),t.lineTo(i+o,s+e),0!==o&&t.arcTo(i,s+e,i,s+e-o,o),t.lineTo(i,s+h),0!==h&&t.arcTo(i,s,i+h,s,h)}function j(t,i,s,n,e,r,h=0,l=0,a=""){if(t.save(),!h||!a||a===r)return z(t,i,s,n,e,l),t.fillStyle=r,t.fill(),void t.restore();const o=h/2;if("transparent"!==r){z(t,i+h,s+h,n-2*h,e-2*h,W(l,-h)),t.fillStyle=r,t.fill()}if("transparent"!==a){z(t,i+o,s+o,n-h,e-h,W(l,-o)),t.lineWidth=h,t.strokeStyle=a,t.closePath(),t.stroke()}}function $(t,i,s,n,e,r,h){t.save(),t.globalCompositeOperation="copy";const l=t.createLinearGradient(0,0,0,e);l.addColorStop(0,r),l.addColorStop(1,h),t.fillStyle=l,t.fillRect(i,s,n,e),t.restore()}class H{constructor(t,i){this.tt(t,i)}tt(t,i){this.Et=t,this.Jt=i}X(t,i,s,n,e,r){if(!this.Et.Ct)return;t.font=i.D;const h=this.Qt(t,i,s,n,e,r),l=this.Et.R||this.Jt.R,a=this.Jt.t;if(t.fillStyle=this.Jt.t,this.Et.ti){const s=(i,s)=>{h.ii?j(t,h.si,h.ni,h.ei,h.ri,i,h.hi,[h.ht,0,0,h.ht],s):j(t,h.li,h.ni,h.ei,h.ri,i,h.hi,[0,h.ht,h.ht,0],s)};s(a,"transparent"),this.Et.ai&&(t.fillStyle=l,t.fillRect(h.li,h.oi,h._i-h.li,h.ui)),s("transparent",a),this.Et.ci&&(t.fillStyle=i.L,t.fillRect(h.ii?h.di-h.hi:0,h.ni,h.hi,h.fi-h.ni)),t.save(),t.translate(h.pi,(h.ni+h.fi)/2+h.vi),V(t,r,(()=>{t.fillStyle=l,t.fillText(this.Et.ti,0,0)})),t.restore()}}Zt(t,i){return this.Et.Ct?t.T+t.B+t.O:0}Qt(t,i,s,n,e,r){const h=this.Et.ai||!this.Et.mi?i.C:0,l=i.k,a=i.B+this.Jt.bi,o=i.O+this.Jt.wi,_=i.A,u=i.N,c=this.Et.ti,d=i.T,f=s.gi(t,c)*r,p=d+a+o,v=l+_+u+Math.ceil(s.Mi(t,c))+h,m=Math.max(1,Math.floor(r));let b=Math.round(p*r);b%2!=m%2&&(b+=1);const w=this.Et.Si?Math.max(1,Math.floor(l*r)):0,g=Math.round(v*r),M=Math.round(h*r),S=Math.ceil(n*r),y=Math.ceil(_*r);let k=this.Jt.yi;this.Jt.ki&&(k=this.Jt.ki),k=Math.round(k*r)-Math.floor(.5*r);const C=Math.floor(k+m/2-b/2),x=C+b,T="right"===e,D=T?S-w:w,P=S;let R,L,O=D;const A=2*r;return t.textAlign=T?"right":"left",t.textBaseline="middle",T?(O=D-g,R=D-M,L=D-M-y-1):(O=D+g,R=D+M,L=D+M+y),{ii:T,ni:C,oi:k,fi:x,ei:g,ri:b,ht:A,hi:w,si:O,li:D,_i:R,pi:L,ui:m,di:P,vi:f}}}class U{constructor(t){this.Ci={yi:0,R:"#FFF",t:"#000",wi:0,bi:0},this.xi={ti:"",Ct:!1,ai:!0,mi:!1,Lt:"",R:"#FFF",ci:!1,Si:!1},this.Ti={ti:"",Ct:!1,ai:!1,mi:!0,Lt:"",R:"#FFF",ci:!0,Si:!0},this.ft=!0,this.Di=new(t||H)(this.xi,this.Ci),this.Pi=new(t||H)(this.Ti,this.Ci)}ti(){return this.Ri(),this.xi.ti}yi(){return this.Ri(),this.Ci.yi}bt(){this.ft=!0}Zt(t,i=!1){return Math.max(this.Di.Zt(t,i),this.Pi.Zt(t,i))}Li(){return this.Ci.ki||0}Oi(t){this.Ci.ki=t}Ai(){return this.Ri(),this.xi.Ct||this.Ti.Ct}Ei(){return this.Ri(),this.xi.Ct}gt(t){return this.Ri(),this.xi.ai=this.xi.ai&&t.F().ticksVisible,this.Ti.ai=this.Ti.ai&&t.F().ticksVisible,this.Di.tt(this.xi,this.Ci),this.Pi.tt(this.Ti,this.Ci),this.Di}Ni(){return this.Ri(),this.Di.tt(this.xi,this.Ci),this.Pi.tt(this.Ti,this.Ci),this.Pi}Ri(){this.ft&&(this.xi.ai=!0,this.Ti.ai=!1,this.Bi(this.xi,this.Ti,this.Ci))}}class q extends U{constructor(t,i,s){super(),this.$t=t,this.Ii=i,this.Vi=s}Bi(t,i,s){t.Ct=!1;const n=this.$t.F().horzLine;if(!n.labelVisible)return;const e=this.Ii.xt();if(!this.$t.Ct()||this.Ii.Fi()||null===e)return;const r=v(n.labelBackgroundColor);s.t=r.t,s.R=r.i;const h=2/12*this.Ii.T();s.bi=h,s.wi=h;const l=this.Vi(this.Ii);s.yi=l.yi,t.ti=this.Ii.Wi(l._t,e),t.Ct=!0}}const Y=/[1-9]/g;class X{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,s){if(null===this.Et||!1===this.Et.Ct||0===this.Et.ti.length)return;t.font=i.D;const n=Math.round(i.zi.Mi(t,this.Et.ti,Y));if(n<=0)return;t.save();const e=i.ji,r=n+2*e,l=r/2,a=this.Et.Xt;let o=this.Et.yi,_=Math.floor(o-l)+.5;_<0?(o+=Math.abs(0-_),_=Math.floor(o-l)+.5):_+r>a&&(o-=Math.abs(a-(_+r)),_=Math.floor(o-l)+.5);const u=_+r,c=Math.ceil(0+i.k+i.C+i.B+i.T+i.O);t.fillStyle=this.Et.t;const d=Math.round(_*s),f=Math.round(0*s),p=Math.round(u*s),v=Math.round(c*s),m=Math.round(2*s);if(t.beginPath(),t.moveTo(d,f),t.lineTo(d,v-m),t.arcTo(d,v,d+m,v,m),t.lineTo(p-m,v),t.arcTo(p,v,p,v-m,m),t.lineTo(p,f),t.fill(),this.Et.ai){const n=Math.round(this.Et.yi*s),e=f,r=Math.round((e+i.C)*s);t.fillStyle=this.Et.R;const h=Math.max(1,Math.floor(s)),l=Math.floor(.5*s);t.fillRect(n-l,e,h,r-e)}const b=0+i.k+i.C+i.B+i.T/2;t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.Et.R;const w=i.zi.gi(t,"Apr0");t.translate((_+e)*s,(b+w)*s),V(t,s,(()=>t.fillText(h(this.Et).ti,0,0))),t.restore()}}class Z{constructor(t,i,s){this.ft=!0,this.jt=new X,this.zt={Ct:!1,t:"#4c525e",R:"white",ti:"",Xt:0,yi:NaN,ai:!0},this.vt=t,this.$i=i,this.Vi=s}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.jt.tt(this.zt),this.jt}Mt(){const t=this.zt;t.Ct=!1;const i=this.vt.F().vertLine;if(!i.labelVisible)return;const s=this.$i.yt();if(s.Fi())return;t.Xt=s.Xt();const n=this.Vi();if(!n.ot)return;t.yi=n.yi;const e=s.Hi(this.vt.St());t.ti=s.Ui(h(e)),t.Ct=!0;const r=v(i.labelBackgroundColor);t.t=r.t,t.R=r.i,t.ai=s.F().ticksVisible}}class K{constructor(){this.qi=null,this.Yi=0}Xi(){return this.Yi}Zi(t){this.Yi=t}Pt(){return this.qi}Ki(t){this.qi=t}Gi(t){return[]}Ji(){return[]}Ct(){return!0}}var G;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(G||(G={}));class J extends K{constructor(t,i){super(),this.Qi=null,this.ts=NaN,this.ss=0,this.ns=!0,this.es=new Map,this.rs=!1,this.hs=NaN,this.ls=NaN,this.os=NaN,this._s=NaN,this.$i=t,this.us=i,this.cs=new E(t,this);this.ds=((t,i)=>s=>{const n=i(),e=t();if(s===h(this.Qi).fs())return{_t:e,yi:n};{const t=h(s.xt());return{_t:s.ps(n,t),yi:n}}})((()=>this.ts),(()=>this.ls));const s=((t,i)=>()=>({ot:this.$i.yt().vs(t()),yi:i()}))((()=>this.ss),(()=>this.Kt()));this.bs=new Z(this,t,s),this.ws=new B(this)}F(){return this.us}gs(t,i){this.os=t,this._s=i}Ms(){this.os=NaN,this._s=NaN}Ss(){return this.os}ys(){return this._s}ks(t,i,s){this.rs||(this.rs=!0),this.ns=!0,this.Cs(t,i,s)}St(){return this.ss}Kt(){return this.hs}Gt(){return this.ls}Ct(){return this.ns}xs(){this.ns=!1,this.Ts(),this.ts=NaN,this.hs=NaN,this.ls=NaN,this.Qi=null,this.Ms()}Ds(t){return null!==this.Qi?[this.ws,this.cs]:[]}qt(t){return t===this.Qi&&this.us.horzLine.visible}Yt(){return this.us.vertLine.visible}Ps(t,i){this.ns&&this.Qi===t||this.es.clear();const s=[];return this.Qi===t&&s.push(this.Rs(this.es,i,this.ds)),s}Ji(){return this.ns?[this.bs]:[]}Ht(){return this.Qi}Ls(){this.ws.bt(),this.es.forEach((t=>t.bt())),this.bs.bt(),this.cs.bt()}Os(t){return t&&!t.fs().Fi()?t.fs():null}Cs(t,i,s){this.As(t,i,s)&&this.Ls()}As(t,i,s){const n=this.hs,e=this.ls,r=this.ts,h=this.ss,l=this.Qi,a=this.Os(s);this.ss=t,this.hs=isNaN(t)?NaN:this.$i.yt().At(t),this.Qi=s;const o=null!==a?a.xt():null;return null!==a&&null!==o?(this.ts=i,this.ls=a.Dt(i,o)):(this.ts=NaN,this.ls=NaN),n!==this.hs||e!==this.ls||h!==this.ss||r!==this.ts||l!==this.Qi}Ts(){const t=this.$i.wt().map((t=>t.Ns().Es())).filter(k),i=0===t.length?null:Math.max(...t);this.ss=null!==i?i:NaN}Rs(t,i,s){let n=t.get(i);return void 0===n&&(n=new q(this,i,s),t.set(i,n)),n}}function Q(t){return"left"===t||"right"===t}class tt{constructor(t){this.Bs=new Map,this.Is=[],this.Vs=t}Fs(t,i){const s=function(t,i){return void 0===t?i:{Ws:Math.max(t.Ws,i.Ws),zs:t.zs||i.zs}}(this.Bs.get(t),i);this.Bs.set(t,s)}js(){return this.Vs}$s(t){const i=this.Bs.get(t);return void 0===i?{Ws:this.Vs}:{Ws:Math.max(this.Vs,i.Ws),zs:i.zs}}Hs(){this.Us(),this.Is=[{qs:0}]}Ys(t){this.Us(),this.Is=[{qs:1,Rt:t}]}Xs(t){this.Zs(),this.Is.push({qs:5,Rt:t})}Us(){this.Zs(),this.Is.push({qs:6})}Ks(){this.Us(),this.Is=[{qs:4}]}Gs(t){this.Us(),this.Is.push({qs:2,Rt:t})}Js(t){this.Us(),this.Is.push({qs:3,Rt:t})}Qs(){return this.Is}tn(t){for(const i of t.Is)this.sn(i);this.Vs=Math.max(this.Vs,t.Vs),t.Bs.forEach(((t,i)=>{this.Fs(i,t)}))}static nn(){return new tt(2)}static en(){return new tt(3)}sn(t){switch(t.qs){case 0:this.Hs();break;case 1:this.Ys(t.Rt);break;case 2:this.Gs(t.Rt);break;case 3:this.Js(t.Rt);break;case 4:this.Ks();break;case 5:this.Xs(t.Rt);break;case 6:this.Zs()}}Zs(){const t=this.Is.findIndex((t=>5===t.qs));-1!==t&&this.Is.splice(t,1)}}const it=".";function st(t,i){if(!w(t))return"n/a";if(!g(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}class nt{constructor(t,i){if(i||(i=1),w(t)&&g(t)||(t=100),t<0)throw new TypeError("invalid base");this.Ii=t,this.rn=i,this.hn()}format(t){const i=t<0?"−":"";return t=Math.abs(t),i+this.ln(t)}hn(){if(this.an=0,this.Ii>0&&this.rn>0){let t=this.Ii;for(;t>1;)t/=10,this.an++}}ln(t){const i=this.Ii/this.rn;let s=Math.floor(t),n="";const e=void 0!==this.an?this.an:NaN;if(i>1){let r=+(Math.round(t*i)-s*i).toFixed(this.an);r>=i&&(r-=i,s+=1),n=it+st(+r.toFixed(this.an)*this.rn,e)}else s=Math.round(s*i)/i,e>0&&(n=it+st(0,e));return s.toFixed(0)+n}}class et extends nt{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class rt{constructor(t){this.on=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this._n(t):t<999995?i+this._n(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this._n(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this._n(t/1e9)+"B")}_n(t){let i;const s=Math.pow(10,this.on);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this.on).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function ht(t,i,s,n,e,r,h){if(0===i.length||n.from>=i.length)return;const l=i[n.from];let a=r(t,l),o=l;if(n.to-n.from<2){const i=e/2;t.beginPath();const s={nt:l.nt-i,et:l.et},n={nt:l.nt+i,et:l.et};return t.moveTo(s.nt,s.et),t.lineTo(n.nt,n.et),void h(t,a,s,n)}const _=(i,s)=>{h(t,a,o,s),t.beginPath(),a=i,o=s};let u=o;t.beginPath(),t.moveTo(l.nt,l.et);for(let e=n.from+1;e<n.to;++e){u=i[e];const n=r(t,u);switch(s){case 0:t.lineTo(u.nt,u.et);break;case 1:t.lineTo(u.nt,i[e-1].et),n!==a&&(_(n,u),t.lineTo(u.nt,i[e-1].et)),t.lineTo(u.nt,u.et);break;case 2:{const[s,n]=ot(i,e-1,e);t.bezierCurveTo(s.nt,s.et,n.nt,n.et,u.nt,u.et);break}}1!==s&&n!==a&&(_(n,u),t.moveTo(u.nt,u.et))}(o!==u||o===u&&1===s)&&h(t,a,o,u)}function lt(t,i){return{nt:t.nt-i.nt,et:t.et-i.et}}function at(t,i){return{nt:t.nt/i,et:t.et/i}}function ot(t,i,s){const n=Math.max(0,i-1),e=Math.min(t.length-1,s+1);var r,h;return[(r=t[i],h=at(lt(t[s],t[n]),6),{nt:r.nt+h.nt,et:r.et+h.et}),lt(t[s],at(lt(t[e],t[i]),6))]}function _t(t,i,s,n,e){i.lineTo(e.nt,t),i.lineTo(n.nt,t),i.closePath(),i.fillStyle=s,i.fill()}class ut extends R{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J)return;const{st:i,it:n,un:e,Ft:r,Wt:h,cn:l,dn:a}=this.J;null!==n&&(t.lineCap="butt",t.lineJoin="round",t.lineWidth=r,s(t,h),t.lineWidth=1,ht(t,i,l,n,e,this.fn.bind(this),_t.bind(null,a)))}}class ct extends ut{constructor(){super(...arguments),this.pn=null}fn(t,i){const s=this.J,{vn:n,mn:e}=i,r=s.bn;if(null!==this.pn&&this.pn.topColor===n&&this.pn.bottomColor===e&&this.pn.bottom===r)return this.pn.fillStyle;const h=t.createLinearGradient(0,0,0,r);return h.addColorStop(0,n),h.addColorStop(1,e),this.pn={topColor:n,bottomColor:e,fillStyle:h,bottom:r},h}}function dt(t,i){t.strokeStyle=i,t.stroke()}class ft extends R{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J)return;const{st:i,it:n,un:e,cn:r,Ft:h,Wt:l}=this.J;null!==n&&(t.lineCap="butt",t.lineWidth=h,s(t,l),t.lineJoin="round",ht(t,i,r,n,e,this.wn.bind(this),dt))}}class pt extends ft{wn(t,i){return i.lt}}function vt(t,i,s,n=0,e=t.length){let r=e-n;for(;0<r;){const e=r>>1,h=n+e;s(t[h],i)?(n=h+1,r-=e+1):r=e}return n}function mt(t,i,s,n=0,e=t.length){let r=e-n;for(;0<r;){const e=r>>1,h=n+e;s(i,t[h])?r=e:(n=h+1,r-=e+1)}return n}function bt(t,i){return t.ot<i}function wt(t,i){return t<i.ot}function gt(t,i,s){const n=i.gn(),e=i.Mn(),r=vt(t,n,bt),h=mt(t,e,wt);if(!s)return{from:r,to:h};let l=r,a=h;return r>0&&r<t.length&&t[r].ot>=n&&(l=r-1),h>0&&h<t.length&&t[h-1].ot<=e&&(a=h+1),{from:l,to:a}}class Mt{constructor(t,i,s){this.Sn=!0,this.yn=!0,this.kn=!0,this.Cn=[],this.xn=null,this.Tn=t,this.Dn=i,this.Pn=s}bt(t){this.Sn=!0,"data"===t&&(this.yn=!0),"options"===t&&(this.kn=!0)}gt(t,i){return this.Tn.Ct()?(this.Rn(i,t),null===this.xn?null:this.Ln):null}On(){this.Cn=this.Cn.map((t=>Object.assign(Object.assign({},t),this.Tn.En().An(t.ot))))}Nn(){this.xn=null}Rn(t,i){this.yn&&(this.Bn(),this.yn=!1),this.kn&&(this.On(),this.kn=!1),this.Sn&&(this.In(t,i),this.Sn=!1)}In(t,i){const s=this.Tn.Pt(),n=this.Dn.yt();if(this.Nn(),n.Fi()||s.Fi())return;const e=n.Vn();if(null===e)return;if(0===this.Tn.Ns().Fn())return;const r=this.Tn.xt();null!==r&&(this.xn=gt(this.Cn,e,this.Pn),this.Wn(s,n,r.Rt),this.zn(t,i))}}class St extends Mt{constructor(t,i){super(t,i,!0)}Wn(t,i,s){i.jn(this.Cn,C(this.xn)),t.$n(this.Cn,s,C(this.xn))}Hn(t,i){return{ot:t,_t:i,nt:NaN,et:NaN}}Bn(){const t=this.Tn.En();this.Cn=this.Tn.Ns().Un().map((i=>{const s=i.Rt[3];return this.qn(i.Yn,s,t)}))}}class yt extends St{constructor(t,i){super(t,i),this.Ln=new P,this.Xn=new ct,this.Zn=new pt,this.Ln.Y([this.Xn,this.Zn])}qn(t,i,s){return Object.assign(Object.assign({},this.Hn(t,i)),s.An(t))}zn(t,i){const s=this.Tn.F();this.Xn.tt({cn:s.lineType,st:this.Cn,Wt:s.lineStyle,Ft:s.lineWidth,dn:i,bn:i,it:this.xn,un:this.Dn.yt().Kn()}),this.Zn.tt({cn:s.lineType,st:this.Cn,Wt:s.lineStyle,Ft:s.lineWidth,it:this.xn,un:this.Dn.yt().Kn()})}}class kt{constructor(){this.Et=null,this.Gn=0,this.Jn=0}tt(t){this.Et=t}X(t,i,s,n){if(null===this.Et||0===this.Et.Ns.length||null===this.Et.it)return;if(this.Gn=this.Qn(i),this.Gn>=2){Math.max(1,Math.floor(i))%2!=this.Gn%2&&this.Gn--}this.Jn=this.Et.te?Math.min(this.Gn,Math.floor(i)):this.Gn;let e=null;const r=this.Jn<=this.Gn&&this.Et.Kn>=Math.floor(1.5*i);for(let s=this.Et.it.from;s<this.Et.it.to;++s){const n=this.Et.Ns[s];e!==n.ie&&(t.fillStyle=n.ie,e=n.ie);const h=Math.floor(.5*this.Jn),l=Math.round(n.nt*i),a=l-h,o=this.Jn,_=a+o-1,u=Math.min(n.se,n.ne),c=Math.max(n.se,n.ne),d=Math.round(u*i)-h,f=Math.round(c*i)+h,p=Math.max(f-d,this.Jn);t.fillRect(a,d,o,p);const v=Math.ceil(1.5*this.Gn);if(r){if(this.Et.ee){const s=l-v;let e=Math.max(d,Math.round(n.re*i)-h),r=e+o-1;r>d+p-1&&(r=d+p-1,e=r-o+1),t.fillRect(s,e,a-s,r-e+1)}const s=l+v;let e=Math.max(d,Math.round(n.he*i)-h),r=e+o-1;r>d+p-1&&(r=d+p-1,e=r-o+1),t.fillRect(_+1,e,s-_,r-e+1)}}}Qn(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(h(this.Et).Kn,t)))}}class Ct extends Mt{constructor(t,i){super(t,i,!1)}Wn(t,i,s){i.jn(this.Cn,C(this.xn)),t.le(this.Cn,s,C(this.xn))}ae(t,i,s){return{ot:t,oe:i.Rt[0],_e:i.Rt[1],ue:i.Rt[2],ce:i.Rt[3],nt:NaN,re:NaN,se:NaN,ne:NaN,he:NaN}}Bn(){const t=this.Tn.En();this.Cn=this.Tn.Ns().Un().map((i=>this.qn(i.Yn,i,t)))}}class xt extends Ct{constructor(){super(...arguments),this.Ln=new kt}qn(t,i,s){return Object.assign(Object.assign({},this.ae(t,i,s)),s.An(t))}zn(){const t=this.Tn.F();this.Ln.tt({Ns:this.Cn,Kn:this.Dn.yt().Kn(),ee:t.openVisible,te:t.thinBars,it:this.xn})}}function Tt(t,i,s){return Math.min(Math.max(t,i),s)}function Dt(t,i,s){return i-t<=s}function Pt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function Rt(t){const i=Math.ceil(t);return i%2==0?i-1:i}class Lt extends ut{constructor(){super(...arguments),this.pn=null}fn(t,i){const s=this.J,{de:n,fe:e,pe:r,ve:h}=i,{dn:l,bn:a}=s;if(null!==this.pn&&this.pn.topFillColor1===n&&this.pn.topFillColor2===e&&this.pn.bottomFillColor1===r&&this.pn.bottomFillColor2===h&&this.pn.baseLevelCoordinate===l&&this.pn.bottom===a)return this.pn.fillStyle;const o=t.createLinearGradient(0,0,0,a),_=Tt(l/a,0,1);return o.addColorStop(0,n),o.addColorStop(_,e),o.addColorStop(_,r),o.addColorStop(1,h),this.pn={topFillColor1:n,topFillColor2:e,bottomFillColor1:r,bottomFillColor2:h,fillStyle:o,baseLevelCoordinate:l,bottom:a},o}}class Ot extends ft{constructor(){super(...arguments),this.me=null}wn(t,i){const s=this.J,{be:n,we:e}=i,{dn:r,bn:h}=s;if(null!==this.me&&this.me.topLineColor===n&&this.me.bottomLineColor===e&&this.me.baseLevelCoordinate===r&&this.me.bottom===h)return this.me.strokeStyle;const l=t.createLinearGradient(0,0,0,h),a=Tt(r/h,0,1);return l.addColorStop(0,n),l.addColorStop(a,n),l.addColorStop(a,e),l.addColorStop(1,e),this.me={topLineColor:n,bottomLineColor:e,strokeStyle:l,baseLevelCoordinate:r,bottom:h},l}}class At extends St{constructor(t,i){super(t,i),this.Ln=new P,this.ge=new Lt,this.Me=new Ot,this.Ln.Y([this.ge,this.Me])}qn(t,i,s){return Object.assign(Object.assign({},this.Hn(t,i)),s.An(t))}zn(t,i){const s=this.Tn.xt();if(null===s)return;const n=this.Tn.F(),e=this.Tn.Pt().Dt(n.baseValue.price,s.Rt),r=this.Dn.yt().Kn();this.ge.tt({st:this.Cn,Ft:n.lineWidth,Wt:n.lineStyle,cn:n.lineType,dn:e,bn:i,it:this.xn,un:r}),this.Me.tt({st:this.Cn,Ft:n.lineWidth,Wt:n.lineStyle,cn:n.lineType,dn:e,bn:i,it:this.xn,un:r})}}class Et{constructor(){this.Et=null,this.Gn=0}tt(t){this.Et=t}X(t,i,s,n){if(null===this.Et||0===this.Et.Ns.length||null===this.Et.it)return;if(this.Gn=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const s=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),n=Math.floor(t*s*i),e=Math.floor(t*i),r=Math.min(n,e);return Math.max(Math.floor(i),r)}(this.Et.Kn,i),this.Gn>=2){Math.floor(i)%2!=this.Gn%2&&this.Gn--}const e=this.Et.Ns;this.Et.Se&&this.ye(t,e,this.Et.it,i),this.Et.ci&&this.ke(t,e,this.Et.it,this.Et.Kn,i);const r=this.Ce(i);(!this.Et.ci||this.Gn>2*r)&&this.xe(t,e,this.Et.it,i)}ye(t,i,s,n){if(null===this.Et)return;let e="",r=Math.min(Math.floor(n),Math.floor(this.Et.Kn*n));r=Math.max(Math.floor(n),Math.min(r,this.Gn));const h=Math.floor(.5*r);let l=null;for(let a=s.from;a<s.to;a++){const s=i[a];s.Te!==e&&(t.fillStyle=s.Te,e=s.Te);const o=Math.round(Math.min(s.re,s.he)*n),_=Math.round(Math.max(s.re,s.he)*n),u=Math.round(s.se*n),c=Math.round(s.ne*n);let d=Math.round(n*s.nt)-h;const f=d+r-1;null!==l&&(d=Math.max(l+1,d),d=Math.min(d,f));const p=f-d+1;t.fillRect(d,u,p,o-u),t.fillRect(d,_+1,p,c-_),l=f}}Ce(t){let i=Math.floor(1*t);this.Gn<=2*i&&(i=Math.floor(.5*(this.Gn-1)));const s=Math.max(Math.floor(t),i);return this.Gn<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}ke(t,i,s,n,e){if(null===this.Et)return;let r="";const h=this.Ce(e);let l=null;for(let n=s.from;n<s.to;n++){const s=i[n];s.De!==r&&(t.fillStyle=s.De,r=s.De);let a=Math.round(s.nt*e)-Math.floor(.5*this.Gn);const o=a+this.Gn-1,_=Math.round(Math.min(s.re,s.he)*e),u=Math.round(Math.max(s.re,s.he)*e);if(null!==l&&(a=Math.max(l+1,a),a=Math.min(a,o)),this.Et.Kn*e>2*h)I(t,a,_,o-a+1,u-_+1,h);else{const i=o-a+1;t.fillRect(a,_,i,u-_+1)}l=o}}xe(t,i,s,n){if(null===this.Et)return;let e="";const r=this.Ce(n);for(let h=s.from;h<s.to;h++){const s=i[h];let l=Math.round(Math.min(s.re,s.he)*n),a=Math.round(Math.max(s.re,s.he)*n),o=Math.round(s.nt*n)-Math.floor(.5*this.Gn),_=o+this.Gn-1;if(s.ie!==e){const i=s.ie;t.fillStyle=i,e=i}this.Et.ci&&(o+=r,l+=r,_-=r,a-=r),l>a||t.fillRect(o,l,_-o+1,a-l+1)}}}class Nt extends Ct{constructor(){super(...arguments),this.Ln=new Et}qn(t,i,s){return Object.assign(Object.assign({},this.ae(t,i,s)),s.An(t))}zn(){const t=this.Tn.F();this.Ln.tt({Ns:this.Cn,Kn:this.Dn.yt().Kn(),Se:t.wickVisible,ci:t.borderVisible,it:this.xn})}}class Bt{constructor(){this.Et=null,this.Pe=[]}tt(t){this.Et=t,this.Pe=[]}X(t,i,s,n){if(null===this.Et||0===this.Et.st.length||null===this.Et.it)return;this.Pe.length||this.Re(i);const e=Math.max(1,Math.floor(i)),r=Math.round(this.Et.Le*i)-Math.floor(e/2),h=r+e;for(let s=this.Et.it.from;s<this.Et.it.to;s++){const n=this.Et.st[s],l=this.Pe[s-this.Et.it.from],a=Math.round(n.et*i);let o,_;t.fillStyle=n.ie,a<=r?(o=a,_=h):(o=r,_=a-Math.floor(e/2)+e),t.fillRect(l.gn,o,l.Mn-l.gn+1,_-o)}}Re(t){if(null===this.Et||0===this.Et.st.length||null===this.Et.it)return void(this.Pe=[]);const i=Math.ceil(this.Et.Kn*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.Et.Kn*t)-i;this.Pe=new Array(this.Et.it.to-this.Et.it.from);for(let i=this.Et.it.from;i<this.Et.it.to;i++){const n=this.Et.st[i],e=Math.round(n.nt*t);let r,h;if(s%2){const t=(s-1)/2;r=e-t,h=e+t}else{const t=s/2;r=e-t,h=e+t-1}this.Pe[i-this.Et.it.from]={gn:r,Mn:h,Oe:e,Ae:n.nt*t,ot:n.ot}}for(let t=this.Et.it.from+1;t<this.Et.it.to;t++){const s=this.Pe[t-this.Et.it.from],n=this.Pe[t-this.Et.it.from-1];s.ot===n.ot+1&&(s.gn-n.Mn!==i+1&&(n.Oe>n.Ae?n.Mn=s.gn-i-1:s.gn=n.Mn+i+1))}let n=Math.ceil(this.Et.Kn*t);for(let t=this.Et.it.from;t<this.Et.it.to;t++){const i=this.Pe[t-this.Et.it.from];i.Mn<i.gn&&(i.Mn=i.gn);const s=i.Mn-i.gn+1;n=Math.min(s,n)}if(i>0&&n<4)for(let t=this.Et.it.from;t<this.Et.it.to;t++){const i=this.Pe[t-this.Et.it.from];i.Mn-i.gn+1>n&&(i.Oe>i.Ae?i.Mn-=1:i.gn+=1)}}}class It extends St{constructor(){super(...arguments),this.Ln=new Bt}qn(t,i,s){return Object.assign(Object.assign({},this.Hn(t,i)),s.An(t))}zn(){const t={st:this.Cn,Kn:this.Dn.yt().Kn(),it:this.xn,Le:this.Tn.Pt().Dt(this.Tn.F().base,h(this.Tn.xt()).Rt)};this.Ln.tt(t)}}class Vt extends St{constructor(){super(...arguments),this.Ln=new pt}qn(t,i,s){return Object.assign(Object.assign({},this.Hn(t,i)),s.An(t))}zn(){const t=this.Tn.F(),i={st:this.Cn,Wt:t.lineStyle,cn:t.lineType,Ft:t.lineWidth,it:this.xn,un:this.Dn.yt().Kn()};this.Ln.tt(i)}}const Ft=/[2-9]/g;class Wt{constructor(t=50){this.Ee=0,this.Ne=1,this.Be=1,this.Ie={},this.Ve=new Map,this.Fe=t}We(){this.Ee=0,this.Ve.clear(),this.Ne=1,this.Be=1,this.Ie={}}Mi(t,i,s){return this.ze(t,i,s).width}gi(t,i,s){const n=this.ze(t,i,s);return((n.actualBoundingBoxAscent||0)-(n.actualBoundingBoxDescent||0))/2}ze(t,i,s){const n=s||Ft,e=String(i).replace(n,"0");if(this.Ve.has(e))return r(this.Ve.get(e)).je;if(this.Ee===this.Fe){const t=this.Ie[this.Be];delete this.Ie[this.Be],this.Ve.delete(t),this.Be++,this.Ee--}t.save(),t.textBaseline="middle";const h=t.measureText(e);return t.restore(),0===h.width&&i.length||(this.Ve.set(e,{je:h,$e:this.Ne}),this.Ie[this.Ne]=e,this.Ee++,this.Ne++),h}}class zt{constructor(t){this.He=null,this.S=null,this.Ue="right",this.qe=0,this.Ye=t}Xe(t,i,s,n){this.He=t,this.S=i,this.qe=s,this.Ue=n}X(t,i){null!==this.S&&null!==this.He&&this.He.X(t,this.S,this.Ye,this.qe,this.Ue,i)}}class jt{constructor(t,i,s){this.Ze=t,this.Ye=new Wt(50),this.Ke=i,this.V=s,this.W=-1,this.jt=new zt(this.Ye)}gt(t,i){const s=this.V.Ge(this.Ke);if(null===s)return null;const n=s.Je(this.Ke)?s.Qe():this.Ke.Pt();if(null===n)return null;const e=s.tr(n);if("overlay"===e)return null;const r=this.V.ir();return r.T!==this.W&&(this.W=r.T,this.Ye.We()),this.jt.Xe(this.Ze.Ni(),r,i,e),this.jt}}class $t{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,e,r){if(null===this.Et)return;if(!1===this.Et.Ct)return;const h=Math.round(this.Et.et*i);if(h<0||h>Math.ceil(this.Et.Zt*i))return;const l=Math.ceil(this.Et.Xt*i);t.lineCap="butt",t.strokeStyle=this.Et.R,t.lineWidth=Math.floor(this.Et.Ft*i),s(t,this.Et.Wt),n(t,h,0,l)}}class Ht{constructor(t){this.sr={Xt:0,Zt:0,et:0,R:"rgba(0, 0, 0, 0)",Ft:1,Wt:0,Ct:!1},this.nr=new $t,this.ft=!0,this.Tn=t,this.Dn=t.Ut(),this.nr.tt(this.sr)}bt(){this.ft=!0}gt(t,i){return this.Tn.Ct()?(this.ft&&(this.er(t,i),this.ft=!1),this.nr):null}}class Ut extends Ht{constructor(t){super(t)}er(t,i){this.sr.Ct=!1;const s=this.Tn.Pt(),n=s.rr().rr;if(2!==n&&3!==n)return;const e=this.Tn.F();if(!e.baseLineVisible||!this.Tn.Ct())return;const r=this.Tn.xt();null!==r&&(this.sr.Ct=!0,this.sr.et=s.Dt(r.Rt,r.Rt),this.sr.Xt=i,this.sr.Zt=t,this.sr.R=e.baseLineColor,this.sr.Ft=e.baseLineWidth,this.sr.Wt=e.baseLineStyle)}}class qt{constructor(){this.Et=null}tt(t){this.Et=t}hr(){return this.Et}X(t,i,s,n){const e=this.Et;if(null===e)return;t.save();const r=Math.max(1,Math.floor(i)),h=r%2/2,l=Math.round(e.Ae.x*i)+h,a=e.Ae.y*i;t.fillStyle=e.lr,t.beginPath();const o=Math.max(2,1.5*e.ar)*i;t.arc(l,a,o,0,2*Math.PI,!1),t.fill(),t.fillStyle=e._r,t.beginPath(),t.arc(l,a,e.ht*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=r,t.strokeStyle=e.ur,t.beginPath(),t.arc(l,a,e.ht*i+r/2,0,2*Math.PI,!1),t.stroke(),t.restore()}}const Yt=[{cr:0,dr:.25,pr:4,vr:10,mr:.25,br:0,wr:.4,gr:.8},{cr:.25,dr:.525,pr:10,vr:14,mr:0,br:0,wr:.8,gr:0},{cr:.525,dr:1,pr:14,vr:14,mr:0,br:0,wr:0,gr:0}];function Xt(t,i,s,n){return function(t,i){if("transparent"===t)return t;const s=p(t),n=s[3];return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${i*n})`}(t,s+(n-s)*i)}function Zt(t,i){const s=t%2600/2600;let n;for(const t of Yt)if(s>=t.cr&&s<=t.dr){n=t;break}e(void 0!==n,"Last price animation internal logic error");const r=(s-n.cr)/(n.dr-n.cr);return{_r:Xt(i,r,n.mr,n.br),ur:Xt(i,r,n.wr,n.gr),ht:(h=r,l=n.pr,a=n.vr,l+(a-l)*h)};var h,l,a}class Kt{constructor(t){this.jt=new qt,this.ft=!0,this.Mr=!0,this.Sr=performance.now(),this.yr=this.Sr-1,this.kr=t}Cr(){this.yr=this.Sr-1,this.bt()}Tr(){if(this.bt(),2===this.kr.F().lastPriceAnimation){const t=performance.now(),i=this.yr-t;if(i>0)return void(i<650&&(this.yr+=2600));this.Sr=t,this.yr=t+2600}}bt(){this.ft=!0}Dr(){this.Mr=!0}Ct(){return 0!==this.kr.F().lastPriceAnimation}Pr(){switch(this.kr.F().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.yr}}gt(t,i){return this.ft?(this.Mt(t,i),this.ft=!1,this.Mr=!1):this.Mr&&(this.Rr(),this.Mr=!1),this.jt}Mt(t,i){this.jt.tt(null);const s=this.kr.Ut().yt(),n=s.Vn(),e=this.kr.xt();if(null===n||null===e)return;const r=this.kr.Lr(!0);if(r.Or||!n.Ar(r.Yn))return;const h={x:s.At(r.Yn),y:this.kr.Pt().Dt(r._t,e.Rt)},l=r.R,a=this.kr.F().lineWidth,o=Zt(this.Er(),l);this.jt.tt({lr:l,ar:a,_r:o._r,ur:o.ur,ht:o.ht,Ae:h})}Rr(){const t=this.jt.hr();if(null!==t){const i=Zt(this.Er(),t.lr);t._r=i._r,t.ur=i.ur,t.ht=i.ht}}Er(){return this.Pr()?performance.now()-this.Sr:2599}}function Gt(t,i){return Rt(Math.min(Math.max(t,12),30)*i)}function Jt(t,i){switch(t){case"arrowDown":case"arrowUp":return Gt(i,1);case"circle":return Gt(i,.8);case"square":return Gt(i,.7)}}function Qt(t){return function(t){const i=Math.ceil(t);return i%2!=0?i-1:i}(Gt(t,1))}function ti(t){return Math.max(Gt(t,.1),3)}function ii(t,i,s,n,e){const r=Jt("square",s),h=(r-1)/2,l=t-h,a=i-h;return n>=l&&n<=l+r&&e>=a&&e<=a+r}function si(t,i,s,n,e){const r=(Jt("arrowUp",e)-1)/2,h=(Rt(e/2)-1)/2;i.beginPath(),t?(i.moveTo(s-r,n),i.lineTo(s,n-r),i.lineTo(s+r,n),i.lineTo(s+h,n),i.lineTo(s+h,n+r),i.lineTo(s-h,n+r),i.lineTo(s-h,n)):(i.moveTo(s-r,n),i.lineTo(s,n+r),i.lineTo(s+r,n),i.lineTo(s+h,n),i.lineTo(s+h,n-r),i.lineTo(s-h,n-r),i.lineTo(s-h,n)),i.fill()}function ni(t,i,s,n,e,r){return ii(i,s,n,e,r)}class ei extends R{constructor(){super(...arguments),this.Et=null,this.Ye=new Wt,this.W=-1,this.j="",this.Nr=""}tt(t){this.Et=t}Xe(t,i){this.W===t&&this.j===i||(this.W=t,this.j=i,this.Nr=T(t,i),this.Ye.We())}Br(t,i){if(null===this.Et||null===this.Et.it)return null;for(let s=this.Et.it.from;s<this.Et.it.to;s++){const n=this.Et.st[s];if(hi(n,t,i))return{Ir:n.Vr,Fr:n.Fr}}return null}Z(t,i,s){if(null!==this.Et&&null!==this.Et.it){t.textBaseline="middle",t.font=this.Nr;for(let i=this.Et.it.from;i<this.Et.it.to;i++){const s=this.Et.st[i];void 0!==s.ti&&(s.ti.Xt=this.Ye.Mi(t,s.ti.Wr),s.ti.Zt=this.W),ri(s,t)}}}}function ri(t,i){i.fillStyle=t.R,void 0!==t.ti&&function(t,i,s,n){t.fillText(i,s,n)}(i,t.ti.Wr,t.nt-t.ti.Xt/2,t.ti.et),function(t,i){if(0===t.Fn)return;switch(t.zr){case"arrowDown":return void si(!1,i,t.nt,t.et,t.Fn);case"arrowUp":return void si(!0,i,t.nt,t.et,t.Fn);case"circle":return void function(t,i,s,n){const e=(Jt("circle",n)-1)/2;t.beginPath(),t.arc(i,s,e,0,2*Math.PI,!1),t.fill()}(i,t.nt,t.et,t.Fn);case"square":return void function(t,i,s,n){const e=Jt("square",n),r=(e-1)/2,h=i-r,l=s-r;t.fillRect(h,l,e,e)}(i,t.nt,t.et,t.Fn)}t.zr}(t,i)}function hi(t,i,s){return!(void 0===t.ti||!function(t,i,s,n,e,r){const h=n/2;return e>=t&&e<=t+s&&r>=i-h&&r<=i+h}(t.nt,t.ti.et,t.ti.Xt,t.ti.Zt,i,s))||function(t,i,s){if(0===t.Fn)return!1;switch(t.zr){case"arrowDown":case"arrowUp":return ni(0,t.nt,t.et,t.Fn,i,s);case"circle":return function(t,i,s,n,e){const r=2+Jt("circle",s)/2,h=t-n,l=i-e;return Math.sqrt(h*h+l*l)<=r}(t.nt,t.et,t.Fn,i,s);case"square":return ii(t.nt,t.et,t.Fn,i,s)}}(t,i,s)}function li(t,i,s,n,e,r,h,l,a){const o=w(s)?s:s.ce,_=w(s)?s:s._e,u=w(s)?s:s.ue,c=w(i.size)?Math.max(i.size,0):1,d=Qt(l.Kn())*c,f=d/2;switch(t.Fn=d,i.position){case"inBar":return t.et=h.Dt(o,a),void(void 0!==t.ti&&(t.ti.et=t.et+f+r+.6*e));case"aboveBar":return t.et=h.Dt(_,a)-f-n.jr,void 0!==t.ti&&(t.ti.et=t.et-f-.6*e,n.jr+=1.2*e),void(n.jr+=d+r);case"belowBar":return t.et=h.Dt(u,a)+f+n.$r,void 0!==t.ti&&(t.ti.et=t.et+f+r+.6*e,n.$r+=1.2*e),void(n.$r+=d+r)}i.position}class ai{constructor(t,i){this.ft=!0,this.Hr=!0,this.Ur=!0,this.qr=null,this.jt=new ei,this.kr=t,this.$i=i,this.Et={st:[],it:null}}bt(t){this.ft=!0,this.Ur=!0,"data"===t&&(this.Hr=!0)}gt(t,i,s){if(!this.kr.Ct())return null;this.ft&&this.Yr();const n=this.$i.F().layout;return this.jt.Xe(n.fontSize,n.fontFamily),this.jt.tt(this.Et),this.jt}Xr(){if(this.Ur){if(this.kr.Zr().length>0){const t=this.$i.yt().Kn(),i=ti(t),s=1.5*Qt(t)+2*i;this.qr={above:s,below:s}}else this.qr=null;this.Ur=!1}return this.qr}Yr(){const t=this.kr.Pt(),i=this.$i.yt(),s=this.kr.Zr();this.Hr&&(this.Et.st=s.map((t=>({ot:t.time,nt:0,et:0,Fn:0,zr:t.shape,R:t.color,Vr:t.internalId,Fr:t.id,ti:void 0}))),this.Hr=!1);const n=this.$i.F().layout;this.Et.it=null;const e=i.Vn();if(null===e)return;const r=this.kr.xt();if(null===r)return;if(0===this.Et.st.length)return;let h=NaN;const l=ti(i.Kn()),a={jr:l,$r:l};this.Et.it=gt(this.Et.st,e,!0);for(let e=this.Et.it.from;e<this.Et.it.to;e++){const o=s[e];o.time!==h&&(a.jr=l,a.$r=l,h=o.time);const _=this.Et.st[e];_.nt=i.At(o.time),void 0!==o.text&&o.text.length>0&&(_.ti={Wr:o.text,et:0,Xt:0,Zt:0});const u=this.kr.Kr(o.time);null!==u&&li(_,o,u,a,n.fontSize,l,t,i,r.Rt)}this.ft=!1}}class oi extends Ht{constructor(t){super(t)}er(t,i){const s=this.sr;s.Ct=!1;const n=this.Tn.F();if(!n.priceLineVisible||!this.Tn.Ct())return;const e=this.Tn.Lr(0===n.priceLineSource);e.Or||(s.Ct=!0,s.et=e.yi,s.R=this.Tn.Gr(e.R),s.Xt=i,s.Zt=t,s.Ft=n.priceLineWidth,s.Wt=n.priceLineStyle)}}class _i extends U{constructor(t){super(),this.$t=t}Bi(t,i,s){t.Ct=!1,i.Ct=!1;const n=this.$t;if(!n.Ct())return;const e=n.F(),r=e.lastValueVisible,h=""!==n.Jr(),l=0===e.seriesLastValueMode,a=n.Lr(!1);if(a.Or)return;r&&(t.ti=this.Qr(a,r,l),t.Ct=0!==t.ti.length),(h||l)&&(i.ti=this.th(a,r,h,l),i.Ct=i.ti.length>0);const o=n.Gr(a.R),_=v(o);s.t=_.t,s.R=_.i,s.yi=a.yi,i.Lt=n.Ut().Ot(a.yi/n.Pt().Zt()),t.Lt=o,t.R=s.R,i.R=s.R}th(t,i,s,n){let e="";const r=this.$t.Jr();return s&&0!==r.length&&(e+=`${r} `),i&&n&&(e+=this.$t.Pt().ih()?t.sh:t.nh),e.trim()}Qr(t,i,s){return i?s?this.$t.Pt().ih()?t.nh:t.sh:t.ti:""}}class ui{constructor(t,i){this.eh=t,this.rh=i}hh(t){return null!==t&&(this.eh===t.eh&&this.rh===t.rh)}lh(){return new ui(this.eh,this.rh)}ah(){return this.eh}oh(){return this.rh}_h(){return this.rh-this.eh}Fi(){return this.rh===this.eh||Number.isNaN(this.rh)||Number.isNaN(this.eh)}tn(t){return null===t?this:new ui(Math.min(this.ah(),t.ah()),Math.max(this.oh(),t.oh()))}uh(t){if(!w(t))return;if(0===this.rh-this.eh)return;const i=.5*(this.rh+this.eh);let s=this.rh-i,n=this.eh-i;s*=t,n*=t,this.rh=i+s,this.eh=i+n}dh(t){w(t)&&(this.rh+=t,this.eh+=t)}fh(){return{minValue:this.eh,maxValue:this.rh}}static ph(t){return null===t?null:new ui(t.minValue,t.maxValue)}}class ci{constructor(t,i){this.mh=t,this.bh=i||null}wh(){return this.mh}gh(){return this.bh}fh(){return null===this.mh?null:{priceRange:this.mh.fh(),margins:this.bh||void 0}}static ph(t){return null===t?null:new ci(ui.ph(t.priceRange),t.margins)}}class di extends Ht{constructor(t,i){super(t),this.Mh=i}er(t,i){const s=this.sr;s.Ct=!1;const n=this.Mh.F();if(!this.Tn.Ct()||!n.lineVisible)return;const e=this.Mh.Sh();null!==e&&(s.Ct=!0,s.et=e,s.R=n.color,s.Xt=i,s.Zt=t,s.Ft=n.lineWidth,s.Wt=n.lineStyle)}}class fi extends U{constructor(t,i){super(),this.kr=t,this.Mh=i}Bi(t,i,s){t.Ct=!1,i.Ct=!1;const n=this.Mh.F(),e=n.axisLabelVisible,r=""!==n.title,h=this.kr;if(!e||!h.Ct())return;const l=this.Mh.Sh();if(null===l)return;r&&(i.ti=n.title,i.Ct=!0),i.Lt=h.Ut().Ot(l/h.Pt().Zt()),t.ti=this.yh(n.price),t.Ct=!0;const a=v(n.color);s.t=a.t,s.R=a.i,s.yi=l}yh(t){const i=this.kr.xt();return null===i?"":this.kr.Pt().Wi(t,i.Rt)}}class pi{constructor(t,i){this.kr=t,this.us=i,this.kh=new di(t,this),this.Ze=new fi(t,this),this.Ch=new jt(this.Ze,t,t.Ut())}xh(t){b(this.us,t),this.bt(),this.kr.Ut().Th()}F(){return this.us}Dh(){return this.kh}Ph(){return this.Ch}Rh(){return this.Ze}bt(){this.kh.bt(),this.Ze.bt()}Sh(){const t=this.kr,i=t.Pt();if(t.Ut().yt().Fi()||i.Fi())return null;const s=t.xt();return null===s?null:i.Dt(this.us.price,s.Rt)}}class vi extends K{constructor(t){super(),this.$i=t}Ut(){return this.$i}}const mi={Bar:(t,i,s,n)=>{var e;const r=i.upColor,a=i.downColor,o=h(t(s,n)),_=l(o.Rt[0])<=l(o.Rt[3]);return{ie:null!==(e=o.R)&&void 0!==e?e:_?r:a}},Candlestick:(t,i,s,n)=>{var e,r,a;const o=i.upColor,_=i.downColor,u=i.borderUpColor,c=i.borderDownColor,d=i.wickUpColor,f=i.wickDownColor,p=h(t(s,n)),v=l(p.Rt[0])<=l(p.Rt[3]);return{ie:null!==(e=p.R)&&void 0!==e?e:v?o:_,De:null!==(r=p.Lt)&&void 0!==r?r:v?u:c,Te:null!==(a=p.Lh)&&void 0!==a?a:v?d:f}},Area:(t,i,s,n)=>{var e,r,l,a;const o=h(t(s,n));return{ie:null!==(e=o.lt)&&void 0!==e?e:i.lineColor,lt:null!==(r=o.lt)&&void 0!==r?r:i.lineColor,vn:null!==(l=o.vn)&&void 0!==l?l:i.topColor,mn:null!==(a=o.mn)&&void 0!==a?a:i.bottomColor}},Baseline:(t,i,s,n)=>{var e,r,l,a,o,_;const u=h(t(s,n));return{ie:u.Rt[3]>=i.baseValue.price?i.topLineColor:i.bottomLineColor,be:null!==(e=u.be)&&void 0!==e?e:i.topLineColor,we:null!==(r=u.we)&&void 0!==r?r:i.bottomLineColor,de:null!==(l=u.de)&&void 0!==l?l:i.topFillColor1,fe:null!==(a=u.fe)&&void 0!==a?a:i.topFillColor2,pe:null!==(o=u.pe)&&void 0!==o?o:i.bottomFillColor1,ve:null!==(_=u.ve)&&void 0!==_?_:i.bottomFillColor2}},Line:(t,i,s,n)=>{var e,r;const l=h(t(s,n));return{ie:null!==(e=l.R)&&void 0!==e?e:i.color,lt:null!==(r=l.R)&&void 0!==r?r:i.color}},Histogram:(t,i,s,n)=>{var e;return{ie:null!==(e=h(t(s,n)).R)&&void 0!==e?e:i.color}}};class bi{constructor(t){this.Oh=(t,i)=>void 0!==i?i.Rt:this.kr.Ns().Ah(t),this.kr=t,this.Eh=mi[t.Nh()]}An(t,i){return this.Eh(this.Oh,this.kr.F(),t,i)}}var wi;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(wi||(wi={}));const gi=30;class Mi{constructor(){this.Bh=[],this.Ih=new Map,this.Vh=new Map}Fh(){return this.Fn()>0?this.Bh[this.Bh.length-1]:null}Wh(){return this.Fn()>0?this.zh(0):null}Es(){return this.Fn()>0?this.zh(this.Bh.length-1):null}Fn(){return this.Bh.length}Fi(){return 0===this.Fn()}Ar(t){return null!==this.jh(t,0)}Ah(t){return this.$h(t)}$h(t,i=0){const s=this.jh(t,i);return null===s?null:Object.assign(Object.assign({},this.Hh(s)),{Yn:this.zh(s)})}Un(){return this.Bh}Uh(t,i,s){if(this.Fi())return null;let n=null;for(const e of s){n=Si(n,this.qh(t,i,e))}return n}tt(t){this.Vh.clear(),this.Ih.clear(),this.Bh=t}zh(t){return this.Bh[t].Yn}Hh(t){return this.Bh[t]}jh(t,i){const s=this.Yh(t);if(null===s&&0!==i)switch(i){case-1:return this.Xh(t);case 1:return this.Zh(t);default:throw new TypeError("Unknown search mode")}return s}Xh(t){let i=this.Kh(t);return i>0&&(i-=1),i!==this.Bh.length&&this.zh(i)<t?i:null}Zh(t){const i=this.Gh(t);return i!==this.Bh.length&&t<this.zh(i)?i:null}Yh(t){const i=this.Kh(t);return i===this.Bh.length||t<this.Bh[i].Yn?null:i}Kh(t){return vt(this.Bh,t,((t,i)=>t.Yn<i))}Gh(t){return mt(this.Bh,t,((t,i)=>i.Yn>t))}Jh(t,i,s){let n=null;for(let e=t;e<i;e++){const t=this.Bh[e].Rt[s];Number.isNaN(t)||(null===n?n={Qh:t,tl:t}:(t<n.Qh&&(n.Qh=t),t>n.tl&&(n.tl=t)))}return n}qh(t,i,s){if(this.Fi())return null;let n=null;const e=h(this.Wh()),r=h(this.Es()),l=Math.max(t,e),a=Math.min(i,r),o=Math.ceil(l/gi)*gi,_=Math.max(o,Math.floor(a/gi)*gi);{const t=this.Kh(l),e=this.Gh(Math.min(a,o,i));n=Si(n,this.Jh(t,e,s))}let u=this.Ih.get(s);void 0===u&&(u=new Map,this.Ih.set(s,u));for(let t=Math.max(o+1,l);t<_;t+=gi){const i=Math.floor(t/gi);let e=u.get(i);if(void 0===e){const t=this.Kh(i*gi),n=this.Gh((i+1)*gi-1);e=this.Jh(t,n,s),u.set(i,e)}n=Si(n,e)}{const t=this.Kh(_),i=this.Gh(a);n=Si(n,this.Jh(t,i,s))}return n}}function Si(t,i){if(null===t)return i;if(null===i)return t;return{Qh:Math.min(t.Qh,i.Qh),tl:Math.max(t.tl,i.tl)}}class yi extends vi{constructor(t,i,s){super(t),this.Et=new Mi,this.kh=new oi(this),this.il=[],this.sl=new Ut(this),this.nl=null,this.el=null,this.rl=[],this.hl=[],this.ll=null,this.us=i,this.al=s;const n=new _i(this);this.es=[n],this.Ch=new jt(n,this,t),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(this.nl=new Kt(this)),this.ol(),this._l()}M(){null!==this.ll&&clearTimeout(this.ll)}Gr(t){return this.us.priceLineColor||t}Lr(t){const i={Or:!0},s=this.Pt();if(this.Ut().yt().Fi()||s.Fi()||this.Et.Fi())return i;const n=this.Ut().yt().Vn(),e=this.xt();if(null===n||null===e)return i;let r,h;if(t){const t=this.Et.Fh();if(null===t)return i;r=t,h=t.Yn}else{const t=this.Et.$h(n.Mn(),-1);if(null===t)return i;if(r=this.Et.Ah(t.Yn),null===r)return i;h=t.Yn}const l=r.Rt[3],a=this.En().An(h,{Rt:r}),o=s.Dt(l,e.Rt);return{Or:!1,_t:l,ti:s.Wi(l,e.Rt),sh:s.ul(l),nh:s.cl(l,e.Rt),R:a.ie,yi:o,Yn:h}}En(){return null!==this.el||(this.el=new bi(this)),this.el}F(){return this.us}xh(t){const i=t.priceScaleId;void 0!==i&&i!==this.us.priceScaleId&&this.Ut().dl(this,i),b(this.us,t),void 0!==t.priceFormat&&(this.ol(),this.Ut().fl()),this.Ut().pl(this),this.Ut().vl(),this.ws.bt("options")}tt(t,i){this.Et.tt(t),this.ml(),this.ws.bt("data"),this.cs.bt("data"),null!==this.nl&&(i&&i.bl?this.nl.Tr():0===t.length&&this.nl.Cr());const s=this.Ut().Ge(this);this.Ut().wl(s),this.Ut().pl(this),this.Ut().vl(),this.Ut().Th()}gl(t){this.rl=t,this.ml();const i=this.Ut().Ge(this);this.cs.bt("data"),this.Ut().wl(i),this.Ut().pl(this),this.Ut().vl(),this.Ut().Th()}Ml(){return this.rl}Zr(){return this.hl}Sl(t){const i=new pi(this,t);return this.il.push(i),this.Ut().pl(this),i}yl(t){const i=this.il.indexOf(t);-1!==i&&this.il.splice(i,1),this.Ut().pl(this)}Nh(){return this.al}xt(){const t=this.kl();return null===t?null:{Rt:t.Rt[3],Cl:t.ot}}kl(){const t=this.Ut().yt().Vn();if(null===t)return null;const i=t.gn();return this.Et.$h(i,1)}Ns(){return this.Et}Kr(t){const i=this.Et.Ah(t);return null===i?null:"Bar"===this.al||"Candlestick"===this.al?{oe:i.Rt[0],_e:i.Rt[1],ue:i.Rt[2],ce:i.Rt[3]}:i.Rt[3]}xl(t){const i=this.nl;return null!==i&&i.Ct()?(null===this.ll&&i.Pr()&&(this.ll=setTimeout((()=>{this.ll=null,this.Ut().Tl()}),0)),i.Dr(),[i]):[]}Ds(){const t=[];this.Dl()||t.push(this.sl),t.push(this.ws,this.kh,this.cs);const i=this.il.map((t=>t.Dh()));return t.push(...i),t}Gi(t){return[this.Ch,...this.il.map((t=>t.Ph()))]}Ps(t,i){if(i!==this.qi&&!this.Dl())return[];const s=[...this.es];for(const t of this.il)s.push(t.Rh());return s}Pl(t,i){if(void 0!==this.us.autoscaleInfoProvider){const s=this.us.autoscaleInfoProvider((()=>{const s=this.Rl(t,i);return null===s?null:s.fh()}));return ci.ph(s)}return this.Rl(t,i)}Ll(){return this.us.priceFormat.minMove}Ol(){return this.Al}Ls(){var t;this.ws.bt(),this.cs.bt();for(const t of this.es)t.bt();for(const t of this.il)t.bt();this.kh.bt(),this.sl.bt(),null===(t=this.nl)||void 0===t||t.bt()}Pt(){return h(super.Pt())}kt(t){if(!(("Line"===this.al||"Area"===this.al||"Baseline"===this.al)&&this.us.crosshairMarkerVisible))return null;const i=this.Et.Ah(t);if(null===i)return null;return{_t:i.Rt[3],ht:this.El(),Lt:this.Nl(),Tt:this.Bl(t)}}Jr(){return this.us.title}Ct(){return this.us.visible}Dl(){return!Q(this.Pt().Il())}Rl(t,i){if(!g(t)||!g(i)||this.Et.Fi())return null;const s="Line"===this.al||"Area"===this.al||"Baseline"===this.al||"Histogram"===this.al?[3]:[2,1],n=this.Et.Uh(t,i,s);let e=null!==n?new ui(n.Qh,n.tl):null;if("Histogram"===this.Nh()){const t=this.us.base,i=new ui(t,t);e=null!==e?e.tn(i):i}return new ci(e,this.cs.Xr())}El(){switch(this.al){case"Line":case"Area":case"Baseline":return this.us.crosshairMarkerRadius}return 0}Nl(){switch(this.al){case"Line":case"Area":case"Baseline":{const t=this.us.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}Bl(t){switch(this.al){case"Line":case"Area":case"Baseline":{const t=this.us.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.En().An(t).ie}ol(){switch(this.us.priceFormat.type){case"custom":this.Al={format:this.us.priceFormat.formatter};break;case"volume":this.Al=new rt(this.us.priceFormat.precision);break;case"percent":this.Al=new et(this.us.priceFormat.precision);break;default:{const t=Math.pow(10,this.us.priceFormat.precision);this.Al=new nt(t,this.us.priceFormat.minMove*t)}}null!==this.qi&&this.qi.Vl()}ml(){const t=this.Ut().yt();if(t.Fi()||0===this.Et.Fn())return void(this.hl=[]);const i=h(this.Et.Wh());this.hl=this.rl.map(((s,n)=>{const e=h(t.Fl(s.time,!0)),r=e<i?1:-1;return{time:h(this.Et.$h(e,r)).Yn,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:n,text:s.text,size:s.size}}))}_l(){switch(this.cs=new ai(this,this.Ut()),this.al){case"Bar":this.ws=new xt(this,this.Ut());break;case"Candlestick":this.ws=new Nt(this,this.Ut());break;case"Line":this.ws=new Vt(this,this.Ut());break;case"Area":this.ws=new yt(this,this.Ut());break;case"Baseline":this.ws=new At(this,this.Ut());break;case"Histogram":this.ws=new It(this,this.Ut());break;default:throw Error("Unknown chart style assigned: "+this.al)}}}class ki{constructor(t){this.us=t}Wl(t,i,s){let n=t;if(0===this.us.mode)return n;const e=s.fs(),r=e.xt();if(null===r)return n;const h=e.Dt(t,r),a=s.zl().filter((t=>t instanceof yi)).reduce(((t,n)=>{if(s.Je(n)||!n.Ct())return t;const e=n.Pt(),r=n.Ns();if(e.Fi()||!r.Ar(i))return t;const h=r.Ah(i);if(null===h)return t;const a=l(n.xt());return t.concat([e.Dt(h.Rt[3],a.Rt)])}),[]);if(0===a.length)return n;a.sort(((t,i)=>Math.abs(t-h)-Math.abs(i-h)));const o=a[0];return n=e.ps(o,r),n}}class Ci{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,n,e){if(null===this.Et)return;const r=Math.max(1,Math.floor(i));t.lineWidth=r;const l=Math.ceil(this.Et.Vt*i),a=Math.ceil(this.Et.It*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const n=h(this.Et);if(n.jl){t.strokeStyle=n.$l,s(t,n.Hl),t.beginPath();for(const s of n.Ul){const n=Math.round(s.ql*i);t.moveTo(n,-r),t.lineTo(n,l+r)}t.stroke()}if(n.Yl){t.strokeStyle=n.Xl,s(t,n.Zl),t.beginPath();for(const s of n.Kl){const n=Math.round(s.ql*i);t.moveTo(-r,n),t.lineTo(a+r,n)}t.stroke()}}))}}class xi{constructor(t){this.jt=new Ci,this.ft=!0,this.Qi=t}bt(){this.ft=!0}gt(t,i){if(this.ft){const s=this.Qi.Ut().F().grid,n={Vt:t,It:i,Yl:s.horzLines.visible,jl:s.vertLines.visible,Xl:s.horzLines.color,$l:s.vertLines.color,Zl:s.horzLines.style,Hl:s.vertLines.style,Kl:this.Qi.fs().Gl(),Ul:this.Qi.Ut().yt().Gl()||[]};this.jt.tt(n),this.ft=!1}return this.jt}}class Ti{constructor(t){this.ws=new xi(t)}Dh(){return this.ws}}const Di={Jl:4,Ql:1e-4};function Pi(t,i){const s=100*(t-i)/i;return i<0?-s:s}function Ri(t,i){const s=Pi(t.ah(),i),n=Pi(t.oh(),i);return new ui(s,n)}function Li(t,i){const s=100*(t-i)/i+100;return i<0?-s:s}function Oi(t,i){const s=Li(t.ah(),i),n=Li(t.oh(),i);return new ui(s,n)}function Ai(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=Pt(s+i.Ql)+i.Jl;return t<0?-n:n}function Ei(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=Math.pow(10,s-i.Jl)-i.Ql;return t<0?-n:n}function Ni(t,i){if(null===t)return null;const s=Ai(t.ah(),i),n=Ai(t.oh(),i);return new ui(s,n)}function Bi(t,i){if(null===t)return null;const s=Ei(t.ah(),i),n=Ei(t.oh(),i);return new ui(s,n)}function Ii(t){if(null===t)return Di;const i=Math.abs(t.oh()-t.ah());if(i>=1||i<1e-15)return Di;const s=Math.ceil(Math.abs(Math.log10(i))),n=Di.Jl+s;return{Jl:n,Ql:1/Math.pow(10,n)}}class Vi{constructor(t,i){if(this.ta=t,this.ia=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.ta))this.sa=[2,2.5,2];else{this.sa=[];for(let t=this.ta;1!==t;){if(t%2==0)this.sa.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.sa.push(2,2.5),t/=5}if(this.sa.length>100)throw new Error("something wrong with base")}}}na(t,i,s){const n=0===this.ta?0:1/this.ta;let e=Math.pow(10,Math.max(0,Math.ceil(Pt(t-i)))),r=0,h=this.ia[0];for(;;){const t=Dt(e,n,1e-14)&&e>n+1e-14,i=Dt(e,s*h,1e-14),l=Dt(e,1,1e-14);if(!(t&&i&&l))break;e/=h,h=this.ia[++r%this.ia.length]}if(e<=n+1e-14&&(e=n),e=Math.max(1,e),this.sa.length>0&&(l=e,a=1,o=1e-14,Math.abs(l-a)<o))for(r=0,h=this.sa[0];Dt(e,s*h,1e-14)&&e>n+1e-14;)e/=h,h=this.sa[++r%this.sa.length];var l,a,o;return e}}class Fi{constructor(t,i,s,n){this.ea=[],this.Ii=t,this.ta=i,this.ra=s,this.ha=n}na(t,i){if(t<i)throw new Error("high < low");const s=this.Ii.Zt(),n=(t-i)*this.la()/s,e=new Vi(this.ta,[2,2.5,2]),r=new Vi(this.ta,[2,2,2.5]),h=new Vi(this.ta,[2.5,2,2]),l=[];return l.push(e.na(t,i,n),r.na(t,i,n),h.na(t,i,n)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let s=1;s<t.length;++s)t[s]<i&&(i=t[s]);return i}(l)}aa(){const t=this.Ii,i=t.xt();if(null===i)return void(this.ea=[]);const s=t.Zt(),n=this.ra(s-1,i),e=this.ra(0,i),r=this.Ii.F().entireTextOnly?this.oa()/2:0,h=r,l=s-1-r,a=Math.max(n,e),o=Math.min(n,e);if(a===o)return void(this.ea=[]);let _=this.na(a,o),u=a%_;u+=u<0?_:0;const c=a>=o?1:-1;let d=null,f=0;for(let s=a-u;s>o;s-=_){const n=this.ha(s,i,!0);null!==d&&Math.abs(n-d)<this.la()||(n<h||n>l||(f<this.ea.length?(this.ea[f].ql=n,this.ea[f]._a=t.ua(s)):this.ea.push({ql:n,_a:t.ua(s)}),f++,d=n,t.ca()&&(_=this.na(s*c,o))))}this.ea.length=f}Gl(){return this.ea}oa(){return this.Ii.T()}la(){return Math.ceil(2.5*this.oa())}}function Wi(t){return t.slice().sort(((t,i)=>h(t.Xi())-h(i.Xi())))}var zi;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(zi||(zi={}));const ji=new et,$i=new nt(100,1);class Hi{constructor(t,i,s,n){this.da=0,this.fa=null,this.mh=null,this.pa=null,this.va={ma:!1,ba:null},this.wa=0,this.ga=0,this.Ma=new m,this.Sa=new m,this.ya=[],this.ka=null,this.Ca=null,this.xa=null,this.Ta=null,this.Al=$i,this.Da=Ii(null),this.Pa=t,this.us=i,this.Ra=s,this.La=n,this.Oa=new Fi(this,100,this.Aa.bind(this),this.Ea.bind(this))}Il(){return this.Pa}F(){return this.us}xh(t){if(b(this.us,t),this.Vl(),void 0!==t.mode&&this.Na({rr:t.mode}),void 0!==t.scaleMargins){const i=r(t.scaleMargins.top),s=r(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(s<0||s>1||i+s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(i+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+s}`);this.Ba(),this.Ca=null}}Ia(){return this.us.autoScale}ca(){return 1===this.us.mode}ih(){return 2===this.us.mode}Va(){return 3===this.us.mode}rr(){return{zs:this.us.autoScale,Fa:this.us.invertScale,rr:this.us.mode}}Na(t){const i=this.rr();let s=null;void 0!==t.zs&&(this.us.autoScale=t.zs),void 0!==t.rr&&(this.us.mode=t.rr,2!==t.rr&&3!==t.rr||(this.us.autoScale=!0),this.va.ma=!1),1===i.rr&&t.rr!==i.rr&&(!function(t,i){if(null===t)return!1;const s=Ei(t.ah(),i),n=Ei(t.oh(),i);return isFinite(s)&&isFinite(n)}(this.mh,this.Da)?this.us.autoScale=!0:(s=Bi(this.mh,this.Da),null!==s&&this.Wa(s))),1===t.rr&&t.rr!==i.rr&&(s=Ni(this.mh,this.Da),null!==s&&this.Wa(s));const n=i.rr!==this.us.mode;n&&(2===i.rr||this.ih())&&this.Vl(),n&&(3===i.rr||this.Va())&&this.Vl(),void 0!==t.Fa&&i.Fa!==t.Fa&&(this.us.invertScale=t.Fa,this.za()),this.Sa.m(i,this.rr())}ja(){return this.Sa}T(){return this.Ra.fontSize}Zt(){return this.da}$a(t){this.da!==t&&(this.da=t,this.Ba(),this.Ca=null)}Ha(){if(this.fa)return this.fa;const t=this.Zt()-this.Ua()-this.qa();return this.fa=t,t}wh(){return this.Ya(),this.mh}Wa(t,i){const s=this.mh;(i||null===s&&null!==t||null!==s&&!s.hh(t))&&(this.Ca=null,this.mh=t)}Fi(){return this.Ya(),0===this.da||!this.mh||this.mh.Fi()}Xa(t){return this.Fa()?t:this.Zt()-1-t}Dt(t,i){return this.ih()?t=Pi(t,i):this.Va()&&(t=Li(t,i)),this.Ea(t,i)}$n(t,i,s){this.Ya();const n=this.qa(),e=h(this.wh()),r=e.ah(),l=e.oh(),a=this.Ha()-1,o=this.Fa(),_=a/(l-r),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.Za();for(let s=u;s<c;s++){const e=t[s],h=e._t;if(isNaN(h))continue;let l=h;null!==d&&(l=d(e._t,i));const a=n+_*(l-r),u=o?a:this.da-1-a;e.et=u}}le(t,i,s){this.Ya();const n=this.qa(),e=h(this.wh()),r=e.ah(),l=e.oh(),a=this.Ha()-1,o=this.Fa(),_=a/(l-r),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.Za();for(let s=u;s<c;s++){const e=t[s];let h=e.oe,l=e._e,a=e.ue,u=e.ce;null!==d&&(h=d(e.oe,i),l=d(e._e,i),a=d(e.ue,i),u=d(e.ce,i));let c=n+_*(h-r),f=o?c:this.da-1-c;e.re=f,c=n+_*(l-r),f=o?c:this.da-1-c,e.se=f,c=n+_*(a-r),f=o?c:this.da-1-c,e.ne=f,c=n+_*(u-r),f=o?c:this.da-1-c,e.he=f}}ps(t,i){const s=this.Aa(t,i);return this.Ka(s,i)}Ka(t,i){let s=t;return this.ih()?s=function(t,i){return i<0&&(t=-t),t/100*i+i}(s,i):this.Va()&&(s=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(s,i)),s}zl(){return this.ya}Ga(){if(this.ka)return this.ka;let t=[];for(let i=0;i<this.ya.length;i++){const s=this.ya[i];null===s.Xi()&&s.Zi(i+1),t.push(s)}return t=Wi(t),this.ka=t,this.ka}Ja(t){-1===this.ya.indexOf(t)&&(this.ya.push(t),this.Vl(),this.Qa())}io(t){const i=this.ya.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.ya.splice(i,1),0===this.ya.length&&(this.Na({zs:!0}),this.Wa(null)),this.Vl(),this.Qa()}xt(){let t=null;for(const i of this.ya){const s=i.xt();null!==s&&((null===t||s.Cl<t.Cl)&&(t=s))}return null===t?null:t.Rt}Fa(){return this.us.invertScale}Gl(){const t=null===this.xt();if(null!==this.Ca&&(t||this.Ca.so===t))return this.Ca.Gl;this.Oa.aa();const i=this.Oa.Gl();return this.Ca={Gl:i,so:t},this.Ma.m(),i}no(){return this.Ma}eo(t){this.ih()||this.Va()||null===this.xa&&null===this.pa&&(this.Fi()||(this.xa=this.da-t,this.pa=h(this.wh()).lh()))}ro(t){if(this.ih()||this.Va())return;if(null===this.xa)return;this.Na({zs:!1}),(t=this.da-t)<0&&(t=0);let i=(this.xa+.2*(this.da-1))/(t+.2*(this.da-1));const s=h(this.pa).lh();i=Math.max(i,.1),s.uh(i),this.Wa(s)}ho(){this.ih()||this.Va()||(this.xa=null,this.pa=null)}lo(t){this.Ia()||null===this.Ta&&null===this.pa&&(this.Fi()||(this.Ta=t,this.pa=h(this.wh()).lh()))}ao(t){if(this.Ia())return;if(null===this.Ta)return;const i=h(this.wh())._h()/(this.Ha()-1);let s=t-this.Ta;this.Fa()&&(s*=-1);const n=s*i,e=h(this.pa).lh();e.dh(n),this.Wa(e,!0),this.Ca=null}oo(){this.Ia()||null!==this.Ta&&(this.Ta=null,this.pa=null)}Ol(){return this.Al||this.Vl(),this.Al}Wi(t,i){switch(this.us.mode){case 2:return this.Ol().format(Pi(t,i));case 3:return this.Ol().format(Li(t,i));default:return this.yh(t)}}ua(t){switch(this.us.mode){case 2:case 3:return this.Ol().format(t);default:return this.yh(t)}}ul(t){return this.yh(t,h(this._o()).Ol())}cl(t,i){return t=Pi(t,i),ji.format(t)}uo(){return this.ya}co(t){this.va={ba:t,ma:!1}}Ls(){this.ya.forEach((t=>t.Ls()))}Vl(){this.Ca=null;const t=this._o();let i=100;null!==t&&(i=Math.round(1/t.Ll())),this.Al=$i,this.ih()?(this.Al=ji,i=100):this.Va()?(this.Al=new nt(100,1),i=100):null!==t&&(this.Al=t.Ol()),this.Oa=new Fi(this,i,this.Aa.bind(this),this.Ea.bind(this)),this.Oa.aa()}Qa(){this.ka=null}_o(){return this.ya[0]||null}Ua(){return this.Fa()?this.us.scaleMargins.bottom*this.Zt()+this.ga:this.us.scaleMargins.top*this.Zt()+this.wa}qa(){return this.Fa()?this.us.scaleMargins.top*this.Zt()+this.wa:this.us.scaleMargins.bottom*this.Zt()+this.ga}Ya(){this.va.ma||(this.va.ma=!0,this.do())}Ba(){this.fa=null}Ea(t,i){if(this.Ya(),this.Fi())return 0;t=this.ca()&&t?Ai(t,this.Da):t;const s=h(this.wh()),n=this.qa()+(this.Ha()-1)*(t-s.ah())/s._h();return this.Xa(n)}Aa(t,i){if(this.Ya(),this.Fi())return 0;const s=this.Xa(t),n=h(this.wh()),e=n.ah()+n._h()*((s-this.qa())/(this.Ha()-1));return this.ca()?Ei(e,this.Da):e}za(){this.Ca=null,this.Oa.aa()}do(){const t=this.va.ba;if(null===t)return;let i=null;const s=this.uo();let n=0,e=0;for(const r of s){if(!r.Ct())continue;const s=r.xt();if(null===s)continue;const l=r.Pl(t.gn(),t.Mn());let a=l&&l.wh();if(null!==a){switch(this.us.mode){case 1:a=Ni(a,this.Da);break;case 2:a=Ri(a,s.Rt);break;case 3:a=Oi(a,s.Rt)}if(i=null===i?a:i.tn(h(a)),null!==l){const t=l.gh();null!==t&&(n=Math.max(n,t.above),e=Math.max(n,t.below))}}}if(n===this.wa&&e===this.ga||(this.wa=n,this.ga=e,this.Ca=null,this.Ba()),null!==i){if(i.ah()===i.oh()){const t=this._o(),s=5*(null===t||this.ih()||this.Va()?1:t.Ll());this.ca()&&(i=Bi(i,this.Da)),i=new ui(i.ah()-s,i.oh()+s),this.ca()&&(i=Ni(i,this.Da))}if(this.ca()){const t=Bi(i,this.Da),s=Ii(t);if(r=s,l=this.Da,r.Jl!==l.Jl||r.Ql!==l.Ql){const n=null!==this.pa?Bi(this.pa,this.Da):null;this.Da=s,i=Ni(t,s),null!==n&&(this.pa=Ni(n,s))}}this.Wa(i)}else null===this.mh&&(this.Wa(new ui(-.5,.5)),this.Da=Ii(null));var r,l;this.va.ma=!0}Za(){return this.ih()?Pi:this.Va()?Li:this.ca()?t=>Ai(t,this.Da):null}yh(t,i){return void 0===this.La.priceFormatter?(void 0===i&&(i=this.Ol()),i.format(t)):this.La.priceFormatter(t)}}class Ui{constructor(t,i){this.ya=[],this.fo=new Map,this.da=0,this.qe=0,this.po=1e3,this.ka=null,this.vo=new m,this.mo=t,this.$i=i,this.bo=new Ti(this);const s=i.F();this.wo=this.Mo("left",s.leftPriceScale),this.So=this.Mo("right",s.rightPriceScale),this.wo.ja().l(this.yo.bind(this,this.wo),this),this.So.ja().l(this.yo.bind(this,this.So),this),this.ko(s)}ko(t){if(t.leftPriceScale&&this.wo.xh(t.leftPriceScale),t.rightPriceScale&&this.So.xh(t.rightPriceScale),t.localization&&(this.wo.Vl(),this.So.Vl()),t.overlayPriceScales){const i=Array.from(this.fo.values());for(const s of i){const i=h(s[0].Pt());i.xh(t.overlayPriceScales),t.localization&&i.Vl()}}}Co(t){switch(t){case"left":return this.wo;case"right":return this.So}return this.fo.has(t)?r(this.fo.get(t))[0].Pt():null}M(){this.Ut().xo().v(this),this.wo.ja().v(this),this.So.ja().v(this),this.ya.forEach((t=>{t.M&&t.M()})),this.vo.m()}To(){return this.po}Do(t){this.po=t}Ut(){return this.$i}Xt(){return this.qe}Zt(){return this.da}Po(t){this.qe=t,this.Ro()}$a(t){this.da=t,this.wo.$a(t),this.So.$a(t),this.ya.forEach((i=>{if(this.Je(i)){const s=i.Pt();null!==s&&s.$a(t)}})),this.Ro()}zl(){return this.ya}Je(t){const i=t.Pt();return null===i||this.wo!==i&&this.So!==i}Ja(t,i,s){const n=void 0!==s?s:this.Oo().Lo+1;this.Ao(t,i,n)}io(t){const i=this.ya.indexOf(t);e(-1!==i,"removeDataSource: invalid data source"),this.ya.splice(i,1);const s=h(t.Pt()).Il();if(this.fo.has(s)){const i=r(this.fo.get(s)),n=i.indexOf(t);-1!==n&&(i.splice(n,1),0===i.length&&this.fo.delete(s))}const n=t.Pt();n&&n.zl().indexOf(t)>=0&&n.io(t),null!==n&&(n.Qa(),this.Eo(n)),this.ka=null}tr(t){return t===this.wo?"left":t===this.So?"right":"overlay"}No(){return this.wo}Bo(){return this.So}Io(t,i){t.eo(i)}Vo(t,i){t.ro(i),this.Ro()}Fo(t){t.ho()}Wo(t,i){t.lo(i)}zo(t,i){t.ao(i),this.Ro()}jo(t){t.oo()}Ro(){this.ya.forEach((t=>{t.Ls()}))}fs(){let t=null;return this.$i.F().rightPriceScale.visible&&0!==this.So.zl().length?t=this.So:this.$i.F().leftPriceScale.visible&&0!==this.wo.zl().length?t=this.wo:0!==this.ya.length&&(t=this.ya[0].Pt()),null===t&&(t=this.So),t}Qe(){let t=null;return this.$i.F().rightPriceScale.visible?t=this.So:this.$i.F().leftPriceScale.visible&&(t=this.wo),t}Eo(t){null!==t&&t.Ia()&&this.$o(t)}Ho(t){const i=this.mo.Vn();t.Na({zs:!0}),null!==i&&t.co(i),this.Ro()}Uo(){this.$o(this.wo),this.$o(this.So)}qo(){this.Eo(this.wo),this.Eo(this.So),this.ya.forEach((t=>{this.Je(t)&&this.Eo(t.Pt())})),this.Ro(),this.$i.Th()}Ga(){return null===this.ka&&(this.ka=Wi(this.ya)),this.ka}Yo(){return this.vo}Xo(){return this.bo}$o(t){const i=t.uo();if(i&&i.length>0&&!this.mo.Fi()){const i=this.mo.Vn();null!==i&&t.co(i)}t.Ls()}Oo(){const t=this.Ga();if(0===t.length)return{Zo:0,Lo:0};let i=0,s=0;for(let n=0;n<t.length;n++){const e=t[n].Xi();null!==e&&(e<i&&(i=e),e>s&&(s=e))}return{Zo:i,Lo:s}}Ao(t,i,s){let n=this.Co(i);if(null===n&&(n=this.Mo(i,this.$i.F().overlayPriceScales)),this.ya.push(t),!Q(i)){const s=this.fo.get(i)||[];s.push(t),this.fo.set(i,s)}n.Ja(t),t.Ki(n),t.Zi(s),this.Eo(n),this.ka=null}yo(t,i,s){i.rr!==s.rr&&this.$o(t)}Mo(t,i){const s=Object.assign({visible:!0,autoScale:!0},y(i)),n=new Hi(t,s,this.$i.F().layout,this.$i.F().localization);return n.$a(this.Zt()),n}}const qi=t=>t.getUTCFullYear();function Yi(t,i,s){return i.replace(/yyyy/g,(t=>st(qi(t),4))(t)).replace(/yy/g,(t=>st(qi(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,s)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,s)).replace(/MM/g,(t=>st((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>st((t=>t.getUTCDate())(t),2))(t))}class Xi{constructor(t="yyyy-MM-dd",i="default"){this.Ko=t,this.Go=i}Jo(t){return Yi(t,this.Ko,this.Go)}}class Zi{constructor(t){this.Qo=t||"%h:%m:%s"}Jo(t){return this.Qo.replace("%h",st(t.getUTCHours(),2)).replace("%m",st(t.getUTCMinutes(),2)).replace("%s",st(t.getUTCSeconds(),2))}}const Ki={t_:"yyyy-MM-dd",i_:"%h:%m:%s",s_:" ",n_:"default"};class Gi{constructor(t={}){const i=Object.assign(Object.assign({},Ki),t);this.e_=new Xi(i.t_,i.n_),this.r_=new Zi(i.i_),this.h_=i.s_}Jo(t){return`${this.e_.Jo(t)}${this.h_}${this.r_.Jo(t)}`}}class Ji{constructor(t,i=50){this.Ee=0,this.Ne=1,this.Be=1,this.Ve=new Map,this.Ie=new Map,this.l_=t,this.Fe=i}Jo(t){const i=t.ot,s=void 0===i.a_?new Date(1e3*i.o_).getTime():new Date(Date.UTC(i.a_.year,i.a_.month-1,i.a_.day)).getTime(),n=this.Ve.get(s);if(void 0!==n)return n.__;if(this.Ee===this.Fe){const t=this.Ie.get(this.Be);this.Ie.delete(this.Be),this.Ve.delete(r(t)),this.Be++,this.Ee--}const e=this.l_(t);return this.Ve.set(s,{__:e,$e:this.Ne}),this.Ie.set(this.Ne,s),this.Ee++,this.Ne++,e}}class Qi{constructor(t,i){e(t<=i,"right should be >= left"),this.u_=t,this.c_=i}gn(){return this.u_}Mn(){return this.c_}d_(){return this.c_-this.u_+1}Ar(t){return this.u_<=t&&t<=this.c_}hh(t){return this.u_===t.gn()&&this.c_===t.Mn()}}function ts(t,i){return null===t||null===i?t===i:t.hh(i)}class is{constructor(){this.f_=new Map,this.Ve=null}p_(t,i){this.v_(i),this.Ve=null;for(let s=i;s<t.length;++s){const i=t[s];let n=this.f_.get(i.m_);void 0===n&&(n=[],this.f_.set(i.m_,n)),n.push({Yn:s,ot:i.ot,b_:i.m_,w_:i.w_})}}g_(t,i){const s=Math.ceil(i/t);return null!==this.Ve&&this.Ve.M_===s||(this.Ve={Gl:this.S_(s),M_:s}),this.Ve.Gl}v_(t){if(0===t)return void this.f_.clear();const i=[];this.f_.forEach(((s,n)=>{t<=s[0].Yn?i.push(n):s.splice(vt(s,t,(i=>i.Yn<t)),1/0)}));for(const t of i)this.f_.delete(t)}S_(t){let i=[];for(const s of Array.from(this.f_.keys()).sort(((t,i)=>i-t))){if(!this.f_.get(s))continue;const n=i;i=[];const e=n.length;let h=0;const l=r(this.f_.get(s)),a=l.length;let o=1/0,_=-1/0;for(let s=0;s<a;s++){const r=l[s],a=r.Yn;for(;h<e;){const t=n[h],s=t.Yn;if(!(s<a)){o=s;break}h++,i.push(t),_=s,o=1/0}o-a>=t&&a-_>=t&&(i.push(r),_=a)}for(;h<e;h++)i.push(n[h])}return i}}class ss{constructor(t){this.y_=t}k_(){return null===this.y_?null:new Qi(Math.floor(this.y_.gn()),Math.ceil(this.y_.Mn()))}C_(){return this.y_}static x_(){return new ss(null)}}var ns,es,rs,hs,ls;!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(ns||(ns={}));class as{constructor(t,i,s){this.qe=0,this.T_=null,this.D_=[],this.Ta=null,this.xa=null,this.P_=new is,this.R_=new Map,this.L_=ss.x_(),this.O_=!0,this.A_=new m,this.E_=new m,this.N_=new m,this.B_=null,this.I_=null,this.V_=[],this.us=i,this.La=s,this.F_=i.rightOffset,this.W_=i.barSpacing,this.$i=t,this.z_()}F(){return this.us}j_(t){b(this.La,t),this.H_(),this.z_()}xh(t,i){var s;b(this.us,t),this.us.fixLeftEdge&&this.U_(),this.us.fixRightEdge&&this.q_(),void 0!==t.barSpacing&&this.$i.Gs(t.barSpacing),void 0!==t.rightOffset&&this.$i.Js(t.rightOffset),void 0!==t.minBarSpacing&&this.$i.Gs(null!==(s=t.barSpacing)&&void 0!==s?s:this.W_),this.H_(),this.z_(),this.N_.m()}vs(t){var i,s;return null!==(s=null===(i=this.D_[t])||void 0===i?void 0:i.ot)&&void 0!==s?s:null}Hi(t){var i;return null!==(i=this.D_[t])&&void 0!==i?i:null}Fl(t,i){if(this.D_.length<1)return null;if(t.o_>this.D_[this.D_.length-1].ot.o_)return i?this.D_.length-1:null;const s=vt(this.D_,t.o_,((t,i)=>t.ot.o_<i));return t.o_<this.D_[s].ot.o_?i?s:null:s}Fi(){return 0===this.qe||0===this.D_.length||null===this.T_}Vn(){return this.Y_(),this.L_.k_()}X_(){return this.Y_(),this.L_.C_()}Z_(){const t=this.Vn();if(null===t)return null;const i={from:t.gn(),to:t.Mn()};return this.K_(i)}K_(t){const i=Math.round(t.from),s=Math.round(t.to),n=h(this.G_()),e=h(this.J_());return{from:h(this.vs(Math.max(n,i))),to:h(this.vs(Math.min(e,s)))}}Q_(t){return{from:h(this.Fl(t.from,!0)),to:h(this.Fl(t.to,!0))}}Xt(){return this.qe}Po(t){if(!isFinite(t)||t<=0)return;if(this.qe===t)return;const i=this.X_(),s=this.qe;if(this.qe=t,this.O_=!0,this.us.lockVisibleTimeRangeOnResize&&0!==s){const i=this.W_*t/s;this.W_=i}if(this.us.fixLeftEdge&&null!==i&&i.gn()<=0){const i=s-t;this.F_-=Math.round(i/this.W_)+1,this.O_=!0}this.tu(),this.iu()}At(t){if(this.Fi()||!g(t))return 0;const i=this.su()+this.F_-t;return this.qe-(i+.5)*this.W_-1}jn(t,i){const s=this.su(),n=void 0===i?0:i.from,e=void 0===i?t.length:i.to;for(let i=n;i<e;i++){const n=t[i].ot,e=s+this.F_-n,r=this.qe-(e+.5)*this.W_-1;t[i].nt=r}}nu(t){return Math.ceil(this.eu(t))}Js(t){this.O_=!0,this.F_=t,this.iu(),this.$i.ru(),this.$i.Th()}Kn(){return this.W_}Gs(t){this.hu(t),this.iu(),this.$i.ru(),this.$i.Th()}lu(){return this.F_}Gl(){if(this.Fi())return null;if(null!==this.I_)return this.I_;const t=this.W_,i=5*(this.$i.F().layout.fontSize+4),s=Math.round(i/t),n=h(this.Vn()),e=Math.max(n.gn(),n.gn()-s),r=Math.max(n.Mn(),n.Mn()-s),l=this.P_.g_(t,i),a=this.G_()+s,o=this.J_()-s,_=this.au(),u=this.us.fixLeftEdge||_,c=this.us.fixRightEdge||_;let d=0;for(const t of l){if(!(e<=t.Yn&&t.Yn<=r))continue;let s;d<this.V_.length?(s=this.V_[d],s.ql=this.At(t.Yn),s._a=this.ou(t),s.b_=t.b_):(s={_u:!1,ql:this.At(t.Yn),_a:this.ou(t),b_:t.b_},this.V_.push(s)),this.W_>i/2&&!_?s._u=!1:s._u=u&&t.Yn<=a||c&&t.Yn>=o,d++}return this.V_.length=d,this.I_=this.V_,this.V_}uu(){this.O_=!0,this.Gs(this.us.barSpacing),this.Js(this.us.rightOffset)}cu(t){this.O_=!0,this.T_=t,this.iu(),this.U_()}du(t,i){const s=this.eu(t),n=this.Kn(),e=n+i*(n/10);this.Gs(e),this.us.rightBarStaysOnScroll||this.Js(this.lu()+(s-this.eu(t)))}eo(t){this.Ta&&this.oo(),null===this.xa&&null===this.B_&&(this.Fi()||(this.xa=t,this.fu()))}ro(t){if(null===this.B_)return;const i=Tt(this.qe-t,0,this.qe),s=Tt(this.qe-h(this.xa),0,this.qe);0!==i&&0!==s&&this.Gs(this.B_.Kn*i/s)}ho(){null!==this.xa&&(this.xa=null,this.pu())}lo(t){null===this.Ta&&null===this.B_&&(this.Fi()||(this.Ta=t,this.fu()))}ao(t){if(null===this.Ta)return;const i=(this.Ta-t)/this.Kn();this.F_=h(this.B_).lu+i,this.O_=!0,this.iu()}oo(){null!==this.Ta&&(this.Ta=null,this.pu())}vu(){this.mu(this.us.rightOffset)}mu(t,i=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.F_,n=performance.now();this.$i.Xs({bu:t=>(t-n)/i>=1,wu:e=>{const r=(e-n)/i;return r>=1?t:s+(t-s)*r}})}bt(t,i){this.O_=!0,this.D_=t,this.P_.p_(t,i),this.iu()}gu(){return this.A_}Mu(){return this.E_}Su(){return this.N_}su(){return this.T_||0}yu(t){const i=t.d_();this.hu(this.qe/i),this.F_=t.Mn()-this.su(),this.iu(),this.O_=!0,this.$i.ru(),this.$i.Th()}ku(){const t=this.G_(),i=this.J_();null!==t&&null!==i&&this.yu(new Qi(t,i+this.us.rightOffset))}Cu(t){const i=new Qi(t.from,t.to);this.yu(i)}Ui(t){return void 0!==this.La.timeFormatter?this.La.timeFormatter(t.w_):this.xu.Jo(new Date(1e3*t.ot.o_))}au(){const{handleScroll:t,handleScale:i}=this.$i.F();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset.time||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}G_(){return 0===this.D_.length?null:0}J_(){return 0===this.D_.length?null:this.D_.length-1}Tu(t){return(this.qe-1-t)/this.W_}eu(t){const i=this.Tu(t),s=this.su()+this.F_-i;return Math.round(1e6*s)/1e6}hu(t){const i=this.W_;this.W_=t,this.tu(),i!==this.W_&&(this.O_=!0,this.Du())}Y_(){if(!this.O_)return;if(this.O_=!1,this.Fi())return void this.Pu(ss.x_());const t=this.su(),i=this.qe/this.W_,s=this.F_+t,n=new Qi(s-i+1,s);this.Pu(new ss(n))}tu(){const t=this.Ru();if(this.W_<t&&(this.W_=t,this.O_=!0),0!==this.qe){const t=.5*this.qe;this.W_>t&&(this.W_=t,this.O_=!0)}}Ru(){return this.us.fixLeftEdge&&this.us.fixRightEdge&&0!==this.D_.length?this.qe/this.D_.length:this.us.minBarSpacing}iu(){const t=this.Lu();this.F_>t&&(this.F_=t,this.O_=!0);const i=this.Ou();null!==i&&this.F_<i&&(this.F_=i,this.O_=!0)}Ou(){const t=this.G_(),i=this.T_;if(null===t||null===i)return null;return t-i-1+(this.us.fixLeftEdge?this.qe/this.W_:Math.min(2,this.D_.length))}Lu(){return this.us.fixRightEdge?0:this.qe/this.W_-Math.min(2,this.D_.length)}fu(){this.B_={Kn:this.Kn(),lu:this.lu()}}pu(){this.B_=null}ou(t){let i=this.R_.get(t.b_);return void 0===i&&(i=new Ji((t=>this.Au(t))),this.R_.set(t.b_,i)),i.Jo(t)}Au(t){const i=function(t,i,s){switch(t){case 0:case 10:return i?s?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.b_,this.us.timeVisible,this.us.secondsVisible);return void 0!==this.us.tickMarkFormatter?this.us.tickMarkFormatter(t.w_,i,this.La.locale):function(t,i,s){const n={};switch(i){case 0:n.year="numeric";break;case 1:n.month="short";break;case 2:n.day="numeric";break;case 3:n.hour12=!1,n.hour="2-digit",n.minute="2-digit";break;case 4:n.hour12=!1,n.hour="2-digit",n.minute="2-digit",n.second="2-digit"}const e=void 0===t.a_?new Date(1e3*t.o_):new Date(Date.UTC(t.a_.year,t.a_.month-1,t.a_.day));return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()).toLocaleString(s,n)}(t.ot,i,this.La.locale)}Pu(t){const i=this.L_;this.L_=t,ts(i.k_(),this.L_.k_())||this.A_.m(),ts(i.C_(),this.L_.C_())||this.E_.m(),this.Du()}Du(){this.I_=null}H_(){this.Du(),this.R_.clear()}z_(){const t=this.La.dateFormat;this.us.timeVisible?this.xu=new Gi({t_:t,i_:this.us.secondsVisible?"%h:%m:%s":"%h:%m",s_:"   ",n_:this.La.locale}):this.xu=new Xi(t,this.La.locale)}U_(){if(!this.us.fixLeftEdge)return;const t=this.G_();if(null===t)return;const i=this.Vn();if(null===i)return;const s=i.gn()-t;if(s<0){const t=this.F_-s-1;this.Js(t)}this.tu()}q_(){this.iu(),this.tu()}}class os extends R{constructor(t){super(),this.Eu=new Map,this.Et=t}Z(t){}G(t){if(!this.Et.Ct)return;t.save();let i=0;for(const s of this.Et.Nu){if(0===s.ti.length)continue;t.font=s.D;const n=this.Bu(t,s.ti);n>this.Et.Xt?s.du=this.Et.Xt/n:s.du=1,i+=s.Iu*s.du}let s=0;switch(this.Et.Vu){case"top":s=0;break;case"center":s=Math.max((this.Et.Zt-i)/2,0);break;case"bottom":s=Math.max(this.Et.Zt-i,0)}t.fillStyle=this.Et.R;for(const i of this.Et.Nu){t.save();let n=0;switch(this.Et.Fu){case"left":t.textAlign="left",n=i.Iu/2;break;case"center":t.textAlign="center",n=this.Et.Xt/2;break;case"right":t.textAlign="right",n=this.Et.Xt-1-i.Iu/2}t.translate(n,s),t.textBaseline="top",t.font=i.D,t.scale(i.du,i.du),t.fillText(i.ti,0,i.Wu),t.restore(),s+=i.Iu*i.du}t.restore()}Bu(t,i){const s=this.zu(t.font);let n=s.get(i);return void 0===n&&(n=t.measureText(i).width,s.set(i,n)),n}zu(t){let i=this.Eu.get(t);return void 0===i&&(i=new Map,this.Eu.set(t,i)),i}}class _s{constructor(t){this.ft=!0,this.zt={Ct:!1,R:"",Zt:0,Xt:0,Nu:[],Vu:"center",Fu:"center"},this.jt=new os(this.zt),this.$t=t}bt(){this.ft=!0}gt(t,i){return this.ft&&(this.Mt(t,i),this.ft=!1),this.jt}Mt(t,i){const s=this.$t.F(),n=this.zt;n.Ct=s.visible,n.Ct&&(n.R=s.color,n.Xt=i,n.Zt=t,n.Fu=s.horzAlign,n.Vu=s.vertAlign,n.Nu=[{ti:s.text,D:T(s.fontSize,s.fontFamily,s.fontStyle),Iu:1.2*s.fontSize,Wu:0,du:0}])}}class us extends K{constructor(t,i){super(),this.us=i,this.ws=new _s(this)}Ps(){return[]}Ds(){return[this.ws]}F(){return this.us}Ls(){this.ws.bt()}}!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(es||(es={}));class cs{constructor(t,i){this.ju=[],this.$u=[],this.qe=0,this.Hu=null,this.Uu=new m,this.qu=new m,this.Yu=null,this.Xu=t,this.us=i,this.Zu=new D(this),this.mo=new as(this,i.timeScale,this.us.localization),this.vt=new J(this,i.crosshair),this.Ku=new ki(i.crosshair),this.Gu=new us(this,i.watermark),this.Ju(),this.ju[0].Do(2e3),this.Qu=this.tc(0),this.ic=this.tc(1)}fl(){this.sc(tt.en())}Th(){this.sc(tt.nn())}Tl(){this.sc(new tt(1))}pl(t){const i=this.nc(t);this.sc(i)}ec(){return this.Hu}rc(t){const i=this.Hu;this.Hu=t,null!==i&&this.pl(i.hc),null!==t&&this.pl(t.hc)}F(){return this.us}xh(t){b(this.us,t),this.ju.forEach((i=>i.ko(t))),void 0!==t.timeScale&&this.mo.xh(t.timeScale),void 0!==t.localization&&this.mo.j_(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Uu.m(),this.Qu=this.tc(0),this.ic=this.tc(1),this.fl()}lc(t,i){if("left"===t)return void this.xh({leftPriceScale:i});if("right"===t)return void this.xh({rightPriceScale:i});const s=this.ac(t);null!==s&&(s.Pt.xh(i),this.Uu.m())}ac(t){for(const i of this.ju){const s=i.Co(t);if(null!==s)return{Ht:i,Pt:s}}return null}yt(){return this.mo}oc(){return this.ju}_c(){return this.Gu}uc(){return this.vt}cc(){return this.qu}dc(t,i){t.$a(i),this.ru()}Po(t){this.qe=t,this.mo.Po(this.qe),this.ju.forEach((i=>i.Po(t))),this.ru()}Ju(t){const i=new Ui(this.mo,this);void 0!==t?this.ju.splice(t,0,i):this.ju.push(i);const s=void 0===t?this.ju.length-1:t,n=tt.en();return n.Fs(s,{Ws:0,zs:!0}),this.sc(n),i}Io(t,i,s){t.Io(i,s)}Vo(t,i,s){t.Vo(i,s),this.vl(),this.sc(this.fc(t,2))}Fo(t,i){t.Fo(i),this.sc(this.fc(t,2))}Wo(t,i,s){i.Ia()||t.Wo(i,s)}zo(t,i,s){i.Ia()||(t.zo(i,s),this.vl(),this.sc(this.fc(t,2)))}jo(t,i){i.Ia()||(t.jo(i),this.sc(this.fc(t,2)))}Ho(t,i){t.Ho(i),this.sc(this.fc(t,2))}vc(t){this.mo.eo(t)}mc(t,i){const s=this.yt();if(s.Fi()||0===i)return;const n=s.Xt();t=Math.max(1,Math.min(t,n)),s.du(t,i),this.ru()}bc(t){this.wc(0),this.gc(t),this.Mc()}Sc(t){this.mo.ro(t),this.ru()}yc(){this.mo.ho(),this.Th()}wc(t){this.mo.lo(t)}gc(t){this.mo.ao(t),this.ru()}Mc(){this.mo.oo(),this.Th()}wt(){return this.$u}kc(t,i,s){this.vt.gs(t,i);let n=NaN,e=this.mo.nu(t);const r=this.mo.Vn();null!==r&&(e=Math.min(Math.max(r.gn(),e),r.Mn()));const h=s.fs(),l=h.xt();null!==l&&(n=h.ps(i,l)),n=this.Ku.Wl(n,e,s),this.vt.ks(e,n,s),this.Tl(),this.qu.m(this.vt.St(),{x:t,y:i})}Cc(t,i,s,n){this.vt.gs(t,i);let e=NaN,r=this.mo.nu(t);const h=this.mo.Vn();null!==h&&(r=Math.min(Math.max(h.gn(),r),h.Mn()));const l=n.fs(),a=l.xt();null!==a&&(e=l.ps(i,a)),e=this.Ku.Wl(e,r,n),this.vt.ks(r,e,n),this.Tl(),s&&this.qu.m(this.vt.St(),{x:t,y:i})}xc(){this.uc().xs(),this.Tl(),this.qu.m(null,null)}vl(){const t=this.vt.Ht();if(null!==t){const i=this.vt.Ss(),s=this.vt.ys();this.kc(i,s,t)}this.vt.Ls()}Tc(t,i,s){const n=this.mo.vs(0);void 0!==i&&void 0!==s&&this.mo.bt(i,s);const e=this.mo.vs(0),r=this.mo.su(),h=this.mo.Vn();if(null!==h&&null!==n&&null!==e){const i=h.Ar(r),s=n.o_>e.o_,l=null!==t&&t>r&&!s,a=i&&this.mo.F().shiftVisibleRangeOnNewBar;if(l&&!a){const i=t-r;this.mo.Js(this.mo.lu()-i)}}this.mo.cu(t)}wl(t){null!==t&&t.qo()}Ge(t){const i=this.ju.find((i=>i.Ga().includes(t)));return void 0===i?null:i}ru(){this.Gu.Ls(),this.ju.forEach((t=>t.qo())),this.vl()}M(){this.ju.forEach((t=>t.M())),this.ju.length=0,this.us.localization.priceFormatter=void 0,this.us.localization.timeFormatter=void 0}Dc(){return this.Zu}ir(){return this.Zu.F()}xo(){return this.Uu}Pc(t,i){const s=this.ju[0],n=this.Rc(i,t,s);return this.$u.push(n),1===this.$u.length?this.fl():this.Th(),n}Lc(t){const i=this.Ge(t),s=this.$u.indexOf(t);e(-1!==s,"Series not found"),this.$u.splice(s,1),h(i).io(t),t.M&&t.M()}dl(t,i){const s=h(this.Ge(t));s.io(t);const n=this.ac(i);if(null===n){const n=t.Xi();s.Ja(t,i,n)}else{const e=n.Ht===s?t.Xi():void 0;n.Ht.Ja(t,i,e)}}ku(){const t=tt.nn();t.Hs(),this.sc(t)}Oc(t){const i=tt.nn();i.Ys(t),this.sc(i)}Ks(){const t=tt.nn();t.Ks(),this.sc(t)}Gs(t){const i=tt.nn();i.Gs(t),this.sc(i)}Js(t){const i=tt.nn();i.Js(t),this.sc(i)}Xs(t){const i=tt.nn();i.Xs(t),this.sc(i)}Us(){const t=tt.nn();t.Us(),this.sc(t)}Ac(){return this.us.rightPriceScale.visible?"right":"left"}Ec(){return this.ic}U(){return this.Qu}Ot(t){const i=this.ic,s=this.Qu;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.Yu||this.Yu.vn!==s||this.Yu.mn!==i)this.Yu={vn:s,mn:i,Nc:new Map};else{const i=this.Yu.Nc.get(t);if(void 0!==i)return i}const n=function(t,i,s){const[n,e,r,h]=p(t),[l,a,u,c]=p(i),d=[o(n+s*(l-n)),o(e+s*(a-e)),o(r+s*(u-r)),_(h+s*(c-h))];return`rgba(${d[0]}, ${d[1]}, ${d[2]}, ${d[3]})`}(s,i,t/100);return this.Yu.Nc.set(t,n),n}fc(t,i){const s=new tt(i);if(null!==t){const n=this.ju.indexOf(t);s.Fs(n,{Ws:i})}return s}nc(t,i){return void 0===i&&(i=2),this.fc(this.Ge(t),i)}sc(t){this.Xu&&this.Xu(t),this.ju.forEach((t=>t.Xo().Dh().bt()))}Rc(t,i,s){const n=new yi(this,t,i),e=void 0!==t.priceScaleId?t.priceScaleId:this.Ac();return s.Ja(n,e),Q(e)||n.xh(t),n}tc(t){const i=this.us.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}}function ds(t){return!w(t)&&!M(t)}function fs(t){return w(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(rs||(rs={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(hs||(hs={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(ls||(ls={}));var ps={allowDownsampling:!0};var vs=function(){function t(t,i){var s=this;this._resolutionMediaQueryList=null,this._resolutionListener=function(t){return s._onResolutionChanged()},this._canvasConfiguredListeners=[],this.canvas=t,this._canvasSize={width:this.canvas.clientWidth,height:this.canvas.clientHeight},this._options=i,this._configureCanvas(),this._installResolutionListener()}return t.prototype.destroy=function(){this._canvasConfiguredListeners.length=0,this._uninstallResolutionListener(),this.canvas=null},Object.defineProperty(t.prototype,"canvasSize",{get:function(){return{width:this._canvasSize.width,height:this._canvasSize.height}},enumerable:!0,configurable:!0}),t.prototype.resizeCanvas=function(t){this._canvasSize={width:t.width,height:t.height},this._configureCanvas()},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");return t.devicePixelRatio>1||this._options.allowDownsampling?t.devicePixelRatio:1},enumerable:!0,configurable:!0}),t.prototype.subscribeCanvasConfigured=function(t){this._canvasConfiguredListeners.push(t)},t.prototype.unsubscribeCanvasConfigured=function(t){this._canvasConfiguredListeners=this._canvasConfiguredListeners.filter((function(i){return i!=t}))},t.prototype._configureCanvas=function(){var t=this.pixelRatio;this.canvas.style.width=this._canvasSize.width+"px",this.canvas.style.height=this._canvasSize.height+"px",this.canvas.width=this._canvasSize.width*t,this.canvas.height=this._canvasSize.height*t,this._emitCanvasConfigured()},t.prototype._emitCanvasConfigured=function(){var t=this;this._canvasConfiguredListeners.forEach((function(i){return i.call(t)}))},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");var i=t.devicePixelRatio;this._resolutionMediaQueryList=t.matchMedia("all and (resolution: "+i+"dppx)"),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){this._configureCanvas(),this._reinstallResolutionListener()},t}();class ms{constructor(t,i){this.It=t,this.Vt=i}hh(t){return this.It===t.It&&this.Vt===t.Vt}}function bs(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function ws(t){const i=h(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function gs(t,i){const s=h(t.ownerDocument).createElement("canvas");t.appendChild(s);const n=function(t,i){return void 0===i&&(i=ps),new vs(t,i)}(s,{allowDownsampling:!1});return n.resizeCanvas({width:i.It,height:i.Vt}),n}function Ms(t,i){return t.Bc-i.Bc}function Ss(t,i,s){const n=(t.Bc-i.Bc)/(t.ot-i.ot);return Math.sign(n)*Math.min(Math.abs(n),s)}class ys{constructor(t,i,s,n){this.Ic=null,this.Vc=null,this.Fc=null,this.Wc=null,this.zc=null,this.jc=0,this.$c=0,this.Hc=t,this.Uc=i,this.qc=s,this.rn=n}Yc(t,i){if(null!==this.Ic){if(this.Ic.ot===i)return void(this.Ic.Bc=t);if(Math.abs(this.Ic.Bc-t)<this.rn)return}this.Wc=this.Fc,this.Fc=this.Vc,this.Vc=this.Ic,this.Ic={ot:i,Bc:t}}cr(t,i){if(null===this.Ic||null===this.Vc)return;if(i-this.Ic.ot>50)return;let s=0;const n=Ss(this.Ic,this.Vc,this.Uc),e=Ms(this.Ic,this.Vc),r=[n],h=[e];if(s+=e,null!==this.Fc){const t=Ss(this.Vc,this.Fc,this.Uc);if(Math.sign(t)===Math.sign(n)){const i=Ms(this.Vc,this.Fc);if(r.push(t),h.push(i),s+=i,null!==this.Wc){const t=Ss(this.Fc,this.Wc,this.Uc);if(Math.sign(t)===Math.sign(n)){const i=Ms(this.Fc,this.Wc);r.push(t),h.push(i),s+=i}}}}let l=0;for(let t=0;t<r.length;++t)l+=h[t]/s*r[t];Math.abs(l)<this.Hc||(this.zc={Bc:t,ot:i},this.$c=l,this.jc=function(t,i){const s=Math.log(i);return Math.log(1*s/-t)/s}(Math.abs(l),this.qc))}wu(t){const i=h(this.zc),s=t-i.ot;return i.Bc+this.$c*(Math.pow(this.qc,s)-1)/Math.log(this.qc)}bu(t){return null===this.zc||this.Xc(t)===this.jc}Xc(t){const i=t-h(this.zc).ot;return Math.min(i,this.jc)}}const ks="undefined"!=typeof window;function Cs(){return!!ks&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function xs(){return!!ks&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function Ts(t){ks&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}class Ds{constructor(t,i,s){this.Zc=0,this.Kc=null,this.Gc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.Jc=0,this.Qc=null,this.td={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.sd=null,this.nd=!1,this.ed=null,this.rd=null,this.hd=!1,this.ld=!1,this.ad=!1,this.od=null,this._d=null,this.ud=null,this.dd=null,this.fd=null,this.pd=null,this.vd=null,this.md=0,this.bd=!1,this.wd=!1,this.gd=!1,this.Md=0,this.Sd=null,this.yd=!xs(),this.kd=t=>{this.Cd(t)},this.xd=t=>{if(this.Td(t)){const i=this.Dd(t);if(++this.Jc,this.Qc&&this.Jc>1){const{Pd:s}=this.Rd(Ls(t),this.td);s<30&&!this.ad&&this.Ld(i,this.Ad.Od),this.Ed()}}else{const i=this.Dd(t);if(++this.Zc,this.Kc&&this.Zc>1){const{Pd:s}=this.Rd(Ls(t),this.Gc);s<5&&!this.ld&&this.Nd(i,this.Ad.Bd),this.Id()}}},this.Vd=t,this.Ad=i,this.us=s,this.Fd()}M(){null!==this.od&&(this.od(),this.od=null),null!==this._d&&(this._d(),this._d=null),null!==this.dd&&(this.dd(),this.dd=null),null!==this.fd&&(this.fd(),this.fd=null),null!==this.pd&&(this.pd(),this.pd=null),null!==this.ud&&(this.ud(),this.ud=null),this.Wd(),this.Id()}zd(t){this.dd&&this.dd();const i=this.jd.bind(this);if(this.dd=()=>{this.Vd.removeEventListener("mousemove",i)},this.Vd.addEventListener("mousemove",i),this.Td(t))return;const s=this.Dd(t);this.Nd(s,this.Ad.$d),this.yd=!0}Id(){null!==this.Kc&&clearTimeout(this.Kc),this.Zc=0,this.Kc=null,this.Gc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}Ed(){null!==this.Qc&&clearTimeout(this.Qc),this.Jc=0,this.Qc=null,this.td={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}jd(t){if(this.gd||null!==this.rd)return;if(this.Td(t))return;const i=this.Dd(t);this.Nd(i,this.Ad.Hd),this.yd=!0}Ud(t){const i=As(t.changedTouches,h(this.Sd));if(null===i)return;if(this.Md=Os(t),null!==this.vd)return;if(this.wd)return;this.bd=!0;const s=this.Rd(Ls(i),h(this.rd)),{qd:n,Yd:e,Pd:r}=s;if(this.hd||!(r<5)){if(!this.hd){const t=.5*n,i=e>=t&&!this.us.Xd(),s=t>e&&!this.us.Zd();i||s||(this.wd=!0),this.hd=!0,this.ad=!0,this.Wd(),this.Ed()}if(!this.wd){const s=this.Dd(t,i);this.Ld(s,this.Ad.Kd),Rs(t)}}}Gd(t){if(0!==t.button)return;const i=this.Rd(Ls(t),h(this.ed)),{Pd:s}=i;if(s>=5&&(this.ld=!0,this.Id()),this.ld){const i=this.Dd(t);this.Nd(i,this.Ad.Jd)}}Rd(t,i){const s=Math.abs(i.nt-t.nt),n=Math.abs(i.et-t.et);return{qd:s,Yd:n,Pd:s+n}}Qd(t){let i=As(t.changedTouches,h(this.Sd));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.Sd=null,this.Md=Os(t),this.Wd(),this.rd=null,this.pd&&(this.pd(),this.pd=null);const s=this.Dd(t,i);if(this.Ld(s,this.Ad.tf),++this.Jc,this.Qc&&this.Jc>1){const{Pd:t}=this.Rd(Ls(i),this.td);t<30&&!this.ad&&this.Ld(s,this.Ad.Od),this.Ed()}else this.ad||(this.Ld(s,this.Ad.if),this.Ad.if&&Rs(t));0===this.Jc&&Rs(t),0===t.touches.length&&this.nd&&(this.nd=!1,Rs(t))}Cd(t){if(0!==t.button)return;const i=this.Dd(t);if(this.ed=null,this.gd=!1,this.fd&&(this.fd(),this.fd=null),Cs()){this.Vd.ownerDocument.documentElement.removeEventListener("mouseleave",this.kd)}if(!this.Td(t))if(this.Nd(i,this.Ad.sf),++this.Zc,this.Kc&&this.Zc>1){const{Pd:s}=this.Rd(Ls(t),this.Gc);s<5&&!this.ld&&this.Nd(i,this.Ad.Bd),this.Id()}else this.ld||this.Nd(i,this.Ad.nf)}Wd(){null!==this.sd&&(clearTimeout(this.sd),this.sd=null)}ef(t){if(null!==this.Sd)return;const i=t.changedTouches[0];this.Sd=i.identifier,this.Md=Os(t);const s=this.Vd.ownerDocument.documentElement;this.ad=!1,this.hd=!1,this.wd=!1,this.rd=Ls(i),this.pd&&(this.pd(),this.pd=null);{const i=this.Ud.bind(this),n=this.Qd.bind(this);this.pd=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",n)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",n,{passive:!1}),this.Wd(),this.sd=setTimeout(this.rf.bind(this,t),240)}const n=this.Dd(t,i);this.Ld(n,this.Ad.hf),this.Qc||(this.Jc=0,this.Qc=setTimeout(this.Ed.bind(this),500),this.td=Ls(i))}lf(t){if(0!==t.button)return;const i=this.Vd.ownerDocument.documentElement;Cs()&&i.addEventListener("mouseleave",this.kd),this.ld=!1,this.ed=Ls(t),this.fd&&(this.fd(),this.fd=null);{const t=this.Gd.bind(this),s=this.Cd.bind(this);this.fd=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",s)}if(this.gd=!0,this.Td(t))return;const s=this.Dd(t);this.Nd(s,this.Ad.af),this.Kc||(this.Zc=0,this.Kc=setTimeout(this.Id.bind(this),500),this.Gc=Ls(t))}Fd(){this.Vd.addEventListener("mouseenter",this.zd.bind(this)),this.Vd.addEventListener("touchcancel",this.Wd.bind(this));{const t=this.Vd.ownerDocument,i=t=>{this.Ad._f&&(t.composed&&this.Vd.contains(t.composedPath()[0])||t.target&&this.Vd.contains(t.target)||this.Ad._f())};this._d=()=>{t.removeEventListener("touchstart",i)},this.od=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}xs()&&(this.ud=()=>{this.Vd.removeEventListener("dblclick",this.xd)},this.Vd.addEventListener("dblclick",this.xd)),this.Vd.addEventListener("mouseleave",this.uf.bind(this)),this.Vd.addEventListener("touchstart",this.ef.bind(this),{passive:!0}),Ts(this.Vd),this.Vd.addEventListener("mousedown",this.lf.bind(this)),this.cf(),this.Vd.addEventListener("touchmove",(()=>{}),{passive:!1})}cf(){void 0===this.Ad.df&&void 0===this.Ad.ff&&void 0===this.Ad.pf||(this.Vd.addEventListener("touchstart",(t=>this.vf(t.touches)),{passive:!0}),this.Vd.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.vd&&void 0!==this.Ad.ff){const i=Ps(t.touches[0],t.touches[1])/this.md;this.Ad.ff(this.vd,i),Rs(t)}}),{passive:!1}),this.Vd.addEventListener("touchend",(t=>{this.vf(t.touches)})))}vf(t){1===t.length&&(this.bd=!1),2!==t.length||this.bd||this.nd?this.mf():this.bf(t)}bf(t){const i=this.Vd.getBoundingClientRect()||{left:0,top:0};this.vd={nt:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,et:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.md=Ps(t[0],t[1]),void 0!==this.Ad.df&&this.Ad.df(),this.Wd()}mf(){null!==this.vd&&(this.vd=null,void 0!==this.Ad.pf&&this.Ad.pf())}uf(t){if(this.dd&&this.dd(),this.Td(t))return;if(!this.yd)return;const i=this.Dd(t);this.Nd(i,this.Ad.wf),this.yd=!xs()}rf(t){const i=As(t.touches,h(this.Sd));if(null===i)return;const s=this.Dd(t,i);this.Ld(s,this.Ad.gf),this.ad=!0,this.nd=!0}Td(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:Os(t)<this.Md+500}Ld(t,i){i&&i.call(this.Ad,t)}Nd(t,i){i&&i.call(this.Ad,t)}Dd(t,i){const s=i||t,n=this.Vd.getBoundingClientRect()||{left:0,top:0};return{Mf:s.clientX,Sf:s.clientY,yf:s.pageX,kf:s.pageY,Cf:s.screenX,xf:s.screenY,Tf:s.clientX-n.left,Df:s.clientY-n.top,Pf:t.ctrlKey,Rf:t.altKey,Lf:t.shiftKey,Of:t.metaKey,Af:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,Ef:t.type,Nf:s.target,Bf:t.view,If:()=>{"touchstart"!==t.type&&Rs(t)}}}}function Ps(t,i){const s=t.clientX-i.clientX,n=t.clientY-i.clientY;return Math.sqrt(s*s+n*n)}function Rs(t){t.cancelable&&t.preventDefault()}function Ls(t){return{nt:t.pageX,et:t.pageY}}function Os(t){return t.timeStamp||performance.now()}function As(t,i){for(let s=0;s<t.length;++s)if(t[s].identifier===i)return t[s];return null}class Es{constructor(t,i,s,n){this.Ii=null,this.Vf=null,this.Ff=!1,this.Wf=new Wt(200),this.Nr=null,this.zf=0,this.jf=!1,this.$f=()=>{this.jf||this.Qi.Hf().Ut().Th()},this.Uf=()=>{this.jf||this.Qi.Hf().Ut().Th()},this.Qi=t,this.us=i,this.Ra=i.layout,this.Zu=s,this.qf="left"===n,this.Yf=document.createElement("div"),this.Yf.style.height="100%",this.Yf.style.overflow="hidden",this.Yf.style.width="25px",this.Yf.style.left="0",this.Yf.style.position="relative",this.Xf=gs(this.Yf,new ms(16,16)),this.Xf.subscribeCanvasConfigured(this.$f);const e=this.Xf.canvas;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.Zf=gs(this.Yf,new ms(16,16)),this.Zf.subscribeCanvasConfigured(this.Uf);const r=this.Zf.canvas;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0";const h={af:this.Kf.bind(this),hf:this.Kf.bind(this),Jd:this.Gf.bind(this),Kd:this.Gf.bind(this),_f:this.Jf.bind(this),sf:this.Qf.bind(this),tf:this.Qf.bind(this),Bd:this.tp.bind(this),Od:this.tp.bind(this),$d:this.ip.bind(this),wf:this.sp.bind(this)};this.np=new Ds(this.Zf.canvas,h,{Xd:()=>!1,Zd:()=>!0})}M(){this.np.M(),this.Zf.unsubscribeCanvasConfigured(this.Uf),this.Zf.destroy(),this.Xf.unsubscribeCanvasConfigured(this.$f),this.Xf.destroy(),null!==this.Ii&&this.Ii.no().v(this),this.Ii=null}ep(){return this.Yf}T(){return this.Ra.fontSize}rp(){const t=this.Zu.F();return this.Nr!==t.D&&(this.Wf.We(),this.Nr=t.D),t}hp(){if(null===this.Ii)return 0;let t=0;const i=this.rp(),s=ws(this.Xf.canvas),n=this.Ii.Gl();s.font=this.lp(),n.length>0&&(t=Math.max(this.Wf.Mi(s,n[0]._a),this.Wf.Mi(s,n[n.length-1]._a)));const e=this.ap();for(let i=e.length;i--;){const n=this.Wf.Mi(s,e[i].ti());n>t&&(t=n)}const r=this.Ii.xt();if(null!==r&&null!==this.Vf){const i=this.Ii.ps(1,r),n=this.Ii.ps(this.Vf.Vt-2,r);t=Math.max(t,this.Wf.Mi(s,this.Ii.Wi(Math.floor(Math.min(i,n))+.11111111111111,r)),this.Wf.Mi(s,this.Ii.Wi(Math.ceil(Math.max(i,n))-.11111111111111,r)))}const h=t||34;let l=Math.ceil(i.k+i.C+i.A+i.N+5+h);return l+=l%2,l}op(t){if(t.It<0||t.Vt<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.Vf&&this.Vf.hh(t)||(this.Vf=t,this.jf=!0,this.Xf.resizeCanvas({width:t.It,height:t.Vt}),this.Zf.resizeCanvas({width:t.It,height:t.Vt}),this.jf=!1,this.Yf.style.width=t.It+"px",this.Yf.style.height=t.Vt+"px",this.Yf.style.minWidth=t.It+"px")}_p(){return h(this.Vf).It}Ki(t){this.Ii!==t&&(null!==this.Ii&&this.Ii.no().v(this),this.Ii=t,t.no().l(this.Ma.bind(this),this))}Pt(){return this.Ii}We(){const t=this.Qi.up();this.Qi.Hf().Ut().Ho(t,h(this.Pt()))}cp(t){if(null===this.Vf)return;if(1!==t){const t=ws(this.Xf.canvas);this.dp(),this.fp(t,this.Xf.pixelRatio),this.ke(t,this.Xf.pixelRatio),this.pp(t,this.Xf.pixelRatio),this.vp(t,this.Xf.pixelRatio)}const i=ws(this.Zf.canvas),s=this.Vf.It,n=this.Vf.Vt;V(i,this.Zf.pixelRatio,(()=>{i.clearRect(0,0,s,n)})),this.mp(i,this.Zf.pixelRatio)}bp(){return this.Xf.canvas}bt(){var t;null===(t=this.Ii)||void 0===t||t.Gl()}Kf(t){if(null===this.Ii||this.Ii.Fi()||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.Hf().Ut(),s=this.Qi.up();this.Ff=!0,i.Io(s,this.Ii,t.Df)}Gf(t){if(null===this.Ii||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.Hf().Ut(),s=this.Qi.up(),n=this.Ii;i.Vo(s,n,t.Df)}Jf(){if(null===this.Ii||!this.us.handleScale.axisPressedMouseMove.price)return;const t=this.Qi.Hf().Ut(),i=this.Qi.up(),s=this.Ii;this.Ff&&(this.Ff=!1,t.Fo(i,s))}Qf(t){if(null===this.Ii||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.Hf().Ut(),s=this.Qi.up();this.Ff=!1,i.Fo(s,this.Ii)}tp(t){this.us.handleScale.axisDoubleClickReset.price&&this.We()}ip(t){if(null===this.Ii)return;!this.Qi.Hf().Ut().F().handleScale.axisPressedMouseMove.price||this.Ii.ih()||this.Ii.Va()||this.wp(1)}sp(t){this.wp(0)}ap(){const t=[],i=null===this.Ii?void 0:this.Ii;return(s=>{for(let n=0;n<s.length;++n){const e=s[n].Ps(this.Qi.up(),i);for(let i=0;i<e.length;i++)t.push(e[i])}})(this.Qi.up().Ga()),t}fp(t,i){if(null===this.Vf)return;const s=this.Vf.It,n=this.Vf.Vt;V(t,i,(()=>{const i=this.Qi.up().Ut(),e=i.U(),r=i.Ec();e===r?F(t,0,0,s,n,e):$(t,0,0,s,n,e,r)}))}ke(t,i){if(null===this.Vf||null===this.Ii||!this.Ii.F().borderVisible)return;t.save(),t.fillStyle=this.Ii.F().borderColor;const s=Math.max(1,Math.floor(this.rp().k*i));let n;n=this.qf?Math.floor(this.Vf.It*i)-s:0,t.fillRect(n,0,s,Math.ceil(this.Vf.Vt*i)),t.restore()}pp(t,i){var s;if(null===this.Vf||null===this.Ii)return;const n=this.Ii.Gl();t.save();const e=this.Ii.F();t.strokeStyle=e.borderColor,t.font=this.lp(),t.fillStyle=e.borderColor;const r=this.rp(),h=this.qf?Math.floor((this.Vf.It-r.C)*i):0,l=this.qf?Math.round(h-r.A*i):Math.round(h+r.C*i+r.A*i),a=Math.max(1,Math.floor(i)),o=Math.floor(.5*i);if(e.borderVisible&&e.ticksVisible){const s=Math.round(r.C*i);t.beginPath();for(const e of n)t.rect(h,Math.round(e.ql*i)-o,s,a);t.fill()}t.fillStyle=null!==(s=e.textColor)&&void 0!==s?s:this.Ra.textColor,t.textAlign=this.qf?"right":"left",t.textBaseline="middle";const _=n.map((i=>this.Wf.gi(t,i._a)));V(t,i,(()=>{for(let s=n.length;s--;){const e=n[s];t.fillText(e._a,l/i,e.ql+_[s])}})),t.restore()}dp(){if(null===this.Vf||null===this.Ii)return;let t=this.Vf.Vt/2;const i=[],s=this.Ii.Ga().slice(),n=this.Qi.up(),e=this.rp();this.Ii===n.Qe()&&this.Qi.up().Ga().forEach((t=>{n.Je(t)&&s.push(t)}));const r=this.Ii.zl()[0],h=this.Ii;s.forEach((s=>{const e=s.Ps(n,h);e.forEach((t=>{t.Oi(null),t.Ai()&&i.push(t)})),r===s&&e.length>0&&(t=e[0].yi())}));const l=i.filter((i=>i.yi()<=t)),a=i.filter((i=>i.yi()>t));l.sort(((t,i)=>i.yi()-t.yi())),l.length&&a.length&&a.push(l[0]),a.sort(((t,i)=>t.yi()-i.yi())),i.forEach((t=>t.Oi(t.yi())));if(this.Ii.F().alignLabels){for(let t=1;t<l.length;t++){const i=l[t],s=l[t-1],n=s.Zt(e,!1),r=i.yi(),h=s.Li();r>h-n&&i.Oi(h-n)}for(let t=1;t<a.length;t++){const i=a[t],s=a[t-1],n=s.Zt(e,!0),r=i.yi(),h=s.Li();r<h+n&&i.Oi(h+n)}}}vp(t,i){if(null===this.Vf)return;t.save();const s=this.Vf,n=this.ap(),e=this.rp(),r=this.qf?"right":"left";n.forEach((n=>{if(n.Ei()){const l=n.gt(h(this.Ii));t.save(),l.X(t,e,this.Wf,s.It,r,i),t.restore()}})),t.restore()}mp(t,i){if(null===this.Vf||null===this.Ii)return;t.save();const s=this.Vf,n=this.Qi.Hf().Ut(),e=[],r=this.Qi.up(),l=n.uc().Ps(r,this.Ii);l.length&&e.push(l);const a=this.rp(),o=this.qf?"right":"left";e.forEach((n=>{n.forEach((n=>{t.save(),n.gt(h(this.Ii)).X(t,a,this.Wf,s.It,o,i),t.restore()}))})),t.restore()}wp(t){this.Yf.style.cursor=1===t?"ns-resize":"default"}Ma(){const t=this.hp();this.zf<t&&this.Qi.Hf().Ut().fl(),this.zf=t}lp(){return T(this.Ra.fontSize,this.Ra.fontFamily)}}function Ns(t,i,s,n,e){t.K&&t.K(i,s,n,e)}function Bs(t,i,s,n,e){t.X(i,s,n,e)}function Is(t,i){return t.Ds(i)}function Vs(t,i){return t.Gi(i)}function Fs(t,i){return void 0!==t.xl?t.xl(i):[]}class Ws{constructor(t,i){this.Vf=new ms(0,0),this.gp=null,this.Mp=null,this.Sp=null,this.yp=!1,this.kp=new m,this.Cp=0,this.xp=!1,this.Tp=null,this.Dp=!1,this.Pp=null,this.Rp=null,this.jf=!1,this.$f=()=>{this.jf||null===this.Lp||this.$i().Th()},this.Uf=()=>{this.jf||null===this.Lp||this.$i().Th()},this.Op=t,this.Lp=i,this.Lp.Yo().l(this.Ap.bind(this),this,!0),this.Ep=document.createElement("td"),this.Ep.style.padding="0",this.Ep.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Np=document.createElement("td"),this.Np.style.padding="0",this.Bp=document.createElement("td"),this.Bp.style.padding="0",this.Ep.appendChild(s),this.Xf=gs(s,new ms(16,16)),this.Xf.subscribeCanvasConfigured(this.$f);const n=this.Xf.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.Zf=gs(s,new ms(16,16)),this.Zf.subscribeCanvasConfigured(this.Uf);const e=this.Zf.canvas;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0",this.Ip=document.createElement("tr"),this.Ip.appendChild(this.Np),this.Ip.appendChild(this.Ep),this.Ip.appendChild(this.Bp),this.Vp(),this.np=new Ds(this.Zf.canvas,this,{Xd:()=>null===this.Tp&&!this.Op.F().handleScroll.vertTouchDrag,Zd:()=>null===this.Tp&&!this.Op.F().handleScroll.horzTouchDrag})}M(){null!==this.gp&&this.gp.M(),null!==this.Mp&&this.Mp.M(),this.Zf.unsubscribeCanvasConfigured(this.Uf),this.Zf.destroy(),this.Xf.unsubscribeCanvasConfigured(this.$f),this.Xf.destroy(),null!==this.Lp&&this.Lp.Yo().v(this),this.np.M()}up(){return h(this.Lp)}Fp(t){null!==this.Lp&&this.Lp.Yo().v(this),this.Lp=t,null!==this.Lp&&this.Lp.Yo().l(Ws.prototype.Ap.bind(this),this,!0),this.Vp()}Hf(){return this.Op}ep(){return this.Ip}Vp(){if(null!==this.Lp&&(this.Wp(),0!==this.$i().wt().length)){if(null!==this.gp){const t=this.Lp.No();this.gp.Ki(h(t))}if(null!==this.Mp){const t=this.Lp.Bo();this.Mp.Ki(h(t))}}}zp(){null!==this.gp&&this.gp.bt(),null!==this.Mp&&this.Mp.bt()}To(){return null!==this.Lp?this.Lp.To():0}Do(t){this.Lp&&this.Lp.Do(t)}$d(t){if(!this.Lp)return;this.jp();const i=t.Tf,s=t.Df;this.$p(i,s)}af(t){this.jp(),this.Hp(),this.$p(t.Tf,t.Df)}Hd(t){if(!this.Lp)return;this.jp();const i=t.Tf,s=t.Df;this.$p(i,s);const n=this.Br(i,s);this.$i().rc(n&&{hc:n.hc,Up:n.Up})}nf(t){null!==this.Lp&&(this.jp(),this.qp(t))}Jd(t){this.jp(),this.Yp(t),this.$p(t.Tf,t.Df)}sf(t){null!==this.Lp&&(this.jp(),this.xp=!1,this.Xp(t))}if(t){null!==this.Lp&&this.qp(t)}gf(t){if(this.xp=!0,null===this.Tp){const i={x:t.Tf,y:t.Df};this.Zp(i,i)}}wf(t){null!==this.Lp&&(this.jp(),this.Lp.Ut().rc(null),this.Kp())}Gp(){return this.kp}df(){this.Cp=1,this.$i().Us()}ff(t,i){if(!this.Op.F().handleScale.pinch)return;const s=5*(i-this.Cp);this.Cp=i,this.$i().mc(t.nt,s)}hf(t){if(this.xp=!1,this.Dp=null!==this.Tp,this.Hp(),null!==this.Tp){const i=this.$i().uc();this.Pp={x:i.Kt(),y:i.Gt()},this.Tp={x:t.Tf,y:t.Df}}}Kd(t){if(null===this.Lp)return;const i=t.Tf,s=t.Df;if(null===this.Tp)this.Yp(t);else{this.Dp=!1;const t=h(this.Pp),n=t.x+(i-this.Tp.x),e=t.y+(s-this.Tp.y);this.$p(n,e)}}tf(t){0===this.Hf().F().trackingMode.exitMode&&(this.Dp=!0),this.Jp(),this.Xp(t)}Br(t,i){const s=this.Lp;if(null===s)return null;const n=s.Ga();for(const e of n){const n=this.Qp(e.Ds(s),t,i);if(null!==n)return{hc:e,Bf:n.Bf,Up:n.Up}}return null}tv(t,i){h("left"===i?this.gp:this.Mp).op(new ms(t,this.Vf.Vt))}iv(){return this.Vf}op(t){if(t.It<0||t.Vt<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.Vf.hh(t)||(this.Vf=t,this.jf=!0,this.Xf.resizeCanvas({width:t.It,height:t.Vt}),this.Zf.resizeCanvas({width:t.It,height:t.Vt}),this.jf=!1,this.Ep.style.width=t.It+"px",this.Ep.style.height=t.Vt+"px")}sv(){const t=h(this.Lp);t.Eo(t.No()),t.Eo(t.Bo());for(const i of t.zl())if(t.Je(i)){const s=i.Pt();null!==s&&t.Eo(s),i.Ls()}}bp(){return this.Xf.canvas}cp(t){if(0===t)return;if(null===this.Lp)return;if(t>1&&this.sv(),null!==this.gp&&this.gp.cp(t),null!==this.Mp&&this.Mp.cp(t),1!==t){const t=ws(this.Xf.canvas);t.save(),this.fp(t,this.Xf.pixelRatio),this.Lp&&(this.nv(t,this.Xf.pixelRatio),this.ev(t,this.Xf.pixelRatio),this.rv(t,this.Xf.pixelRatio,Is),this.rv(t,this.Xf.pixelRatio,Vs)),t.restore()}const i=ws(this.Zf.canvas);i.clearRect(0,0,Math.ceil(this.Vf.It*this.Zf.pixelRatio),Math.ceil(this.Vf.Vt*this.Zf.pixelRatio)),this.rv(i,this.Xf.pixelRatio,Fs),this.hv(i,this.Zf.pixelRatio)}lv(){return this.gp}av(){return this.Mp}Ap(){null!==this.Lp&&this.Lp.Yo().v(this),this.Lp=null}qp(t){const i=t.Tf,s=t.Df;this.kp.g()&&this.kp.m(this.$i().yt().nu(i),{x:i,y:s})}fp(t,i){V(t,i,(()=>{const i=this.$i(),s=i.U(),n=i.Ec();s===n?F(t,0,0,this.Vf.It,this.Vf.Vt,n):$(t,0,0,this.Vf.It,this.Vf.Vt,s,n)}))}nv(t,i){const s=h(this.Lp),n=s.Xo().Dh().gt(s.Zt(),s.Xt());null!==n&&(t.save(),n.X(t,i,!1),t.restore())}ev(t,i){const s=this.$i()._c();this.ov(t,i,Is,Ns,s),this.ov(t,i,Is,Bs,s)}hv(t,i){this.ov(t,i,Is,Bs,this.$i().uc())}rv(t,i,s){const n=h(this.Lp).Ga();for(const e of n)this.ov(t,i,s,Ns,e);for(const e of n)this.ov(t,i,s,Bs,e)}ov(t,i,s,n,e){const r=h(this.Lp),l=s(e,r),a=r.Zt(),o=r.Xt(),_=r.Ut().ec(),u=null!==_&&_.hc===e,c=null!==_&&u&&void 0!==_.Up?_.Up.Ir:void 0;for(const s of l){const e=s.gt(a,o);null!==e&&(t.save(),n(e,t,i,u,c),t.restore())}}Qp(t,i,s){for(const n of t){const t=n.gt(this.Vf.Vt,this.Vf.It);if(null!==t&&t.Br){const e=t.Br(i,s);if(null!==e)return{Bf:n,Up:e}}}return null}Wp(){if(null===this.Lp)return;const t=this.Op,i=this.Lp.No().F().visible,s=this.Lp.Bo().F().visible;i||null===this.gp||(this.Np.removeChild(this.gp.ep()),this.gp.M(),this.gp=null),s||null===this.Mp||(this.Bp.removeChild(this.Mp.ep()),this.Mp.M(),this.Mp=null);const n=t.Ut().Dc();i&&null===this.gp&&(this.gp=new Es(this,t.F(),n,"left"),this.Np.appendChild(this.gp.ep())),s&&null===this.Mp&&(this.Mp=new Es(this,t.F(),n,"right"),this.Bp.appendChild(this.Mp.ep()))}_v(t){return t.Af&&this.xp||null!==this.Tp}uv(t){return Math.max(0,Math.min(t,this.Vf.It-1))}cv(t){return Math.max(0,Math.min(t,this.Vf.Vt-1))}$p(t,i){this.$i().kc(this.uv(t),this.cv(i),h(this.Lp))}Kp(){this.$i().xc()}Jp(){this.Dp&&(this.Tp=null,this.Kp())}Zp(t,i){this.Tp=t,this.Dp=!1,this.$p(i.x,i.y);const s=this.$i().uc();this.Pp={x:s.Kt(),y:s.Gt()}}$i(){return this.Op.Ut()}dv(t,i,s){if(this.Lp)if(s){const s=t,n=i;this.fv(s,n)}else this.Lp.Ut().rc(null),this.Kp()}fv(t,i){this.$i().Cc(this.uv(t),this.cv(i),!1,h(this.Lp))}Xp(t){if(!this.yp)return;const i=this.$i(),s=this.up();if(i.jo(s,s.fs()),this.Sp=null,this.yp=!1,i.Mc(),null!==this.Rp){const t=performance.now(),s=i.yt();this.Rp.cr(s.lu(),t),this.Rp.bu(t)||i.Xs(this.Rp)}}jp(){this.Tp=null}Hp(){if(!this.Lp)return;if(this.$i().Us(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)h(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.Lp.fs().Fi()&&this.$i().yt().Fi()}Yp(t){if(null===this.Lp)return;const i=this.$i(),s=i.yt();if(s.Fi())return;const n=this.Op.F(),e=n.handleScroll,r=n.kineticScroll;if((!e.pressedMouseMove||t.Af)&&(!e.horzTouchDrag&&!e.vertTouchDrag||!t.Af))return;const h=this.Lp.fs(),l=performance.now();if(null!==this.Sp||this._v(t)||(this.Sp={x:t.Mf,y:t.Sf,o_:l,Tf:t.Tf,Df:t.Df}),null!==this.Sp&&!this.yp&&(this.Sp.x!==t.Mf||this.Sp.y!==t.Sf)){if(t.Af&&r.touch||!t.Af&&r.mouse){const t=s.Kn();this.Rp=new ys(.2/t,7/t,.997,15/t),this.Rp.Yc(s.lu(),this.Sp.o_)}else this.Rp=null;h.Fi()||i.Wo(this.Lp,h,t.Df),i.wc(t.Tf),this.yp=!0}this.yp&&(h.Fi()||i.zo(this.Lp,h,t.Df),i.gc(t.Tf),null!==this.Rp&&this.Rp.Yc(s.lu(),l))}}class zs{constructor(t,i,s,n,e){this.ft=!0,this.Vf=new ms(0,0),this.$f=()=>this.cp(3),this.qf="left"===t,this.Zu=s.Dc,this.us=i,this.pv=n,this.vv=e,this.Yf=document.createElement("div"),this.Yf.style.width="25px",this.Yf.style.height="100%",this.Yf.style.overflow="hidden",this.Xf=gs(this.Yf,new ms(16,16)),this.Xf.subscribeCanvasConfigured(this.$f)}M(){this.Xf.unsubscribeCanvasConfigured(this.$f),this.Xf.destroy()}ep(){return this.Yf}iv(){return this.Vf}op(t){if(t.It<0||t.Vt<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.Vf.hh(t)||(this.Vf=t,this.Xf.resizeCanvas({width:t.It,height:t.Vt}),this.Yf.style.width=`${t.It}px`,this.Yf.style.minWidth=`${t.It}px`,this.Yf.style.height=`${t.Vt}px`,this.ft=!0)}cp(t){if(t<3&&!this.ft)return;if(0===this.Vf.It||0===this.Vf.Vt)return;this.ft=!1;const i=ws(this.Xf.canvas);this.fp(i,this.Xf.pixelRatio),this.ke(i,this.Xf.pixelRatio)}bp(){return this.Xf.canvas}ke(t,i){if(!this.pv())return;const s=this.Vf.It;t.save(),t.fillStyle=this.us.timeScale.borderColor;const n=Math.floor(this.Zu.F().k*i),e=this.qf?Math.round(s*i)-n:0;t.fillRect(e,0,n,n),t.restore()}fp(t,i){V(t,i,(()=>{F(t,0,0,this.Vf.It,this.Vf.Vt,this.vv())}))}}function js(t,i){return t.b_>i.b_?t:i}class $s{constructor(t){this.mv=null,this.bv=null,this.S=null,this.wv=!1,this.Vf=new ms(0,0),this.gv=new m,this.Wf=new Wt(5),this.jf=!1,this.$f=()=>{this.jf||this.Op.Ut().Th()},this.Uf=()=>{this.jf||this.Op.Ut().Th()},this.Op=t,this.us=t.F().layout,this.Mv=document.createElement("tr"),this.Sv=document.createElement("td"),this.Sv.style.padding="0",this.yv=document.createElement("td"),this.yv.style.padding="0",this.Yf=document.createElement("td"),this.Yf.style.height="25px",this.Yf.style.padding="0",this.kv=document.createElement("div"),this.kv.style.width="100%",this.kv.style.height="100%",this.kv.style.position="relative",this.kv.style.overflow="hidden",this.Yf.appendChild(this.kv),this.Xf=gs(this.kv,new ms(16,16)),this.Xf.subscribeCanvasConfigured(this.$f);const i=this.Xf.canvas;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.Zf=gs(this.kv,new ms(16,16)),this.Zf.subscribeCanvasConfigured(this.Uf);const s=this.Zf.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.Mv.appendChild(this.Sv),this.Mv.appendChild(this.Yf),this.Mv.appendChild(this.yv),this.Cv(),this.Op.Ut().xo().l(this.Cv.bind(this),this),this.np=new Ds(this.Zf.canvas,this,{Xd:()=>!0,Zd:()=>!1})}M(){this.np.M(),null!==this.mv&&this.mv.M(),null!==this.bv&&this.bv.M(),this.Zf.unsubscribeCanvasConfigured(this.Uf),this.Zf.destroy(),this.Xf.unsubscribeCanvasConfigured(this.$f),this.Xf.destroy()}ep(){return this.Mv}xv(){return this.mv}Tv(){return this.bv}af(t){if(this.wv)return;this.wv=!0;const i=this.Op.Ut();!i.yt().Fi()&&this.Op.F().handleScale.axisPressedMouseMove.time&&i.vc(t.Tf)}hf(t){this.af(t)}_f(){const t=this.Op.Ut();!t.yt().Fi()&&this.wv&&(this.wv=!1,this.Op.F().handleScale.axisPressedMouseMove.time&&t.yc())}Jd(t){const i=this.Op.Ut();!i.yt().Fi()&&this.Op.F().handleScale.axisPressedMouseMove.time&&i.Sc(t.Tf)}Kd(t){this.Jd(t)}sf(){this.wv=!1;const t=this.Op.Ut();t.yt().Fi()&&!this.Op.F().handleScale.axisPressedMouseMove.time||t.yc()}tf(){this.sf()}Bd(){this.Op.F().handleScale.axisDoubleClickReset.time&&this.Op.Ut().Ks()}Od(){this.Bd()}$d(){this.Op.Ut().F().handleScale.axisPressedMouseMove.time&&this.wp(1)}wf(){this.wp(0)}iv(){return this.Vf}Dv(){return this.gv}Pv(t,i,s){this.Vf&&this.Vf.hh(t)||(this.Vf=t,this.jf=!0,this.Xf.resizeCanvas({width:t.It,height:t.Vt}),this.Zf.resizeCanvas({width:t.It,height:t.Vt}),this.jf=!1,this.Yf.style.width=t.It+"px",this.Yf.style.height=t.Vt+"px",this.gv.m(t)),null!==this.mv&&this.mv.op(new ms(i,t.Vt)),null!==this.bv&&this.bv.op(new ms(s,t.Vt))}Rv(){const t=this.Lv();return Math.ceil(t.k+t.C+t.T+t.B+t.O+t.Ov)}bt(){this.Op.Ut().yt().Gl()}bp(){return this.Xf.canvas}cp(t){if(0===t)return;if(1!==t){const i=ws(this.Xf.canvas);this.fp(i,this.Xf.pixelRatio),this.ke(i,this.Xf.pixelRatio),this.pp(i,this.Xf.pixelRatio),null!==this.mv&&this.mv.cp(t),null!==this.bv&&this.bv.cp(t)}const i=ws(this.Zf.canvas),s=this.Zf.pixelRatio;i.clearRect(0,0,Math.ceil(this.Vf.It*s),Math.ceil(this.Vf.Vt*s)),this.Av([this.Op.Ut().uc()],i,s)}fp(t,i){V(t,i,(()=>{F(t,0,0,this.Vf.It,this.Vf.Vt,this.Op.Ut().Ec())}))}ke(t,i){if(this.Op.F().timeScale.borderVisible){t.save(),t.fillStyle=this.Ev();const s=Math.max(1,Math.floor(this.Lv().k*i));t.fillRect(0,0,Math.ceil(this.Vf.It*i),s),t.restore()}}pp(t,i){const s=this.Op.Ut().yt(),n=s.Gl();if(!n||0===n.length)return;let e=n.reduce(js,n[0]).b_;e>30&&e<50&&(e=30),t.save(),t.strokeStyle=this.Ev();const r=this.Lv(),h=r.k+r.C+r.B+r.T/2;t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.Ev();const l=Math.max(1,Math.floor(i)),a=Math.floor(.5*i),o=s.F();if(o.borderVisible&&o.ticksVisible){t.beginPath();const s=Math.round(r.C*i);for(let e=n.length;e--;){const r=Math.round(n[e].ql*i);t.rect(r-a,0,l,s)}t.fill()}t.fillStyle=this.$(),V(t,i,(()=>{t.font=this.lp();for(const i of n)if(i.b_<e){const s=i._u?this.Nv(t,i.ql,i._a):i.ql;t.fillText(i._a,s,h)}t.font=this.Bv();for(const i of n)if(i.b_>=e){const s=i._u?this.Nv(t,i.ql,i._a):i.ql;t.fillText(i._a,s,h)}})),t.restore()}Nv(t,i,s){const n=this.Wf.Mi(t,s),e=n/2,r=Math.floor(i-e)+.5;return r<0?i+=Math.abs(0-r):r+n>this.Vf.It&&(i-=Math.abs(this.Vf.It-(r+n))),i}Av(t,i,s){const n=this.Lv();for(const e of t)for(const t of e.Ji())i.save(),t.gt().X(i,n,s),i.restore()}Ev(){return this.Op.F().timeScale.borderColor}$(){return this.us.textColor}W(){return this.us.fontSize}lp(){return T(this.W(),this.us.fontFamily)}Bv(){return T(this.W(),this.us.fontFamily,"bold")}Lv(){null===this.S&&(this.S={k:1,I:NaN,B:NaN,O:NaN,ji:NaN,C:5,T:NaN,D:"",zi:new Wt,Ov:0});const t=this.S,i=this.lp();if(t.D!==i){const s=this.W();t.T=s,t.D=i,t.B=3*s/12,t.O=3*s/12,t.ji=9*s/12,t.I=0,t.Ov=4*s/12,t.zi.We()}return this.S}wp(t){this.Yf.style.cursor=1===t?"ew-resize":"default"}Cv(){const t=this.Op.Ut(),i=t.F();i.leftPriceScale.visible||null===this.mv||(this.Sv.removeChild(this.mv.ep()),this.mv.M(),this.mv=null),i.rightPriceScale.visible||null===this.bv||(this.yv.removeChild(this.bv.ep()),this.bv.M(),this.bv=null);const s={Dc:this.Op.Ut().Dc()},n=()=>i.leftPriceScale.borderVisible&&t.yt().F().borderVisible,e=()=>t.Ec();i.leftPriceScale.visible&&null===this.mv&&(this.mv=new zs("left",i,s,n,e),this.Sv.appendChild(this.mv.ep())),i.rightPriceScale.visible&&null===this.bv&&(this.bv=new zs("right",i,s,n,e),this.yv.appendChild(this.bv.ep()))}}class Hs{constructor(t,i){var s;this.Iv=[],this.Vv=0,this.da=0,this.qe=0,this.Fv=0,this.Wv=0,this.zv=null,this.jv=!1,this.kp=new m,this.qu=new m,this.us=i,this.Mv=document.createElement("div"),this.Mv.classList.add("tv-lightweight-charts"),this.Mv.style.overflow="hidden",this.Mv.style.width="100%",this.Mv.style.height="100%",(s=this.Mv).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.$v=document.createElement("table"),this.$v.setAttribute("cellspacing","0"),this.Mv.appendChild(this.$v),this.Hv=this.Uv.bind(this),Us(this.us)&&this.qv(!0),this.$i=new cs(this.Xu.bind(this),this.us),this.Ut().cc().l(this.Yv.bind(this),this),this.Xv=new $s(this),this.$v.appendChild(this.Xv.ep());let n=this.us.width,e=this.us.height;if(0===n||0===e){const i=t.getBoundingClientRect();0===n&&(n=Math.floor(i.width),n-=n%2),0===e&&(e=Math.floor(i.height),e-=e%2)}this.Zv(n,e),this.Kv(),t.appendChild(this.Mv),this.Gv(),this.$i.yt().Su().l(this.$i.fl.bind(this.$i),this),this.$i.xo().l(this.$i.fl.bind(this.$i),this)}Ut(){return this.$i}F(){return this.us}Jv(){return this.Iv}Qv(){return this.Xv}M(){this.qv(!1),0!==this.Vv&&window.cancelAnimationFrame(this.Vv),this.$i.cc().v(this),this.$i.yt().Su().v(this),this.$i.xo().v(this),this.$i.M();for(const t of this.Iv)this.$v.removeChild(t.ep()),t.Gp().v(this),t.M();this.Iv=[],h(this.Xv).M(),null!==this.Mv.parentElement&&this.Mv.parentElement.removeChild(this.Mv),this.qu.M(),this.kp.M()}Zv(t,i,s=!1){if(this.da===i&&this.qe===t)return;this.da=i,this.qe=t;const n=i+"px",e=t+"px";h(this.Mv).style.height=n,h(this.Mv).style.width=e,this.$v.style.height=n,this.$v.style.width=e,s?this.tm(tt.en(),performance.now()):this.$i.fl()}cp(t){void 0===t&&(t=tt.en());for(let i=0;i<this.Iv.length;i++)this.Iv[i].cp(t.$s(i).Ws);this.us.timeScale.visible&&this.Xv.cp(t.js())}xh(t){const i=Us(this.us);this.$i.xh(t);const s=Us(this.us);s!==i&&this.qv(s),this.Gv();const n=t.width||this.qe,e=t.height||this.da;this.Zv(n,e)}Gp(){return this.kp}cc(){return this.qu}im(){null!==this.zv&&(this.tm(this.zv,performance.now()),this.zv=null);const t=this.Iv[0],i=function(t,i){const s=t.createElement("canvas"),n=bs(s);return s.style.width=`${i.It}px`,s.style.height=`${i.Vt}px`,s.width=i.It*n,s.height=i.Vt*n,s}(document,new ms(this.qe,this.da)),s=ws(i),n=bs(i);return V(s,n,(()=>{let i=0,n=0;const e=t=>{for(let e=0;e<this.Iv.length;e++){const r=this.Iv[e],l=r.iv().Vt,a=h("left"===t?r.lv():r.av()),o=a.bp();s.drawImage(o,i,n,a._p(),l),n+=l}};this.sm()&&(e("left"),i=h(t.lv())._p()),n=0;for(let t=0;t<this.Iv.length;t++){const e=this.Iv[t],r=e.iv(),h=e.bp();s.drawImage(h,i,n,r.It,r.Vt),n+=r.Vt}i+=t.iv().It,this.nm()&&(n=0,e("right"));const r=t=>{const e=h("left"===t?this.Xv.xv():this.Xv.Tv()),r=e.iv(),l=e.bp();s.drawImage(l,i,n,r.It,r.Vt)};if(this.us.timeScale.visible){i=0,this.sm()&&(r("left"),i=h(t.lv())._p());const e=this.Xv.iv(),l=this.Xv.bp();s.drawImage(l,i,n,e.It,e.Vt),this.nm()&&(i+=t.iv().It,r("right"),s.restore())}})),i}rm(t){if("left"===t&&!this.sm())return 0;if("right"===t&&!this.nm())return 0;if(0===this.Iv.length)return 0;return h("left"===t?this.Iv[0].lv():this.Iv[0].av())._p()}hm(){let t=0,i=0,s=0;for(const n of this.Iv)this.sm()&&(i=Math.max(i,h(n.lv()).hp())),this.nm()&&(s=Math.max(s,h(n.av()).hp())),t+=n.To();const n=this.qe,e=this.da,r=Math.max(n-i-s,0),l=this.us.timeScale.visible;let a=l?this.Xv.Rv():0;a%2&&(a+=1);const o=0+a,_=e<o?0:e-o,u=_/t;let c=0;for(let t=0;t<this.Iv.length;++t){const n=this.Iv[t];n.Fp(this.$i.oc()[t]);let e=0,h=0;h=t===this.Iv.length-1?_-c:Math.round(n.To()*u),e=Math.max(h,2),c+=e,n.op(new ms(r,e)),this.sm()&&n.tv(i,"left"),this.nm()&&n.tv(s,"right"),n.up()&&this.$i.dc(n.up(),e)}this.Xv.Pv(new ms(l?r:0,a),l?i:0,l?s:0),this.$i.Po(r),this.Fv!==i&&(this.Fv=i),this.Wv!==s&&(this.Wv=s)}qv(t){t?this.Mv.addEventListener("wheel",this.Hv,{passive:!1}):this.Mv.removeEventListener("wheel",this.Hv)}Uv(t){let i=t.deltaX/100,s=-t.deltaY/100;if(0!==i&&this.us.handleScroll.mouseWheel||0!==s&&this.us.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,s*=120;break;case t.DOM_DELTA_LINE:i*=32,s*=32}if(0!==s&&this.us.handleScale.mouseWheel){const i=Math.sign(s)*Math.min(1,Math.abs(s)),n=t.clientX-this.Mv.getBoundingClientRect().left;this.Ut().mc(n,i)}0!==i&&this.us.handleScroll.mouseWheel&&this.Ut().bc(-80*i)}}tm(t,i){var s;const n=t.js();3===n&&this.lm(),3!==n&&2!==n||(this.am(t),this.om(t,i),this.Xv.bt(),this.Iv.forEach((t=>{t.zp()})),3===(null===(s=this.zv)||void 0===s?void 0:s.js())&&(this.zv.tn(t),this.lm(),this.am(this.zv),this.om(this.zv,i),t=this.zv,this.zv=null)),this.cp(t)}om(t,i){for(const s of t.Qs())this.sn(s,i)}am(t){const i=this.$i.oc();for(let s=0;s<i.length;s++)t.$s(s).zs&&i[s].Uo()}sn(t,i){const s=this.$i.yt();switch(t.qs){case 0:s.ku();break;case 1:s.Cu(t.Rt);break;case 2:s.Gs(t.Rt);break;case 3:s.Js(t.Rt);break;case 4:s.uu();break;case 5:t.Rt.bu(i)||s.Js(t.Rt.wu(i))}}Xu(t){null!==this.zv?this.zv.tn(t):this.zv=t,this.jv||(this.jv=!0,this.Vv=window.requestAnimationFrame((t=>{if(this.jv=!1,this.Vv=0,null!==this.zv){const i=this.zv;this.zv=null,this.tm(i,t);for(const s of i.Qs())if(5===s.qs&&!s.Rt.bu(t)){this.Ut().Xs(s.Rt);break}}})))}lm(){this.Kv()}Kv(){const t=this.$i.oc(),i=t.length,s=this.Iv.length;for(let t=i;t<s;t++){const t=r(this.Iv.pop());this.$v.removeChild(t.ep()),t.Gp().v(this),t.M()}for(let n=s;n<i;n++){const i=new Ws(this,t[n]);i.Gp().l(this._m.bind(this),this),this.Iv.push(i),this.$v.insertBefore(i.ep(),this.Xv.ep())}for(let s=0;s<i;s++){const i=t[s],n=this.Iv[s];n.up()!==i?n.Fp(i):n.Vp()}this.Gv(),this.hm()}um(t,i){var s;const n=new Map;if(null!==t){this.$i.wt().forEach((i=>{const s=i.Ns().$h(t);null!==s&&n.set(i,s)}))}let e;if(null!==t){const i=null===(s=this.$i.yt().Hi(t))||void 0===s?void 0:s.w_;void 0!==i&&(e=i)}const r=this.Ut().ec(),h=null!==r&&r.hc instanceof yi?r.hc:void 0,l=null!==r&&void 0!==r.Up?r.Up.Fr:void 0;return{ot:e,Yn:null!=t?t:void 0,dm:null!=i?i:void 0,fm:h,pm:n,vm:l}}_m(t,i){this.kp.m((()=>this.um(t,i)))}Yv(t,i){this.qu.m((()=>this.um(t,i)))}Gv(){const t=this.us.timeScale.visible?"":"none";this.Xv.ep().style.display=t}sm(){return this.Iv[0].up().No().F().visible}nm(){return this.Iv[0].up().Bo().F().visible}}function Us(t){return Boolean(t.handleScroll.mouseWheel||t.handleScale.mouseWheel)}function qs(t,i,s,n){const e=s.value,r={Yn:i,ot:t,Rt:[e,e,e,e],w_:n};return void 0!==s.color&&(r.R=s.color),r}function Ys(t){return void 0!==t.Rt}function Xs(t){return(i,s,n,e)=>{return void 0===(r=n).open&&void 0===r.value?{ot:i,Yn:s,w_:e}:t(i,s,n,e);var r}}const Zs={Candlestick:Xs((function(t,i,s,n){const e={Yn:i,ot:t,Rt:[s.open,s.high,s.low,s.close],w_:n};return void 0!==s.color&&(e.R=s.color),void 0!==s.borderColor&&(e.Lt=s.borderColor),void 0!==s.wickColor&&(e.Lh=s.wickColor),e})),Bar:Xs((function(t,i,s,n){const e={Yn:i,ot:t,Rt:[s.open,s.high,s.low,s.close],w_:n};return void 0!==s.color&&(e.R=s.color),e})),Area:Xs((function(t,i,s,n){const e=s.value,r={Yn:i,ot:t,Rt:[e,e,e,e],w_:n};return void 0!==s.lineColor&&(r.lt=s.lineColor),void 0!==s.topColor&&(r.vn=s.topColor),void 0!==s.bottomColor&&(r.mn=s.bottomColor),r})),Baseline:Xs((function(t,i,s,n){const e=s.value,r={Yn:i,ot:t,Rt:[e,e,e,e],w_:n};return void 0!==s.topLineColor&&(r.be=s.topLineColor),void 0!==s.bottomLineColor&&(r.we=s.bottomLineColor),void 0!==s.topFillColor1&&(r.de=s.topFillColor1),void 0!==s.topFillColor2&&(r.fe=s.topFillColor2),void 0!==s.bottomFillColor1&&(r.pe=s.bottomFillColor1),void 0!==s.bottomFillColor2&&(r.ve=s.bottomFillColor2),r})),Histogram:Xs(qs),Line:Xs(qs)};function Ks(t){return Zs[t]}function Gs(t){return 60*t*60*1e3}function Js(t){return 60*t*1e3}const Qs=[{bm:(tn=1,1e3*tn),b_:10},{bm:Js(1),b_:20},{bm:Js(5),b_:21},{bm:Js(30),b_:22},{bm:Gs(1),b_:30},{bm:Gs(3),b_:31},{bm:Gs(6),b_:32},{bm:Gs(12),b_:33}];var tn;function sn(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let s=Qs.length-1;s>=0;--s)if(Math.floor(i.getTime()/Qs[s].bm)!==Math.floor(t.getTime()/Qs[s].bm))return Qs[s].b_;return 0}function nn(t,i=0){if(0===t.length)return;let s=0===i?null:t[i-1].ot.o_,n=null!==s?new Date(1e3*s):null,e=0;for(let r=i;r<t.length;++r){const i=t[r],h=new Date(1e3*i.ot.o_);null!==n&&(i.m_=sn(h,n)),e+=i.ot.o_-(s||i.ot.o_),s=i.ot.o_,n=h}if(0===i&&t.length>1){const i=Math.ceil(e/(t.length-1)),s=new Date(1e3*(t[0].ot.o_-i));t[0].m_=sn(new Date(1e3*t[0].ot.o_),s)}}function en(t){if(!ds(t))throw new Error("time must be of type BusinessDay");const i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{o_:Math.round(i.getTime()/1e3),a_:t}}function rn(t){if(!fs(t))throw new Error("time must be of type isUTCTimestamp");return{o_:t}}function hn(t){return 0===t.length?null:ds(t[0].time)?en:rn}function ln(t){return fs(t)?rn(t):ds(t)?en(t):en(an(t))}function an(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function on(t){M(t.time)&&(t.time=an(t.time))}function _n(t){return{Yn:0,wm:new Map,Cl:t}}function un(t){if(void 0!==t&&0!==t.length)return{gm:t[0].ot.o_,Mm:t[t.length-1].ot.o_}}function cn(t){let i;return t.forEach((t=>{void 0===i&&(i=t.w_)})),r(i)}function dn(t){void 0===t.w_&&(t.w_=t.time)}class fn{constructor(){this.Sm=new Map,this.ym=new Map,this.km=new Map,this.Cm=[]}M(){this.Sm.clear(),this.ym.clear(),this.km.clear(),this.Cm=[]}xm(t,i){let s=0!==this.Sm.size,n=!1;const e=this.ym.get(t);if(void 0!==e)if(1===this.ym.size)s=!1,n=!0,this.Sm.clear();else for(const i of this.Cm)i.pointData.wm.delete(t)&&(n=!0);let r=[];if(0!==i.length){const s=i;s.forEach((t=>dn(t))),function(t){t.forEach(on)}(i);const e=h(hn(i)),l=Ks(t.Nh());r=s.map((i=>{const s=e(i.time);let r=this.Sm.get(s.o_);void 0===r&&(r=_n(s),this.Sm.set(s.o_,r),n=!0);const h=l(s,r.Yn,i,i.w_);return r.wm.set(t,h),h}))}s&&this.Tm(),this.Dm(t,r);let l=-1;if(n){const t=[];this.Sm.forEach((i=>{t.push({m_:0,ot:i.Cl,pointData:i,w_:cn(i.wm)})})),t.sort(((t,i)=>t.ot.o_-i.ot.o_)),l=this.Pm(t)}return this.Rm(t,l,function(t,i){const s=un(t),n=un(i);if(void 0!==s&&void 0!==n)return{bl:s.Mm>=n.Mm&&s.gm>=n.gm}}(this.ym.get(t),e))}Lc(t){return this.xm(t,[])}Lm(t,i){const s=i;dn(s),on(i);const n=h(hn([i]))(i.time),e=this.km.get(t);if(void 0!==e&&n.o_<e.o_)throw new Error(`Cannot update oldest data, last time=${e.o_}, new time=${n.o_}`);let r=this.Sm.get(n.o_);const l=void 0===r;void 0===r&&(r=_n(n),this.Sm.set(n.o_,r));const a=Ks(t.Nh())(n,r.Yn,i,s.w_);r.wm.set(t,a),this.Om(t,a);const o={bl:Ys(a)};if(!l)return this.Rm(t,-1,o);const _={m_:0,ot:r.Cl,pointData:r,w_:cn(r.wm)},u=vt(this.Cm,_.ot.o_,((t,i)=>t.ot.o_<i));this.Cm.splice(u,0,_);for(let t=u;t<this.Cm.length;++t)pn(this.Cm[t].pointData,t);return nn(this.Cm,u),this.Rm(t,u,o)}Om(t,i){let s=this.ym.get(t);void 0===s&&(s=[],this.ym.set(t,s));const n=0!==s.length?s[s.length-1]:null;null===n||i.ot.o_>n.ot.o_?Ys(i)&&s.push(i):Ys(i)?s[s.length-1]=i:s.splice(-1,1),this.km.set(t,i.ot)}Dm(t,i){0!==i.length?(this.ym.set(t,i.filter(Ys)),this.km.set(t,i[i.length-1].ot)):(this.ym.delete(t),this.km.delete(t))}Tm(){for(const t of this.Cm)0===t.pointData.wm.size&&this.Sm.delete(t.ot.o_)}Pm(t){let i=-1;for(let s=0;s<this.Cm.length&&s<t.length;++s){const n=this.Cm[s],e=t[s];if(n.ot.o_!==e.ot.o_){i=s;break}e.m_=n.m_,pn(e.pointData,s)}if(-1===i&&this.Cm.length!==t.length&&(i=Math.min(this.Cm.length,t.length)),-1===i)return-1;for(let s=i;s<t.length;++s)pn(t[s].pointData,s);return nn(t,i),this.Cm=t,i}Am(){if(0===this.ym.size)return null;let t=0;return this.ym.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].Yn))})),t}Rm(t,i,s){const n={Em:new Map,yt:{su:this.Am()}};if(-1!==i)this.ym.forEach(((i,e)=>{n.Em.set(e,{hr:i,Nm:e===t?s:void 0})})),this.ym.has(t)||n.Em.set(t,{hr:[],Nm:s}),n.yt.Bm=this.Cm,n.yt.Im=i;else{const i=this.ym.get(t);n.Em.set(t,{hr:i||[],Nm:s})}return n}}function pn(t,i){t.Yn=i,t.wm.forEach((t=>{t.Yn=i}))}function vn(t){return{value:t.Rt[3],time:t.w_}}function mn(t){const i=vn(t);return void 0!==t.R&&(i.color=t.R),i}function bn(t){return{open:t.Rt[0],high:t.Rt[1],low:t.Rt[2],close:t.Rt[3],time:t.w_}}const wn={Area:function(t){const i=vn(t);return void 0!==t.lt&&(i.lineColor=t.lt),void 0!==t.vn&&(i.topColor=t.vn),void 0!==t.mn&&(i.bottomColor=t.mn),i},Line:mn,Baseline:function(t){const i=vn(t);return void 0!==t.be&&(i.topLineColor=t.be),void 0!==t.we&&(i.bottomLineColor=t.we),void 0!==t.de&&(i.topFillColor1=t.de),void 0!==t.fe&&(i.topFillColor2=t.fe),void 0!==t.pe&&(i.bottomFillColor1=t.pe),void 0!==t.ve&&(i.bottomFillColor2=t.ve),i},Histogram:mn,Bar:function(t){const i=bn(t);return void 0!==t.R&&(i.color=t.R),i},Candlestick:function(t){const i=bn(t),{R:s,Lt:n,Lh:e}=t;return void 0!==s&&(i.color=s),void 0!==n&&(i.borderColor=n),void 0!==e&&(i.wickColor=e),i}};function gn(t){return wn[t]}const Mn={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2}},Sn={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:x,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},yn={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:x},crosshair:{vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},Mn),leftPriceScale:Object.assign(Object.assign({},Mn),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},Mn),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,ticksVisible:!1},watermark:Sn,localization:{locale:ks?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},kn={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Cn={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},xn={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Tn={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Dn={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Pn={color:"#26a69a",base:0},Rn={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class Ln{constructor(t,i){this.Vm=t,this.Fm=i}applyOptions(t){this.Vm.Ut().lc(this.Fm,t)}options(){return this.Ii().F()}width(){return Q(this.Fm)?this.Vm.rm(this.Fm):0}Ii(){return h(this.Vm.Ut().ac(this.Fm)).Pt}}const On={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:""};class An{constructor(t){this.Mh=t}applyOptions(t){this.Mh.xh(t)}options(){return this.Mh.F()}Wm(){return this.Mh}}class En{constructor(t,i,s){this.Tn=t,this.zm=i,this.jm=s}priceFormatter(){return this.Tn.Ol()}priceToCoordinate(t){const i=this.Tn.xt();return null===i?null:this.Tn.Pt().Dt(t,i.Rt)}coordinateToPrice(t){const i=this.Tn.xt();return null===i?null:this.Tn.Pt().ps(t,i.Rt)}barsInLogicalRange(t){if(null===t)return null;const i=new ss(new Qi(t.from,t.to)).k_(),s=this.Tn.Ns();if(s.Fi())return null;const n=s.$h(i.gn(),1),e=s.$h(i.Mn(),-1),r=h(s.Wh()),l=h(s.Es());if(null!==n&&null!==e&&n.Yn>e.Yn)return{barsBefore:t.from-r,barsAfter:l-t.to};const a={barsBefore:null===n||n.Yn===r?t.from-r:n.Yn-r,barsAfter:null===e||e.Yn===l?l-t.to:l-e.Yn};return null!==n&&null!==e&&(a.from=n.ot.a_||n.ot.o_,a.to=e.ot.a_||e.ot.o_),a}setData(t){this.Tn.Nh(),this.zm.$m(this.Tn,t)}update(t){this.Tn.Nh(),this.zm.Hm(this.Tn,t)}dataByIndex(t,i){const s=this.Tn.Ns().$h(t,i);return null===s?null:gn(this.seriesType())(s)}setMarkers(t){const i=t.map((t=>Object.assign(Object.assign({},t),{originalTime:t.time,time:ln(t.time)})));this.Tn.gl(i)}markers(){return this.Tn.Ml().map((t=>{const{originalTime:i,time:s}=t,n=function(t,i){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&i.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(n=Object.getOwnPropertySymbols(t);e<n.length;e++)i.indexOf(n[e])<0&&Object.prototype.propertyIsEnumerable.call(t,n[e])&&(s[n[e]]=t[n[e]])}return s}(t,["originalTime","time"]);return Object.assign({time:i},n)}))}applyOptions(t){this.Tn.xh(t)}options(){return y(this.Tn.F())}priceScale(){return this.jm.priceScale(this.Tn.Pt().Il())}createPriceLine(t){const i=b(y(On),t),s=this.Tn.Sl(i);return new An(s)}removePriceLine(t){this.Tn.yl(t.Wm())}seriesType(){return this.Tn.Nh()}}class Nn{constructor(t,i){this.Um=new m,this.E_=new m,this.gv=new m,this.$i=t,this.mo=t.yt(),this.Xv=i,this.mo.gu().l(this.qm.bind(this)),this.mo.Mu().l(this.Ym.bind(this)),this.Xv.Dv().l(this.Xm.bind(this))}M(){this.mo.gu().v(this),this.mo.Mu().v(this),this.Xv.Dv().v(this),this.Um.M(),this.E_.M(),this.gv.M()}scrollPosition(){return this.mo.lu()}scrollToPosition(t,i){i?this.mo.mu(t,1e3):this.$i.Js(t)}scrollToRealTime(){this.mo.vu()}getVisibleRange(){var t,i;const s=this.mo.Z_();return null===s?null:{from:null!==(t=s.from.a_)&&void 0!==t?t:s.from.o_,to:null!==(i=s.to.a_)&&void 0!==i?i:s.to.o_}}setVisibleRange(t){const i={from:ln(t.from),to:ln(t.to)},s=this.mo.Q_(i);this.$i.Oc(s)}getVisibleLogicalRange(){const t=this.mo.X_();return null===t?null:{from:t.gn(),to:t.Mn()}}setVisibleLogicalRange(t){e(t.from<=t.to,"The from index cannot be after the to index."),this.$i.Oc(t)}resetTimeScale(){this.$i.Ks()}fitContent(){this.$i.ku()}logicalToCoordinate(t){const i=this.$i.yt();return i.Fi()?null:i.At(t)}coordinateToLogical(t){return this.mo.Fi()?null:this.mo.nu(t)}timeToCoordinate(t){const i=ln(t),s=this.mo.Fl(i,!1);return null===s?null:this.mo.At(s)}coordinateToTime(t){var i;const s=this.$i.yt(),n=s.nu(t),e=s.vs(n);return null===e?null:null!==(i=e.a_)&&void 0!==i?i:e.o_}width(){return this.Xv.iv().It}height(){return this.Xv.iv().Vt}subscribeVisibleTimeRangeChange(t){this.Um.l(t)}unsubscribeVisibleTimeRangeChange(t){this.Um.p(t)}subscribeVisibleLogicalRangeChange(t){this.E_.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.E_.p(t)}subscribeSizeChange(t){this.gv.l(t)}unsubscribeSizeChange(t){this.gv.p(t)}applyOptions(t){this.mo.xh(t)}options(){return y(this.mo.F())}qm(){this.Um.g()&&this.Um.m(this.getVisibleRange())}Ym(){this.E_.g()&&this.E_.m(this.getVisibleLogicalRange())}Xm(t){this.gv.m(t.It,t.Vt)}}function Bn(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const s=Math.round(t);if(Math.abs(s-t)<1e-8)return i;t*=10}return i}(i.minMove))}function In(t){return function(t){if(S(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:{time:i,price:i},axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale){const{axisPressedMouseMove:i,axisDoubleClickReset:s}=t.handleScale;S(i)&&(t.handleScale.axisPressedMouseMove={time:i,price:i}),S(s)&&(t.handleScale.axisDoubleClickReset={time:s,price:s})}const i=t.handleScroll;S(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class Vn{constructor(t,i){this.Zm=new fn,this.Km=new Map,this.Gm=new Map,this.Jm=new m,this.Qm=new m;const s=void 0===i?y(yn):b(y(yn),In(i));this.Vm=new Hs(t,s),this.Vm.Gp().l((t=>{this.Jm.g()&&this.Jm.m(this.tb(t()))}),this),this.Vm.cc().l((t=>{this.Qm.g()&&this.Qm.m(this.tb(t()))}),this);const n=this.Vm.Ut();this.ib=new Nn(n,this.Vm.Qv())}remove(){this.Vm.Gp().v(this),this.Vm.cc().v(this),this.ib.M(),this.Vm.M(),this.Km.clear(),this.Gm.clear(),this.Jm.M(),this.Qm.M(),this.Zm.M()}resize(t,i,s){this.Vm.Zv(t,i,s)}addAreaSeries(t){return this.sb("Area",Tn,t)}addBaselineSeries(t){return this.sb("Baseline",Dn,t)}addBarSeries(t){return this.sb("Bar",Cn,t)}addCandlestickSeries(t={}){return function(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}(t),this.sb("Candlestick",kn,t)}addHistogramSeries(t){return this.sb("Histogram",Pn,t)}addLineSeries(t){return this.sb("Line",xn,t)}setCrossHairXY(t,i,s){this.Vm.Jv()[0].dv(t,i,s)}removeSeries(t){const i=r(this.Km.get(t)),s=this.Zm.Lc(i);this.Vm.Ut().Lc(i),this.nb(s),this.Km.delete(t),this.Gm.delete(i)}$m(t,i){this.nb(this.Zm.xm(t,i))}Hm(t,i){this.nb(this.Zm.Lm(t,i))}subscribeClick(t){this.Jm.l(t)}unsubscribeClick(t){this.Jm.p(t)}subscribeCrosshairMove(t){this.Qm.l(t)}unsubscribeCrosshairMove(t){this.Qm.p(t)}priceScale(t){return new Ln(this.Vm,t)}timeScale(){return this.ib}applyOptions(t){this.Vm.xh(In(t))}options(){return this.Vm.F()}takeScreenshot(){return this.Vm.im()}sb(t,i,s={}){Bn(s.priceFormat);const n=b(y(Rn),y(i),s),e=this.Vm.Ut().Pc(t,n),r=new En(e,this,this);return this.Km.set(r,e),this.Gm.set(e,r),r}nb(t){const i=this.Vm.Ut();i.Tc(t.yt.su,t.yt.Bm,t.yt.Im),t.Em.forEach(((t,i)=>i.tt(t.hr,t.Nm))),i.ru()}eb(t){return r(this.Gm.get(t))}tb(t){const i=new Map;t.pm.forEach(((t,s)=>{const n=gn(s.Nh())(t);e(function(t){return void 0!==t.open||void 0!==t.value}(n)),i.set(this.eb(s),n)}));const s=void 0===t.fm?void 0:this.eb(t.fm);return{time:t.ot,logical:t.Yn,point:t.dm,hoveredSeries:s,hoveredMarkerId:t.vm,seriesData:i}}}var Fn=Object.freeze({__proto__:null,version:function(){return"4.0.0-dev+202210141759"},get LineStyle(){return i},get LineType(){return t},get TrackingModeExitMode(){return es},get CrosshairMode(){return G},get MismatchDirection(){return wi},get PriceScaleMode(){return zi},get PriceLineSource(){return hs},get LastPriceAnimationMode(){return rs},get TickMarkType(){return ns},get ColorType(){return ls},isBusinessDay:ds,isUTCTimestamp:fs,createChart:function(t,i){let s;if(M(t)){const i=document.getElementById(t);e(null!==i,`Cannot find element in DOM with id=${t}`),s=i}else s=t;return new Vn(s,i)}});window.LightweightCharts=Fn}();
